function t(){}Object.assign(t.prototype,{addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)},removeEventListener:function(t,e){if(void 0!==this._listeners){var i=this._listeners[t];if(void 0!==i){var r=i.indexOf(e);-1!==r&&i.splice(r,1)}}},dispatchEvent:function(t){if(void 0!==this._listeners){var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var i=e.slice(0),r=0,n=i.length;r<n;r++)i[r].call(this,t)}}}});var e,i,r,n,a,s,o,h,u,l="90",c={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(var t=[],e=0;e<256;e++)t[e]=(e<16?"0":"")+e.toString(16).toUpperCase();return function(){var e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[255&i]+t[i>>8&255]+"-"+t[i>>16&15|64]+t[i>>24&255]+"-"+t[63&r|128]+t[r>>8&255]+"-"+t[r>>16&255]+t[r>>24&255]+t[255&n]+t[n>>8&255]+t[n>>16&255]+t[n>>24&255]}}(),clamp:function(t,e,i){return Math.max(e,Math.min(i,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,i,r,n){return r+(t-e)*(n-r)/(i-e)},lerp:function(t,e,i){return(1-i)*t+i*e},smoothstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*(3-2*t)},smootherstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*c.DEG2RAD},radToDeg:function(t){return t*c.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}};function p(t,e){this.x=t||0,this.y=e||0}function d(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function f(t,e,i,r){this._x=t||0,this._y=e||0,this._z=i||0,this._w=void 0!==r?r:1}function m(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0}function v(){this.elements=[1,0,0,0,1,0,0,0,1]}Object.defineProperties(p.prototype,{width:{get:function(){return this.x},set:function(t){this.x=t}},height:{get:function(){return this.y},set:function(t){this.y=t}}}),Object.assign(p.prototype,{isVector2:!0,set:function(t,e){return this.x=t,this.y=e,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return void 0!==e?this.addVectors(t,e):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},sub:function(t,e){return void 0!==e?this.subVectors(t,e):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},applyMatrix3:function(t){var e=this.x,i=this.y,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6],this.y=r[1]*e+r[4]*i+r[7],this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},clampScalar:(e=new p,i=new p,function(t,r){return e.set(t,t),i.set(r,r),this.clamp(e,i)}),clampLength:function(t,e){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},lerpVectors:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t},fromBufferAttribute:function(t,e,i){return this.x=t.getX(e),this.y=t.getY(e),this},rotateAround:function(t,e){var i=Math.cos(e),r=Math.sin(e),n=this.x-t.x,a=this.y-t.y;return this.x=n*i-a*r+t.x,this.y=n*r+a*i+t.y,this}}),Object.assign(d.prototype,{isMatrix4:!0,set:function(t,e,i,r,n,a,s,o,h,u,l,c,p,d,f,m){var v=this.elements;return v[0]=t,v[4]=e,v[8]=i,v[12]=r,v[1]=n,v[5]=a,v[9]=s,v[13]=o,v[2]=h,v[6]=u,v[10]=l,v[14]=c,v[3]=p,v[7]=d,v[11]=f,v[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new d).fromArray(this.elements)},copy:function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this},copyPosition:function(t){var e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this},extractBasis:function(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this},extractRotation:(h=new m,function(t){var e=this.elements,i=t.elements,r=1/h.setFromMatrixColumn(t,0).length(),n=1/h.setFromMatrixColumn(t,1).length(),a=1/h.setFromMatrixColumn(t,2).length();return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[4]=i[4]*n,e[5]=i[5]*n,e[6]=i[6]*n,e[8]=i[8]*a,e[9]=i[9]*a,e[10]=i[10]*a,this}),makeRotationFromEuler:function(t){!t||t.isEuler;var e=this.elements,i=t.x,r=t.y,n=t.z,a=Math.cos(i),s=Math.sin(i),o=Math.cos(r),h=Math.sin(r),u=Math.cos(n),l=Math.sin(n);if("XYZ"===t.order){var c=a*u,p=a*l,d=s*u,f=s*l;e[0]=o*u,e[4]=-o*l,e[8]=h,e[1]=p+d*h,e[5]=c-f*h,e[9]=-s*o,e[2]=f-c*h,e[6]=d+p*h,e[10]=a*o}else if("YXZ"===t.order){var m=o*u,v=o*l,g=h*u,y=h*l;e[0]=m+y*s,e[4]=g*s-v,e[8]=a*h,e[1]=a*l,e[5]=a*u,e[9]=-s,e[2]=v*s-g,e[6]=y+m*s,e[10]=a*o}else if("ZXY"===t.order){m=o*u,v=o*l,g=h*u,y=h*l;e[0]=m-y*s,e[4]=-a*l,e[8]=g+v*s,e[1]=v+g*s,e[5]=a*u,e[9]=y-m*s,e[2]=-a*h,e[6]=s,e[10]=a*o}else if("ZYX"===t.order){c=a*u,p=a*l,d=s*u,f=s*l;e[0]=o*u,e[4]=d*h-p,e[8]=c*h+f,e[1]=o*l,e[5]=f*h+c,e[9]=p*h-d,e[2]=-h,e[6]=s*o,e[10]=a*o}else if("YZX"===t.order){var x=a*o,w=a*h,M=s*o,_=s*h;e[0]=o*u,e[4]=_-x*l,e[8]=M*l+w,e[1]=l,e[5]=a*u,e[9]=-s*u,e[2]=-h*u,e[6]=w*l+M,e[10]=x-_*l}else if("XZY"===t.order){x=a*o,w=a*h,M=s*o,_=s*h;e[0]=o*u,e[4]=-l,e[8]=h*u,e[1]=x*l+_,e[5]=a*u,e[9]=w*l-M,e[2]=M*l-w,e[6]=s*u,e[10]=_*l+x}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:function(t){var e=this.elements,i=t._x,r=t._y,n=t._z,a=t._w,s=i+i,o=r+r,h=n+n,u=i*s,l=i*o,c=i*h,p=r*o,d=r*h,f=n*h,m=a*s,v=a*o,g=a*h;return e[0]=1-(p+f),e[4]=l-g,e[8]=c+v,e[1]=l+g,e[5]=1-(u+f),e[9]=d-m,e[2]=c-v,e[6]=d+m,e[10]=1-(u+p),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},lookAt:(a=new m,s=new m,o=new m,function(t,e,i){var r=this.elements;return o.subVectors(t,e),0===o.lengthSq()&&(o.z=1),o.normalize(),a.crossVectors(i,o),0===a.lengthSq()&&(1===Math.abs(i.z)?o.x+=1e-4:o.z+=1e-4,o.normalize(),a.crossVectors(i,o)),a.normalize(),s.crossVectors(o,a),r[0]=a.x,r[4]=s.x,r[8]=o.x,r[1]=a.y,r[5]=s.y,r[9]=o.y,r[2]=a.z,r[6]=s.z,r[10]=o.z,this}),multiply:function(t,e){return void 0!==e?this.multiplyMatrices(t,e):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var i=t.elements,r=e.elements,n=this.elements,a=i[0],s=i[4],o=i[8],h=i[12],u=i[1],l=i[5],c=i[9],p=i[13],d=i[2],f=i[6],m=i[10],v=i[14],g=i[3],y=i[7],x=i[11],w=i[15],M=r[0],_=r[4],b=r[8],S=r[12],T=r[1],E=r[5],A=r[9],P=r[13],C=r[2],N=r[6],z=r[10],R=r[14],O=r[3],L=r[7],U=r[11],D=r[15];return n[0]=a*M+s*T+o*C+h*O,n[4]=a*_+s*E+o*N+h*L,n[8]=a*b+s*A+o*z+h*U,n[12]=a*S+s*P+o*R+h*D,n[1]=u*M+l*T+c*C+p*O,n[5]=u*_+l*E+c*N+p*L,n[9]=u*b+l*A+c*z+p*U,n[13]=u*S+l*P+c*R+p*D,n[2]=d*M+f*T+m*C+v*O,n[6]=d*_+f*E+m*N+v*L,n[10]=d*b+f*A+m*z+v*U,n[14]=d*S+f*P+m*R+v*D,n[3]=g*M+y*T+x*C+w*O,n[7]=g*_+y*E+x*N+w*L,n[11]=g*b+y*A+x*z+w*U,n[15]=g*S+y*P+x*R+w*D,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},applyToBufferAttribute:function(){var t=new m;return function(e){for(var i=0,r=e.count;i<r;i++)t.x=e.getX(i),t.y=e.getY(i),t.z=e.getZ(i),t.applyMatrix4(this),e.setXYZ(i,t.x,t.y,t.z);return e}}(),determinant:function(){var t=this.elements,e=t[0],i=t[4],r=t[8],n=t[12],a=t[1],s=t[5],o=t[9],h=t[13],u=t[2],l=t[6],c=t[10],p=t[14];return t[3]*(+n*o*l-r*h*l-n*s*c+i*h*c+r*s*p-i*o*p)+t[7]*(+e*o*p-e*h*c+n*a*c-r*a*p+r*h*u-n*o*u)+t[11]*(+e*h*l-e*s*p-n*a*l+i*a*p+n*s*u-i*h*u)+t[15]*(-r*s*u-e*o*l+e*s*c+r*a*l-i*a*c+i*o*u)},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(t){var e=this.elements;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this},getInverse:function(t,e){var i=this.elements,r=t.elements,n=r[0],a=r[1],s=r[2],o=r[3],h=r[4],u=r[5],l=r[6],c=r[7],p=r[8],d=r[9],f=r[10],m=r[11],v=r[12],g=r[13],y=r[14],x=r[15],w=d*y*c-g*f*c+g*l*m-u*y*m-d*l*x+u*f*x,M=v*f*c-p*y*c-v*l*m+h*y*m+p*l*x-h*f*x,_=p*g*c-v*d*c+v*u*m-h*g*m-p*u*x+h*d*x,b=v*d*l-p*g*l-v*u*f+h*g*f+p*u*y-h*d*y,S=n*w+a*M+s*_+o*b;if(0===S){if(!0===e)throw new Error("THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0");return this.identity()}var T=1/S;return i[0]=w*T,i[1]=(g*f*o-d*y*o-g*s*m+a*y*m+d*s*x-a*f*x)*T,i[2]=(u*y*o-g*l*o+g*s*c-a*y*c-u*s*x+a*l*x)*T,i[3]=(d*l*o-u*f*o-d*s*c+a*f*c+u*s*m-a*l*m)*T,i[4]=M*T,i[5]=(p*y*o-v*f*o+v*s*m-n*y*m-p*s*x+n*f*x)*T,i[6]=(v*l*o-h*y*o-v*s*c+n*y*c+h*s*x-n*l*x)*T,i[7]=(h*f*o-p*l*o+p*s*c-n*f*c-h*s*m+n*l*m)*T,i[8]=_*T,i[9]=(v*d*o-p*g*o-v*a*m+n*g*m+p*a*x-n*d*x)*T,i[10]=(h*g*o-v*u*o+v*a*c-n*g*c-h*a*x+n*u*x)*T,i[11]=(p*u*o-h*d*o-p*a*c+n*d*c+h*a*m-n*u*m)*T,i[12]=b*T,i[13]=(p*g*s-v*d*s+v*a*f-n*g*f-p*a*y+n*d*y)*T,i[14]=(v*u*s-h*g*s-v*a*l+n*g*l+h*a*y-n*u*y)*T,i[15]=(h*d*s-p*u*s+p*a*l-n*d*l-h*a*f+n*u*f)*T,this},scale:function(t){var e=this.elements,i=t.x,r=t.y,n=t.z;return e[0]*=i,e[4]*=r,e[8]*=n,e[1]*=i,e[5]*=r,e[9]*=n,e[2]*=i,e[6]*=r,e[10]*=n,e[3]*=i,e[7]*=r,e[11]*=n,this},getMaxScaleOnAxis:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,r))},makeTranslation:function(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var i=Math.cos(e),r=Math.sin(e),n=1-i,a=t.x,s=t.y,o=t.z,h=n*a,u=n*s;return this.set(h*a+i,h*s-r*o,h*o+r*s,0,h*s+r*o,u*s+i,u*o-r*a,0,h*o-r*s,u*o+r*a,n*o*o+i,0,0,0,0,1),this},makeScale:function(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this},makeShear:function(t,e,i){return this.set(1,e,i,0,t,1,i,0,t,e,1,0,0,0,0,1),this},compose:function(t,e,i){return this.makeRotationFromQuaternion(e),this.scale(i),this.setPosition(t),this},decompose:(r=new m,n=new d,function(t,e,i){var a=this.elements,s=r.set(a[0],a[1],a[2]).length(),o=r.set(a[4],a[5],a[6]).length(),h=r.set(a[8],a[9],a[10]).length();this.determinant()<0&&(s=-s),t.x=a[12],t.y=a[13],t.z=a[14],n.copy(this);var u=1/s,l=1/o,c=1/h;return n.elements[0]*=u,n.elements[1]*=u,n.elements[2]*=u,n.elements[4]*=l,n.elements[5]*=l,n.elements[6]*=l,n.elements[8]*=c,n.elements[9]*=c,n.elements[10]*=c,e.setFromRotationMatrix(n),i.x=s,i.y=o,i.z=h,this}),makePerspective:function(t,e,i,r,n,a){var s=this.elements,o=2*n/(e-t),h=2*n/(i-r),u=(e+t)/(e-t),l=(i+r)/(i-r),c=-(a+n)/(a-n),p=-2*a*n/(a-n);return s[0]=o,s[4]=0,s[8]=u,s[12]=0,s[1]=0,s[5]=h,s[9]=l,s[13]=0,s[2]=0,s[6]=0,s[10]=c,s[14]=p,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this},makeOrthographic:function(t,e,i,r,n,a){var s=this.elements,o=1/(e-t),h=1/(i-r),u=1/(a-n),l=(e+t)*o,c=(i+r)*h,p=(a+n)*u;return s[0]=2*o,s[4]=0,s[8]=0,s[12]=-l,s[1]=0,s[5]=2*h,s[9]=0,s[13]=-c,s[2]=0,s[6]=0,s[10]=-2*u,s[14]=-p,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this},equals:function(t){for(var e=this.elements,i=t.elements,r=0;r<16;r++)if(e[r]!==i[r])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var i=0;i<16;i++)this.elements[i]=t[i+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}),Object.assign(f,{slerp:function(t,e,i,r){return i.copy(t).slerp(e,r)},slerpFlat:function(t,e,i,r,n,a,s){var o=i[r+0],h=i[r+1],u=i[r+2],l=i[r+3],c=n[a+0],p=n[a+1],d=n[a+2],f=n[a+3];if(l!==f||o!==c||h!==p||u!==d){var m=1-s,v=o*c+h*p+u*d+l*f,g=v>=0?1:-1,y=1-v*v;if(y>Number.EPSILON){var x=Math.sqrt(y),w=Math.atan2(x,v*g);m=Math.sin(m*w)/x,s=Math.sin(s*w)/x}var M=s*g;if(o=o*m+c*M,h=h*m+p*M,u=u*m+d*M,l=l*m+f*M,m===1-s){var _=1/Math.sqrt(o*o+h*h+u*u+l*l);o*=_,h*=_,u*=_,l*=_}}t[e]=o,t[e+1]=h,t[e+2]=u,t[e+3]=l}}),Object.defineProperties(f.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this.onChangeCallback()}}}),Object.assign(f.prototype,{set:function(t,e,i,r){return this._x=t,this._y=e,this._z=i,this._w=r,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this.onChangeCallback(),this},setFromEuler:function(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var i=t._x,r=t._y,n=t._z,a=t.order,s=Math.cos,o=Math.sin,h=s(i/2),u=s(r/2),l=s(n/2),c=o(i/2),p=o(r/2),d=o(n/2);return"XYZ"===a?(this._x=c*u*l+h*p*d,this._y=h*p*l-c*u*d,this._z=h*u*d+c*p*l,this._w=h*u*l-c*p*d):"YXZ"===a?(this._x=c*u*l+h*p*d,this._y=h*p*l-c*u*d,this._z=h*u*d-c*p*l,this._w=h*u*l+c*p*d):"ZXY"===a?(this._x=c*u*l-h*p*d,this._y=h*p*l+c*u*d,this._z=h*u*d+c*p*l,this._w=h*u*l-c*p*d):"ZYX"===a?(this._x=c*u*l-h*p*d,this._y=h*p*l+c*u*d,this._z=h*u*d-c*p*l,this._w=h*u*l+c*p*d):"YZX"===a?(this._x=c*u*l+h*p*d,this._y=h*p*l+c*u*d,this._z=h*u*d-c*p*l,this._w=h*u*l-c*p*d):"XZY"===a&&(this._x=c*u*l-h*p*d,this._y=h*p*l-c*u*d,this._z=h*u*d+c*p*l,this._w=h*u*l+c*p*d),!1!==e&&this.onChangeCallback(),this},setFromAxisAngle:function(t,e){var i=e/2,r=Math.sin(i);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(i),this.onChangeCallback(),this},setFromRotationMatrix:function(t){var e,i=t.elements,r=i[0],n=i[4],a=i[8],s=i[1],o=i[5],h=i[9],u=i[2],l=i[6],c=i[10],p=r+o+c;return p>0?(e=.5/Math.sqrt(p+1),this._w=.25/e,this._x=(l-h)*e,this._y=(a-u)*e,this._z=(s-n)*e):r>o&&r>c?(e=2*Math.sqrt(1+r-o-c),this._w=(l-h)/e,this._x=.25*e,this._y=(n+s)/e,this._z=(a+u)/e):o>c?(e=2*Math.sqrt(1+o-r-c),this._w=(a-u)/e,this._x=(n+s)/e,this._y=.25*e,this._z=(h+l)/e):(e=2*Math.sqrt(1+c-r-o),this._w=(s-n)/e,this._x=(a+u)/e,this._y=(h+l)/e,this._z=.25*e),this.onChangeCallback(),this},setFromUnitVectors:function(){var t,e=new m;return function(i,r){return void 0===e&&(e=new m),(t=i.dot(r)+1)<1e-6?(t=0,Math.abs(i.x)>Math.abs(i.z)?e.set(-i.y,i.x,0):e.set(0,-i.z,i.y)):e.crossVectors(i,r),this._x=e.x,this._y=e.y,this._z=e.z,this._w=t,this.normalize()}}(),inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this.onChangeCallback(),this},multiply:function(t,e){return void 0!==e?this.multiplyQuaternions(t,e):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){var i=t._x,r=t._y,n=t._z,a=t._w,s=e._x,o=e._y,h=e._z,u=e._w;return this._x=i*u+a*s+r*h-n*o,this._y=r*u+a*o+n*s-i*h,this._z=n*u+a*h+i*o-r*s,this._w=a*u-i*s-r*o-n*h,this.onChangeCallback(),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var i=this._x,r=this._y,n=this._z,a=this._w,s=a*t._w+i*t._x+r*t._y+n*t._z;if(s<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,s=-s):this.copy(t),s>=1)return this._w=a,this._x=i,this._y=r,this._z=n,this;var o=Math.sqrt(1-s*s);if(Math.abs(o)<.001)return this._w=.5*(a+this._w),this._x=.5*(i+this._x),this._y=.5*(r+this._y),this._z=.5*(n+this._z),this;var h=Math.atan2(o,s),u=Math.sin((1-e)*h)/o,l=Math.sin(e*h)/o;return this._w=a*u+this._w*l,this._x=i*u+this._x*l,this._y=r*u+this._y*l,this._z=n*u+this._z*l,this.onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}}),Object.assign(m.prototype,{isVector3:!0,set:function(t,e,i){return this.x=t,this.y=e,this.z=i,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?this.addVectors(t,e):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return void 0!==e?this.subVectors(t,e):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0!==e?this.multiplyVectors(t,e):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:(u=new f,function(t){return!t||t.isEuler,this.applyQuaternion(u.setFromEuler(t))}),applyAxisAngle:function(){var t=new f;return function(e,i){return this.applyQuaternion(t.setFromAxisAngle(e,i))}}(),applyMatrix3:function(t){var e=this.x,i=this.y,r=this.z,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6]*r,this.y=n[1]*e+n[4]*i+n[7]*r,this.z=n[2]*e+n[5]*i+n[8]*r,this},applyMatrix4:function(t){var e=this.x,i=this.y,r=this.z,n=t.elements,a=1/(n[3]*e+n[7]*i+n[11]*r+n[15]);return this.x=(n[0]*e+n[4]*i+n[8]*r+n[12])*a,this.y=(n[1]*e+n[5]*i+n[9]*r+n[13])*a,this.z=(n[2]*e+n[6]*i+n[10]*r+n[14])*a,this},applyQuaternion:function(t){var e=this.x,i=this.y,r=this.z,n=t.x,a=t.y,s=t.z,o=t.w,h=o*e+a*r-s*i,u=o*i+s*e-n*r,l=o*r+n*i-a*e,c=-n*e-a*i-s*r;return this.x=h*o+c*-n+u*-s-l*-a,this.y=u*o+c*-a+l*-n-h*-s,this.z=l*o+c*-s+h*-a-u*-n,this},project:function(){var t=new d;return function(e){return t.multiplyMatrices(e.projectionMatrix,t.getInverse(e.matrixWorld)),this.applyMatrix4(t)}}(),unproject:function(){var t=new d;return function(e){return t.multiplyMatrices(e.matrixWorld,t.getInverse(e.projectionMatrix)),this.applyMatrix4(t)}}(),transformDirection:function(t){var e=this.x,i=this.y,r=this.z,n=t.elements;return this.x=n[0]*e+n[4]*i+n[8]*r,this.y=n[1]*e+n[5]*i+n[9]*r,this.z=n[2]*e+n[6]*i+n[10]*r,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},clampScalar:function(){var t=new m,e=new m;return function(i,r){return t.set(i,i,i),e.set(r,r,r),this.clamp(t,e)}}(),clampLength:function(t,e){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)},cross:function(t,e){return void 0!==e?this.crossVectors(t,e):this.crossVectors(this,t)},crossVectors:function(t,e){var i=t.x,r=t.y,n=t.z,a=e.x,s=e.y,o=e.z;return this.x=r*o-n*s,this.y=n*a-i*o,this.z=i*s-r*a,this},projectOnVector:function(t){var e=t.dot(this)/t.lengthSq();return this.copy(t).multiplyScalar(e)},projectOnPlane:function(){var t=new m;return function(e){return t.copy(this).projectOnVector(e),this.sub(t)}}(),reflect:function(){var t=new m;return function(e){return this.sub(t.copy(e).multiplyScalar(2*this.dot(e)))}}(),angleTo:function(t){var e=this.dot(t)/Math.sqrt(this.lengthSq()*t.lengthSq());return Math.acos(c.clamp(e,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,i=this.y-t.y,r=this.z-t.z;return e*e+i*i+r*r},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){var e=Math.sin(t.phi)*t.radius;return this.x=e*Math.sin(t.theta),this.y=Math.cos(t.phi)*t.radius,this.z=e*Math.cos(t.theta),this},setFromCylindrical:function(t){return this.x=t.radius*Math.sin(t.theta),this.y=t.y,this.z=t.radius*Math.cos(t.theta),this},setFromMatrixPosition:function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},setFromMatrixScale:function(t){var e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=r,this},setFromMatrixColumn:function(t,e){return this.fromArray(t.elements,4*e)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromBufferAttribute:function(t,e,i){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}}),Object.assign(v.prototype,{isMatrix3:!0,set:function(t,e,i,r,n,a,s,o,h){var u=this.elements;return u[0]=t,u[1]=r,u[2]=s,u[3]=e,u[4]=n,u[5]=o,u[6]=i,u[7]=a,u[8]=h,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this},setFromMatrix4:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},applyToBufferAttribute:function(){var t=new m;return function(e){for(var i=0,r=e.count;i<r;i++)t.x=e.getX(i),t.y=e.getY(i),t.z=e.getZ(i),t.applyMatrix3(this),e.setXYZ(i,t.x,t.y,t.z);return e}}(),multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var i=t.elements,r=e.elements,n=this.elements,a=i[0],s=i[3],o=i[6],h=i[1],u=i[4],l=i[7],c=i[2],p=i[5],d=i[8],f=r[0],m=r[3],v=r[6],g=r[1],y=r[4],x=r[7],w=r[2],M=r[5],_=r[8];return n[0]=a*f+s*g+o*w,n[3]=a*m+s*y+o*M,n[6]=a*v+s*x+o*_,n[1]=h*f+u*g+l*w,n[4]=h*m+u*y+l*M,n[7]=h*v+u*x+l*_,n[2]=c*f+p*g+d*w,n[5]=c*m+p*y+d*M,n[8]=c*v+p*x+d*_,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.elements,e=t[0],i=t[1],r=t[2],n=t[3],a=t[4],s=t[5],o=t[6],h=t[7],u=t[8];return e*a*u-e*s*h-i*n*u+i*s*o+r*n*h-r*a*o},getInverse:function(t,e){t&&t.isMatrix4;var i=t.elements,r=this.elements,n=i[0],a=i[1],s=i[2],o=i[3],h=i[4],u=i[5],l=i[6],c=i[7],p=i[8],d=p*h-u*c,f=u*l-p*o,m=c*o-h*l,v=n*d+a*f+s*m;if(0===v){if(!0===e)throw new Error("THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0");return this.identity()}var g=1/v;return r[0]=d*g,r[1]=(s*c-p*a)*g,r[2]=(u*a-s*h)*g,r[3]=f*g,r[4]=(p*n-s*l)*g,r[5]=(s*o-u*n)*g,r[6]=m*g,r[7]=(a*l-c*n)*g,r[8]=(h*n-a*o)*g,this},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},setUvTransform:function(t,e,i,r,n,a,s){var o=Math.cos(n),h=Math.sin(n);this.set(i*o,i*h,-i*(o*a+h*s)+a+t,-r*h,r*o,-r*(-h*a+o*s)+s+e,0,0,1)},scale:function(t,e){var i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=e,i[4]*=e,i[7]*=e,this},rotate:function(t){var e=Math.cos(t),i=Math.sin(t),r=this.elements,n=r[0],a=r[3],s=r[6],o=r[1],h=r[4],u=r[7];return r[0]=e*n+i*o,r[3]=e*a+i*h,r[6]=e*s+i*u,r[1]=-i*n+e*o,r[4]=-i*a+e*h,r[7]=-i*s+e*u,this},translate:function(t,e){var i=this.elements;return i[0]+=t*i[2],i[3]+=t*i[5],i[6]+=t*i[8],i[1]+=e*i[2],i[4]+=e*i[5],i[7]+=e*i[8],this},equals:function(t){for(var e=this.elements,i=t.elements,r=0;r<9;r++)if(e[r]!==i[r])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var i=0;i<9;i++)this.elements[i]=t[i+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}});var g=0;function y(t,e,i,r,n,a,s,o,h,u){Object.defineProperty(this,"id",{value:g++}),this.uuid=c.generateUUID(),this.name="",this.image=void 0!==t?t:y.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==e?e:y.DEFAULT_MAPPING,this.wrapS=void 0!==i?i:1001,this.wrapT=void 0!==r?r:1001,this.magFilter=void 0!==n?n:1006,this.minFilter=void 0!==a?a:1008,this.anisotropy=void 0!==h?h:1,this.format=void 0!==s?s:1023,this.type=void 0!==o?o:1009,this.offset=new p(0,0),this.repeat=new p(1,1),this.center=new p(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new v,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==u?u:3e3,this.version=0,this.onUpdate=null}function x(t,e,i,r){this.x=t||0,this.y=e||0,this.z=i||0,this.w=void 0!==r?r:1}function w(t,e,i){this.uuid=c.generateUUID(),this.width=t,this.height=e,this.scissor=new x(0,0,t,e),this.scissorTest=!1,this.viewport=new x(0,0,t,e),void 0===(i=i||{}).minFilter&&(i.minFilter=1006),this.texture=new y(void 0,void 0,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0===i.stencilBuffer||i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null}function M(t,e,i,r,n,a,s,o,h,u,l,c){y.call(this,null,a,s,o,h,u,r,n,l,c),this.image={data:t,width:e,height:i},this.magFilter=void 0!==h?h:1003,this.minFilter=void 0!==u?u:1003,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}function _(t,e,i,r,n,a,s,o,h,u){t=void 0!==t?t:[],e=void 0!==e?e:301,y.call(this,t,e,i,r,n,a,s,o,h,u),this.flipY=!1}y.DEFAULT_IMAGE=void 0,y.DEFAULT_MAPPING=300,y.prototype=Object.assign(Object.create(t.prototype),{constructor:y,isTexture:!0,clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){var e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];var i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var r=this.image;void 0===r.uuid&&(r.uuid=c.generateUUID()),e||void 0!==t.images[r.uuid]||(t.images[r.uuid]={uuid:r.uuid,url:function(t){var e;if(t instanceof HTMLCanvasElement)e=t;else{(e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")).width=t.width,e.height=t.height;var i=e.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height)}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}(r)}),i.image=r.uuid}return e||(t.textures[this.uuid]=i),i},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(300===this.mapping){if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case 1e3:t.x=t.x-Math.floor(t.x);break;case 1001:t.x=t.x<0?0:1;break;case 1002:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case 1e3:t.y=t.y-Math.floor(t.y);break;case 1001:t.y=t.y<0?0:1;break;case 1002:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}this.flipY&&(t.y=1-t.y)}}}),Object.defineProperty(y.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(x.prototype,{isVector4:!0,set:function(t,e,i,r){return this.x=t,this.y=e,this.z=i,this.w=r,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,e){return void 0!==e?this.addVectors(t,e):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},sub:function(t,e){return void 0!==e?this.subVectors(t,e):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var e=this.x,i=this.y,r=this.z,n=this.w,a=t.elements;return this.x=a[0]*e+a[4]*i+a[8]*r+a[12]*n,this.y=a[1]*e+a[5]*i+a[9]*r+a[13]*n,this.z=a[2]*e+a[6]*i+a[10]*r+a[14]*n,this.w=a[3]*e+a[7]*i+a[11]*r+a[15]*n,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},setAxisAngleFromRotationMatrix:function(t){var e,i,r,n,a=.01,s=.1,o=t.elements,h=o[0],u=o[4],l=o[8],c=o[1],p=o[5],d=o[9],f=o[2],m=o[6],v=o[10];if(Math.abs(u-c)<a&&Math.abs(l-f)<a&&Math.abs(d-m)<a){if(Math.abs(u+c)<s&&Math.abs(l+f)<s&&Math.abs(d+m)<s&&Math.abs(h+p+v-3)<s)return this.set(1,0,0,0),this;e=Math.PI;var g=(h+1)/2,y=(p+1)/2,x=(v+1)/2,w=(u+c)/4,M=(l+f)/4,_=(d+m)/4;return g>y&&g>x?g<a?(i=0,r=.707106781,n=.707106781):(r=w/(i=Math.sqrt(g)),n=M/i):y>x?y<a?(i=.707106781,r=0,n=.707106781):(i=w/(r=Math.sqrt(y)),n=_/r):x<a?(i=.707106781,r=.707106781,n=0):(i=M/(n=Math.sqrt(x)),r=_/n),this.set(i,r,n,e),this}var b=Math.sqrt((m-d)*(m-d)+(l-f)*(l-f)+(c-u)*(c-u));return Math.abs(b)<.001&&(b=1),this.x=(m-d)/b,this.y=(l-f)/b,this.z=(c-u)/b,this.w=Math.acos((h+p+v-1)/2),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this},clampScalar:function(){var t,e;return function(i,r){return void 0===t&&(t=new x,e=new x),t.set(i,i,i,i),e.set(r,r,r,r),this.clamp(t,e)}}(),clampLength:function(t,e){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},lerpVectors:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},fromBufferAttribute:function(t,e,i){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}}),w.prototype=Object.assign(Object.create(t.prototype),{constructor:w,isWebGLRenderTarget:!0,setSize:function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),M.prototype=Object.create(y.prototype),M.prototype.constructor=M,M.prototype.isDataTexture=!0,_.prototype=Object.create(y.prototype),_.prototype.constructor=_,_.prototype.isCubeTexture=!0,Object.defineProperty(_.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}});var b=new y,S=new _;function T(){this.seq=[],this.map={}}var E=[],A=[],P=new Float32Array(16),C=new Float32Array(9);function N(t,e,i){var r=t[0];if(r<=0||r>0)return t;var n=e*i,a=E[n];if(void 0===a&&(a=new Float32Array(n),E[n]=a),0!==e){r.toArray(a,0);for(var s=1,o=0;s!==e;++s)o+=i,t[s].toArray(a,o)}return a}function z(t,e){var i=A[e];void 0===i&&(i=new Int32Array(e),A[e]=i);for(var r=0;r!==e;++r)i[r]=t.allocTextureUnit();return i}function R(t,e){t.uniform1f(this.addr,e)}function O(t,e){t.uniform1i(this.addr,e)}function L(t,e){void 0===e.x?t.uniform2fv(this.addr,e):t.uniform2f(this.addr,e.x,e.y)}function U(t,e){void 0!==e.x?t.uniform3f(this.addr,e.x,e.y,e.z):void 0!==e.r?t.uniform3f(this.addr,e.r,e.g,e.b):t.uniform3fv(this.addr,e)}function D(t,e){void 0===e.x?t.uniform4fv(this.addr,e):t.uniform4f(this.addr,e.x,e.y,e.z,e.w)}function F(t,e){t.uniformMatrix2fv(this.addr,!1,e.elements||e)}function I(t,e){void 0===e.elements?t.uniformMatrix3fv(this.addr,!1,e):(C.set(e.elements),t.uniformMatrix3fv(this.addr,!1,C))}function B(t,e){void 0===e.elements?t.uniformMatrix4fv(this.addr,!1,e):(P.set(e.elements),t.uniformMatrix4fv(this.addr,!1,P))}function G(t,e,i){var r=i.allocTextureUnit();t.uniform1i(this.addr,r),i.setTexture2D(e||b,r)}function V(t,e,i){var r=i.allocTextureUnit();t.uniform1i(this.addr,r),i.setTextureCube(e||S,r)}function k(t,e){t.uniform2iv(this.addr,e)}function W(t,e){t.uniform3iv(this.addr,e)}function j(t,e){t.uniform4iv(this.addr,e)}function X(t,e){t.uniform1fv(this.addr,e)}function H(t,e){t.uniform1iv(this.addr,e)}function Y(t,e){t.uniform2fv(this.addr,N(e,this.size,2))}function q(t,e){t.uniform3fv(this.addr,N(e,this.size,3))}function Z(t,e){t.uniform4fv(this.addr,N(e,this.size,4))}function J(t,e){t.uniformMatrix2fv(this.addr,!1,N(e,this.size,4))}function Q(t,e){t.uniformMatrix3fv(this.addr,!1,N(e,this.size,9))}function K(t,e){t.uniformMatrix4fv(this.addr,!1,N(e,this.size,16))}function $(t,e,i){var r=e.length,n=z(i,r);t.uniform1iv(this.addr,n);for(var a=0;a!==r;++a)i.setTexture2D(e[a]||b,n[a])}function tt(t,e,i){var r=e.length,n=z(i,r);t.uniform1iv(this.addr,n);for(var a=0;a!==r;++a)i.setTextureCube(e[a]||S,n[a])}function et(t,e,i){this.id=t,this.addr=i,this.setValue=function(t){switch(t){case 5126:return R;case 35664:return L;case 35665:return U;case 35666:return D;case 35674:return F;case 35675:return I;case 35676:return B;case 35678:case 36198:return G;case 35680:return V;case 5124:case 35670:return O;case 35667:case 35671:return k;case 35668:case 35672:return W;case 35669:case 35673:return j}}(e.type)}function it(t,e,i){this.id=t,this.addr=i,this.size=e.size,this.setValue=function(t){switch(t){case 5126:return X;case 35664:return Y;case 35665:return q;case 35666:return Z;case 35674:return J;case 35675:return Q;case 35676:return K;case 35678:return $;case 35680:return tt;case 5124:case 35670:return H;case 35667:case 35671:return k;case 35668:case 35672:return W;case 35669:case 35673:return j}}(e.type)}function rt(t){this.id=t,T.call(this)}rt.prototype.setValue=function(t,e){for(var i=this.seq,r=0,n=i.length;r!==n;++r){var a=i[r];a.setValue(t,e[a.id])}};var nt=/([\w\d_]+)(\])?(\[|\.)?/g;function at(t,e){t.seq.push(e),t.map[e.id]=e}function st(t,e,i){var r=t.name,n=r.length;for(nt.lastIndex=0;;){var a=nt.exec(r),s=nt.lastIndex,o=a[1],h="]"===a[2],u=a[3];if(h&&(o|=0),void 0===u||"["===u&&s+2===n){at(i,void 0===u?new et(o,t,e):new it(o,t,e));break}var l=i.map[o];void 0===l&&at(i,l=new rt(o)),i=l}}function ot(t,e,i){T.call(this),this.renderer=i;for(var r=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),n=0;n<r;++n){var a=t.getActiveUniform(e,n),s=a.name;st(a,t.getUniformLocation(e,s),this)}}ot.prototype.setValue=function(t,e,i){var r=this.map[e];void 0!==r&&r.setValue(t,i,this.renderer)},ot.prototype.setOptional=function(t,e,i){var r=e[i];void 0!==r&&this.setValue(t,i,r)},ot.upload=function(t,e,i,r){for(var n=0,a=e.length;n!==a;++n){var s=e[n],o=i[s.id];!1!==o.needsUpdate&&s.setValue(t,o.value,r)}},ot.seqWithValue=function(t,e){for(var i=[],r=0,n=t.length;r!==n;++r){var a=t[r];a.id in e&&i.push(a)}return i};var ht={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function ut(t,e,i){return void 0===e&&void 0===i?this.set(t):this.setRGB(t,e,i)}Object.assign(ut.prototype,{isColor:!0,r:1,g:1,b:1,set:function(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setScalar:function(t){return this.r=t,this.g=t,this.b=t,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,e,i){return this.r=t,this.g=e,this.b=i,this},setHSL:function(){function t(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+6*(e-t)*(2/3-i):t}return function(e,i,r){if(e=c.euclideanModulo(e,1),i=c.clamp(i,0,1),r=c.clamp(r,0,1),0===i)this.r=this.g=this.b=r;else{var n=r<=.5?r*(1+i):r+i-r*i,a=2*r-n;this.r=t(a,n,e+1/3),this.g=t(a,n,e),this.b=t(a,n,e-1/3)}return this}}(),setStyle:function(t){function e(t){void 0!==t&&parseFloat(t)}var i;if(i=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var r,n=i[1],a=i[2];switch(n){case"rgb":case"rgba":if(r=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,e(r[5]),this;if(r=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,e(r[5]),this;break;case"hsl":case"hsla":if(r=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a)){var s=parseFloat(r[1])/360,o=parseInt(r[2],10)/100,h=parseInt(r[3],10)/100;return e(r[5]),this.setHSL(s,o,h)}}}else if(i=/^\#([A-Fa-f0-9]+)$/.exec(t)){var u,l=(u=i[1]).length;if(3===l)return this.r=parseInt(u.charAt(0)+u.charAt(0),16)/255,this.g=parseInt(u.charAt(1)+u.charAt(1),16)/255,this.b=parseInt(u.charAt(2)+u.charAt(2),16)/255,this;if(6===l)return this.r=parseInt(u.charAt(0)+u.charAt(1),16)/255,this.g=parseInt(u.charAt(2)+u.charAt(3),16)/255,this.b=parseInt(u.charAt(4)+u.charAt(5),16)/255,this}t&&t.length>0&&(void 0!==(u=ht[t])&&this.setHex(u));return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,e){return void 0===e&&(e=2),this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},copyLinearToGamma:function(t,e){void 0===e&&(e=2);var i=e>0?1/e:1;return this.r=Math.pow(t.r,i),this.g=Math.pow(t.g,i),this.b=Math.pow(t.b,i),this},convertGammaToLinear:function(){var t=this.r,e=this.g,i=this.b;return this.r=t*t,this.g=e*e,this.b=i*i,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){var e,i,r=t||{h:0,s:0,l:0},n=this.r,a=this.g,s=this.b,o=Math.max(n,a,s),h=Math.min(n,a,s),u=(h+o)/2;if(h===o)e=0,i=0;else{var l=o-h;switch(i=u<=.5?l/(o+h):l/(2-o-h),o){case n:e=(a-s)/l+(a<s?6:0);break;case a:e=(s-n)/l+2;break;case s:e=(n-a)/l+4}e/=6}return r.h=e,r.s=i,r.l=u,r},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(t,e,i){var r=this.getHSL();return r.h+=t,r.s+=e,r.l+=i,this.setHSL(r.h,r.s,r.l),this},add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},sub:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,e){return void 0===e&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t},toJSON:function(){return this.getHex()}});var lt={common:{diffuse:{value:new ut(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new v},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new p(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ut(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new ut(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new v}}},ct={merge:function(t){for(var e={},i=0;i<t.length;i++){var r=this.clone(t[i]);for(var n in r)e[n]=r[n]}return e},clone:function(t){var e={};for(var i in t)for(var r in e[i]={},t[i]){var n=t[i][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture)?e[i][r]=n.clone():Array.isArray(n)?e[i][r]=n.slice():e[i][r]=n}return e}};var pt=Object.freeze({__proto__:null,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <packing>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main(){
#include <clipping_planes_fragment>
	vec3 outgoingLight=vec3(0.0);
	vec4 diffuseColor=vec4(diffuse,opacity);
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight=diffuseColor.rgb;
	gl_FragColor=vec4(outgoingLight,diffuseColor.a);
	#include <premultiplied_alpha_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,common:`#define PI 3.14159265359
#define PI2 6.28318530718
#define PI_HALF 1.5707963267949
#define RECIPROCAL_PI 0.31830988618
#define RECIPROCAL_PI2 0.15915494
#define LOG2 1.442695
#define EPSILON 1e-6
#define saturate(a)clamp(a,0.0,1.0)
#define whiteCompliment(a)(1.0-saturate(a))
float pow2(const in float x){ return x*x; }
float pow3(const in float x){ return x*x*x; }
float pow4(const in float x){ float x2=x*x; return x2*x2; }
float average(const in vec3 color){ return dot(color,vec3(0.3333)); }
highp float rand(const in vec2 uv){
const highp float a=12.9898,b=78.233,c=43758.5453;
	highp float dt=dot(uv.xy,vec2(a,b)),sn=mod(dt,PI);
	return fract(sin(sn)*c);
}
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
};
vec3 transformDirection(in vec3 dir,in mat4 matrix){
	return normalize((matrix*vec4(dir,0.0)).xyz);
}
vec3 inverseTransformDirection(in vec3 dir,in mat4 matrix){
	return normalize((vec4(dir,0.0)*matrix).xyz);
}
vec3 projectOnPlane(in vec3 point,in vec3 pointOnPlane,in vec3 planeNormal){
	float distance=dot(planeNormal,point-pointOnPlane);
	return-distance*planeNormal+point;
}
float sideOfPlane(in vec3 point,in vec3 pointOnPlane,in vec3 planeNormal){
	return sign(dot(point-pointOnPlane,planeNormal));
}
vec3 linePlaneIntersect(in vec3 pointOnLine,in vec3 lineDirection,in vec3 pointOnPlane,in vec3 planeNormal){
	return lineDirection*(dot(planeNormal,pointOnPlane-pointOnLine)/ dot(planeNormal,lineDirection))+pointOnLine;
}
mat3 transposeMat3(const in mat3 m){
	mat3 tmp;
	tmp[ 0 ]=vec3(m[ 0 ].x,m[ 1 ].x,m[ 2 ].x);
	tmp[ 1 ]=vec3(m[ 0 ].y,m[ 1 ].y,m[ 2 ].y);
	tmp[ 2 ]=vec3(m[ 0 ].z,m[ 1 ].z,m[ 2 ].z);
	return tmp;
}
float linearToRelativeLuminance(const in vec3 color){
	vec3 weights=vec3(0.2126,0.7152,0.0722);
	return dot(weights,color.rgb);
}`,packing:`vec3 packNormalToRGB(const in vec3 normal){
return normalize(normal)*0.5+0.5;
}
vec3 unpackRGBToNormal(const in vec3 rgb){
	return 2.0*rgb.xyz-1.0;
}
const float PackUpscale=256. / 255.;
const float UnpackDownscale=255. / 256.;
const vec3 PackFactors=vec3(256.*256.*256.,256.*256., 256.);
const vec4 UnpackFactors=UnpackDownscale / vec4(PackFactors,1.);
const float ShiftRight8=1. / 256.;
vec4 packDepthToRGBA(const in float v){
	vec4 r=vec4(fract(v*PackFactors),v);
	r.yzw-=r.xyz*ShiftRight8;
	return r*PackUpscale;
}
float unpackRGBAToDepth(const in vec4 v){
	return dot(v,UnpackFactors);
}
float viewZToOrthographicDepth(const in float viewZ,const in float near,const in float far){
	return(viewZ+near)/(near-far);
}
float orthographicDepthToViewZ(const in float linearClipZ,const in float near,const in float far){
	return linearClipZ*(near-far)-near;
}
float viewZToPerspectiveDepth(const in float viewZ,const in float near,const in float far){
	return((near+viewZ)*far)/((far-near)*viewZ);
}
float perspectiveDepthToViewZ(const in float invClipZ,const in float near,const in float far){
	return(near*far)/((far-near)*invClipZ-far);
}`,color_pars_fragment:`#ifdef USE_COLOR
varying vec3 vColor;
#endif`,map_particle_pars_fragment:`#ifdef USE_MAP
uniform mat3 uvTransform;
	uniform sampler2D map;
#endif`,fog_pars_fragment:`#ifdef USE_FOG
uniform vec3 fogColor;
	varying float fogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,shadowmap_pars_fragment:`#ifdef USE_SHADOWMAP
#if NUM_DIR_LIGHTS>0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];
	#endif
	#if NUM_SPOT_LIGHTS>0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];
	#endif
	#if NUM_POINT_LIGHTS>0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];
	#endif
	float texture2DCompare(sampler2D depths,vec2 uv,float compare){
		return step(compare,unpackRGBAToDepth(texture2D(depths,uv)));
	}
	float texture2DShadowLerp(sampler2D depths,vec2 size,vec2 uv,float compare){
		const vec2 offset=vec2(0.0,1.0);
		vec2 texelSize=vec2(1.0)/ size;
		vec2 centroidUV=floor(uv*size+0.5)/ size;
		float lb=texture2DCompare(depths,centroidUV+texelSize*offset.xx,compare);
		float lt=texture2DCompare(depths,centroidUV+texelSize*offset.xy,compare);
		float rb=texture2DCompare(depths,centroidUV+texelSize*offset.yx,compare);
		float rt=texture2DCompare(depths,centroidUV+texelSize*offset.yy,compare);
		vec2 f=fract(uv*size+0.5);
		float a=mix(lb,lt,f.y);
		float b=mix(rb,rt,f.y);
		float c=mix(a,b,f.x);
		return c;
	}
	float getShadow(sampler2D shadowMap,vec2 shadowMapSize,float shadowBias,float shadowRadius,vec4 shadowCoord){
		float shadow=1.0;
		shadowCoord.xyz /=shadowCoord.w;
		shadowCoord.z+=shadowBias;
		bvec4 inFrustumVec=bvec4(shadowCoord.x>=0.0,shadowCoord.x<=1.0,shadowCoord.y>=0.0,shadowCoord.y<=1.0);
		bool inFrustum=all(inFrustumVec);
		bvec2 frustumTestVec=bvec2(inFrustum,shadowCoord.z<=1.0);
		bool frustumTest=all(frustumTestVec);
		if(frustumTest){
		#if defined(SHADOWMAP_TYPE_PCF)
			vec2 texelSize=vec2(1.0)/ shadowMapSize;
			float dx0=-texelSize.x*shadowRadius;
			float dy0=-texelSize.y*shadowRadius;
			float dx1=+texelSize.x*shadowRadius;
			float dy1=+texelSize.y*shadowRadius;
			shadow=(
				texture2DCompare(shadowMap,shadowCoord.xy+vec2(dx0,dy0),shadowCoord.z)+
				texture2DCompare(shadowMap,shadowCoord.xy+vec2(0.0,dy0),shadowCoord.z)+
				texture2DCompare(shadowMap,shadowCoord.xy+vec2(dx1,dy0),shadowCoord.z)+
				texture2DCompare(shadowMap,shadowCoord.xy+vec2(dx0,0.0),shadowCoord.z)+
				texture2DCompare(shadowMap,shadowCoord.xy,shadowCoord.z)+
				texture2DCompare(shadowMap,shadowCoord.xy+vec2(dx1,0.0),shadowCoord.z)+
				texture2DCompare(shadowMap,shadowCoord.xy+vec2(dx0,dy1),shadowCoord.z)+
				texture2DCompare(shadowMap,shadowCoord.xy+vec2(0.0,dy1),shadowCoord.z)+
				texture2DCompare(shadowMap,shadowCoord.xy+vec2(dx1,dy1),shadowCoord.z)
		)*(1.0 / 9.0);
		#elif defined(SHADOWMAP_TYPE_PCF_SOFT)
			vec2 texelSize=vec2(1.0)/ shadowMapSize;
			float dx0=-texelSize.x*shadowRadius;
			float dy0=-texelSize.y*shadowRadius;
			float dx1=+texelSize.x*shadowRadius;
			float dy1=+texelSize.y*shadowRadius;
			shadow=(
				texture2DShadowLerp(shadowMap,shadowMapSize,shadowCoord.xy+vec2(dx0,dy0),shadowCoord.z)+
				texture2DShadowLerp(shadowMap,shadowMapSize,shadowCoord.xy+vec2(0.0,dy0),shadowCoord.z)+
				texture2DShadowLerp(shadowMap,shadowMapSize,shadowCoord.xy+vec2(dx1,dy0),shadowCoord.z)+
				texture2DShadowLerp(shadowMap,shadowMapSize,shadowCoord.xy+vec2(dx0,0.0),shadowCoord.z)+
				texture2DShadowLerp(shadowMap,shadowMapSize,shadowCoord.xy,shadowCoord.z)+
				texture2DShadowLerp(shadowMap,shadowMapSize,shadowCoord.xy+vec2(dx1,0.0),shadowCoord.z)+
				texture2DShadowLerp(shadowMap,shadowMapSize,shadowCoord.xy+vec2(dx0,dy1),shadowCoord.z)+
				texture2DShadowLerp(shadowMap,shadowMapSize,shadowCoord.xy+vec2(0.0,dy1),shadowCoord.z)+
				texture2DShadowLerp(shadowMap,shadowMapSize,shadowCoord.xy+vec2(dx1,dy1),shadowCoord.z)
		)*(1.0 / 9.0);
		#else
			shadow=texture2DCompare(shadowMap,shadowCoord.xy,shadowCoord.z);
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV(vec3 v,float texelSizeY){
		vec3 absV=abs(v);
		float scaleToCube=1.0 / max(absV.x,max(absV.y,absV.z));
		absV*=scaleToCube;
		v*=scaleToCube*(1.0-2.0*texelSizeY);
		vec2 planar=v.xy;
		float almostATexel=1.5*texelSizeY;
		float almostOne=1.0-almostATexel;
		if(absV.z>=almostOne){
			if(v.z>0.0)
				planar.x=4.0-v.x;
		} else if(absV.x>=almostOne){
			float signX=sign(v.x);
			planar.x=v.z*signX+2.0*signX;
		} else if(absV.y>=almostOne){
			float signY=sign(v.y);
			planar.x=v.x+2.0*signY+2.0;
			planar.y=v.z*signY-2.0;
		}
		return vec2(0.125,0.25)*planar+vec2(0.375,0.75);
	}
	float getPointShadow(sampler2D shadowMap,vec2 shadowMapSize,float shadowBias,float shadowRadius,vec4 shadowCoord,float shadowCameraNear,float shadowCameraFar){
		vec2 texelSize=vec2(1.0)/(shadowMapSize*vec2(4.0,2.0));
		vec3 lightToPosition=shadowCoord.xyz;
		float dp=(length(lightToPosition)-shadowCameraNear)/(shadowCameraFar-shadowCameraNear);
		dp+=shadowBias;
		vec3 bd3D=normalize(lightToPosition);
		#if defined(SHADOWMAP_TYPE_PCF)|| defined(SHADOWMAP_TYPE_PCF_SOFT)
			vec2 offset=vec2(-1,1)*shadowRadius*texelSize.y;
			return(
				texture2DCompare(shadowMap,cubeToUV(bd3D+offset.xyy,texelSize.y),dp)+
				texture2DCompare(shadowMap,cubeToUV(bd3D+offset.yyy,texelSize.y),dp)+
				texture2DCompare(shadowMap,cubeToUV(bd3D+offset.xyx,texelSize.y),dp)+
				texture2DCompare(shadowMap,cubeToUV(bd3D+offset.yyx,texelSize.y),dp)+
				texture2DCompare(shadowMap,cubeToUV(bd3D,texelSize.y),dp)+
				texture2DCompare(shadowMap,cubeToUV(bd3D+offset.xxy,texelSize.y),dp)+
				texture2DCompare(shadowMap,cubeToUV(bd3D+offset.yxy,texelSize.y),dp)+
				texture2DCompare(shadowMap,cubeToUV(bd3D+offset.xxx,texelSize.y),dp)+
				texture2DCompare(shadowMap,cubeToUV(bd3D+offset.yxx,texelSize.y),dp)
		)*(1.0 / 9.0);
		#else
			return texture2DCompare(shadowMap,cubeToUV(bd3D,texelSize.y),dp);
		#endif
	}
#endif`,logdepthbuf_pars_fragment:`#ifdef USE_LOGDEPTHBUF
uniform float logDepthBufFC;
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
	#endif
#endif`,clipping_planes_pars_fragment:`#if NUM_CLIPPING_PLANES>0
#if ! defined(PHYSICAL)&& ! defined(PHONG)
		varying vec3 vViewPosition;
	#endif
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_fragment:`#if NUM_CLIPPING_PLANES>0
vec4 plane;
	#pragma unroll_loop
	for(int i=0; i<UNION_CLIPPING_PLANES; i++){
		plane=clippingPlanes[ i ];
		if(dot(vViewPosition,plane.xyz)>plane.w)discard;
	}
	#if UNION_CLIPPING_PLANES<NUM_CLIPPING_PLANES
		bool clipped=true;
		#pragma unroll_loop
		for(int i=UNION_CLIPPING_PLANES; i<NUM_CLIPPING_PLANES; i++){
			plane=clippingPlanes[ i ];
			clipped=(dot(vViewPosition,plane.xyz)>plane.w)&& clipped;
		}
		if(clipped)discard;
	#endif
#endif`,logdepthbuf_fragment:`#if defined(USE_LOGDEPTHBUF)&& defined(USE_LOGDEPTHBUF_EXT)
gl_FragDepthEXT=log2(vFragDepth)*logDepthBufFC*0.5;
#endif`,map_particle_fragment:`#ifdef USE_MAP
vec2 uv=(uvTransform*vec3(gl_PointCoord.x,1.0-gl_PointCoord.y,1)).xy;
	vec4 mapTexel=texture2D(map,uv);
	diffuseColor*=mapTexelToLinear(mapTexel);
#endif`,color_fragment:`#ifdef USE_COLOR
diffuseColor.rgb*=vColor;
#endif`,alphatest_fragment:`#ifdef ALPHATEST
if(diffuseColor.a<ALPHATEST)discard;
#endif`,premultiplied_alpha_fragment:`#ifdef PREMULTIPLIED_ALPHA
gl_FragColor.rgb*=gl_FragColor.a;
#endif`,tonemapping_fragment:`#if defined(TONE_MAPPING)
  gl_FragColor.rgb=toneMapping(gl_FragColor.rgb);
#endif`,encodings_fragment:"  gl_FragColor=linearToOutputTexel(gl_FragColor);",fog_fragment:`#ifdef USE_FOG
#ifdef FOG_EXP2
		float fogFactor=whiteCompliment(exp2(-fogDensity*fogDensity*fogDepth*fogDepth*LOG2));
	#else
		float fogFactor=smoothstep(fogNear,fogFar,fogDepth);
	#endif
	gl_FragColor.rgb=mix(gl_FragColor.rgb,fogColor,fogFactor);
#endif`});var dt=Object.freeze({__proto__:null,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main(){
#include <color_vertex>
	#include <begin_vertex>
	#include <project_vertex>
	#ifdef USE_SIZEATTENUATION
		gl_PointSize=size*(scale /-mvPosition.z);
	#else
		gl_PointSize=size;
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,color_pars_vertex:`#ifdef USE_COLOR
varying vec3 vColor;
#endif`,fog_pars_vertex:`#ifdef USE_FOG
  varying float fogDepth;
#endif`,shadowmap_pars_vertex:`#ifdef USE_SHADOWMAP
#if NUM_DIR_LIGHTS>0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];
	#endif
	#if NUM_SPOT_LIGHTS>0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];
	#endif
	#if NUM_POINT_LIGHTS>0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];
	#endif
#endif`,logdepthbuf_pars_vertex:`#ifdef USE_LOGDEPTHBUF
#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
	#endif
	uniform float logDepthBufFC;
#endif`,clipping_planes_pars_vertex:`#if NUM_CLIPPING_PLANES>0 && ! defined(PHYSICAL)&& ! defined(PHONG)
varying vec3 vViewPosition;
#endif`,color_vertex:`#ifdef USE_COLOR
vColor.xyz=color.xyz;
#endif`,begin_vertex:`
vec3 transformed=vec3(position);`,project_vertex:`vec4 mvPosition=modelViewMatrix*vec4(transformed,1.0);
gl_Position=projectionMatrix*mvPosition;`,logdepthbuf_vertex:`#ifdef USE_LOGDEPTHBUF
#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth=1.0+gl_Position.w;
	#else
		gl_Position.z=log2(max(EPSILON,gl_Position.w+1.0))*logDepthBufFC-1.0;
		gl_Position.z*=gl_Position.w;
	#endif
#endif`,clipping_planes_vertex:`#if NUM_CLIPPING_PLANES>0 && ! defined(PHYSICAL)&& ! defined(PHONG)
vViewPosition=-mvPosition.xyz;
#endif`,worldpos_vertex:`#if defined(USE_ENVMAP)|| defined(DISTANCE)|| defined(USE_SHADOWMAP)
vec4 worldPosition=modelMatrix*vec4(transformed,1.0);
#endif`,shadowmap_vertex:`#ifdef USE_SHADOWMAP
#if NUM_DIR_LIGHTS>0
	#pragma unroll_loop
	for(int i=0; i<NUM_DIR_LIGHTS; i++){
		vDirectionalShadowCoord[ i ]=directionalShadowMatrix[ i ]*worldPosition;
	}
	#endif
	#if NUM_SPOT_LIGHTS>0
	#pragma unroll_loop
	for(int i=0; i<NUM_SPOT_LIGHTS; i++){
		vSpotShadowCoord[ i ]=spotShadowMatrix[ i ]*worldPosition;
	}
	#endif
	#if NUM_POINT_LIGHTS>0
	#pragma unroll_loop
	for(int i=0; i<NUM_POINT_LIGHTS; i++){
		vPointShadowCoord[ i ]=pointShadowMatrix[ i ]*worldPosition;
	}
	#endif
#endif`,fog_vertex:`
#ifdef USE_FOG
fogDepth=-mvPosition.z;
#endif`});var ft=Object.freeze({__proto__:null,tonemapping_pars_fragment:`#ifndef saturate
#define saturate(a)clamp(a,0.0,1.0)
#endif
uniform float toneMappingExposure;
uniform float toneMappingWhitePoint;
vec3 LinearToneMapping(vec3 color){
	return toneMappingExposure*color;
}
vec3 ReinhardToneMapping(vec3 color){
	color*=toneMappingExposure;
	return saturate(color /(vec3(1.0)+color));
}
#define Uncharted2Helper(x)max(((x*(0.15*x+0.10*0.50)+0.20*0.02)/(x*(0.15*x+0.50)+0.20*0.30))-0.02 / 0.30,vec3(0.0))
vec3 Uncharted2ToneMapping(vec3 color){
	color*=toneMappingExposure;
	return saturate(Uncharted2Helper(color)/ Uncharted2Helper(vec3(toneMappingWhitePoint)));
}
vec3 OptimizedCineonToneMapping(vec3 color){
	color*=toneMappingExposure;
	color=max(vec3(0.0),color-0.004);
	return pow((color*(6.2*color+0.5))/(color*(6.2*color+1.7)+0.06),vec3(2.2));
}`});var mt=Object.freeze({__proto__:null,encodings_pars_fragment:`
vec4 LinearToLinear(in vec4 value){
return value;
}
vec4 GammaToLinear(in vec4 value,in float gammaFactor){
	return vec4(pow(value.xyz,vec3(gammaFactor)),value.w);
}
vec4 LinearToGamma(in vec4 value,in float gammaFactor){
	return vec4(pow(value.xyz,vec3(1.0 / gammaFactor)),value.w);
}
vec4 sRGBToLinear(in vec4 value){
	return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.w);
}
vec4 LinearTosRGB(in vec4 value){
	return vec4(mix(pow(value.rgb,vec3(0.41666))*1.055-vec3(0.055),value.rgb*12.92,vec3(lessThanEqual(value.rgb,vec3(0.0031308)))),value.w);
}
vec4 RGBEToLinear(in vec4 value){
	return vec4(value.rgb*exp2(value.a*255.0-128.0),1.0);
}
vec4 LinearToRGBE(in vec4 value){
	float maxComponent=max(max(value.r,value.g),value.b);
	float fExp=clamp(ceil(log2(maxComponent)),-128.0,127.0);
	return vec4(value.rgb / exp2(fExp),(fExp+128.0)/ 255.0);
}
vec4 RGBMToLinear(in vec4 value,in float maxRange){
	return vec4(value.xyz*value.w*maxRange,1.0);
}
vec4 LinearToRGBM(in vec4 value,in float maxRange){
	float maxRGB=max(value.x,max(value.g,value.b));
	float M     =clamp(maxRGB / maxRange,0.0,1.0);
	M           =ceil(M*255.0)/ 255.0;
	return vec4(value.rgb /(M*maxRange),M);
}
vec4 RGBDToLinear(in vec4 value,in float maxRange){
	return vec4(value.rgb*((maxRange / 255.0)/ value.a),1.0);
}
vec4 LinearToRGBD(in vec4 value,in float maxRange){
	float maxRGB=max(value.x,max(value.g,value.b));
	float D     =max(maxRange / maxRGB,1.0);
	D           =min(floor(D)/ 255.0,1.0);
	return vec4(value.rgb*(D*(255.0 / maxRange)),D);
}
const mat3 cLogLuvM=mat3(0.2209,0.3390,0.4184,0.1138,0.6780,0.7319,0.0102,0.1130,0.2969);
vec4 LinearToLogLuv(in vec4 value) {
	vec3 Xp_Y_XYZp=value.rgb*cLogLuvM;
	Xp_Y_XYZp=max(Xp_Y_XYZp,vec3(1e-6,1e-6,1e-6));
	vec4 vResult;
	vResult.xy=Xp_Y_XYZp.xy / Xp_Y_XYZp.z;
	float Le=2.0*log2(Xp_Y_XYZp.y)+127.0;
	vResult.w=fract(Le);
	vResult.z=(Le-(floor(vResult.w*255.0))/255.0)/255.0;
	return vResult;
}
const mat3 cLogLuvInverseM=mat3(6.0014,-2.7008,-1.7996,-1.3320,3.1029,-5.7721,0.3008,-1.0882,5.6268);
vec4 LogLuvToLinear(in vec4 value){
	float Le=value.z*255.0+value.w;
	vec3 Xp_Y_XYZp;
	Xp_Y_XYZp.y=exp2((Le-127.0)/ 2.0);
	Xp_Y_XYZp.z=Xp_Y_XYZp.y / value.y;
	Xp_Y_XYZp.x=value.x*Xp_Y_XYZp.z;
	vec3 vRGB=Xp_Y_XYZp.rgb*cLogLuvInverseM;
	return vec4(max(vRGB,0.0),1.0);
}`});const vt=Object.assign({},pt,dt,ft,mt);var gt={basic:{uniforms:ct.merge([lt.common,lt.specularmap,lt.envmap,lt.aomap,lt.lightmap,lt.fog]),vertexShader:vt.meshbasic_vert,fragmentShader:vt.meshbasic_frag},lambert:{uniforms:ct.merge([lt.common,lt.specularmap,lt.envmap,lt.aomap,lt.lightmap,lt.emissivemap,lt.fog,lt.lights,{emissive:{value:new ut(0)}}]),vertexShader:vt.meshlambert_vert,fragmentShader:vt.meshlambert_frag},phong:{uniforms:ct.merge([lt.common,lt.specularmap,lt.envmap,lt.aomap,lt.lightmap,lt.emissivemap,lt.bumpmap,lt.normalmap,lt.displacementmap,lt.gradientmap,lt.fog,lt.lights,{emissive:{value:new ut(0)},specular:{value:new ut(1118481)},shininess:{value:30}}]),vertexShader:vt.meshphong_vert,fragmentShader:vt.meshphong_frag},standard:{uniforms:ct.merge([lt.common,lt.envmap,lt.aomap,lt.lightmap,lt.emissivemap,lt.bumpmap,lt.normalmap,lt.displacementmap,lt.roughnessmap,lt.metalnessmap,lt.fog,lt.lights,{emissive:{value:new ut(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:vt.meshphysical_vert,fragmentShader:vt.meshphysical_frag},points:{uniforms:ct.merge([lt.points,lt.fog]),vertexShader:vt.points_vert,fragmentShader:vt.points_frag},dashed:{uniforms:ct.merge([lt.common,lt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:vt.linedashed_vert,fragmentShader:vt.linedashed_frag},depth:{uniforms:ct.merge([lt.common,lt.displacementmap]),vertexShader:vt.depth_vert,fragmentShader:vt.depth_frag},normal:{uniforms:ct.merge([lt.common,lt.bumpmap,lt.normalmap,lt.displacementmap,{opacity:{value:1}}]),vertexShader:vt.normal_vert,fragmentShader:vt.normal_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:vt.cube_vert,fragmentShader:vt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:vt.equirect_vert,fragmentShader:vt.equirect_frag},distanceRGBA:{uniforms:ct.merge([lt.common,lt.displacementmap,{referencePosition:{value:new m},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:vt.distanceRGBA_vert,fragmentShader:vt.distanceRGBA_frag},shadow:{uniforms:ct.merge([lt.lights,lt.fog,{color:{value:new ut(0)},opacity:{value:1}}]),vertexShader:vt.shadow_vert,fragmentShader:vt.shadow_frag}};function yt(t,e,i,r,n,a,s,o,h){y.call(this,t,e,i,r,n,a,s,o,h),this.needsUpdate=!0}function xt(t,e,i,r,n){var a,s,o,h,u,l,c=new m,p=new f,d=new m;function v(){var t=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),i=new Uint16Array([0,1,2,0,2,3]);a=e.createBuffer(),s=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,a),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,s),e.bufferData(e.ELEMENT_ARRAY_BUFFER,i,e.STATIC_DRAW),o=function(){var t=e.createProgram(),i=e.createShader(e.VERTEX_SHADER),r=e.createShader(e.FRAGMENT_SHADER);return e.shaderSource(i,["precision "+n.precision+" float;","#define SHADER_NAME SpriteMaterial","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 center;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float fogDepth;","void main() {",`	vUV = uvOffset + uv * uvScale;`,`	vec2 alignedPosition = ( position - center ) * scale;`,`	vec2 rotatedPosition;`,`	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;`,`	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;`,`	vec4 mvPosition;`,`	mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );`,`	mvPosition.xy += rotatedPosition;`,`	gl_Position = projectionMatrix * mvPosition;`,`	fogDepth = - mvPosition.z;`,"}"].join("\n")),e.shaderSource(r,["precision "+n.precision+" float;","#define SHADER_NAME SpriteMaterial","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","varying float fogDepth;","void main() {",`	vec4 texture = texture2D( map, vUV );`,`	gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );`,`	if ( gl_FragColor.a < alphaTest ) discard;`,`	if ( fogType > 0 ) {`,`		float fogFactor = 0.0;`,`		if ( fogType == 1 ) {`,`			fogFactor = smoothstep( fogNear, fogFar, fogDepth );`,`		} else {`,`			const float LOG2 = 1.442695;`,`			fogFactor = exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 );`,`			fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );`,`		}`,`		gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );`,"\t}","}"].join("\n")),e.compileShader(i),e.compileShader(r),e.attachShader(t,i),e.attachShader(t,r),e.linkProgram(t),t}(),h={position:e.getAttribLocation(o,"position"),uv:e.getAttribLocation(o,"uv")},u={uvOffset:e.getUniformLocation(o,"uvOffset"),uvScale:e.getUniformLocation(o,"uvScale"),rotation:e.getUniformLocation(o,"rotation"),center:e.getUniformLocation(o,"center"),scale:e.getUniformLocation(o,"scale"),color:e.getUniformLocation(o,"color"),map:e.getUniformLocation(o,"map"),opacity:e.getUniformLocation(o,"opacity"),modelViewMatrix:e.getUniformLocation(o,"modelViewMatrix"),projectionMatrix:e.getUniformLocation(o,"projectionMatrix"),fogType:e.getUniformLocation(o,"fogType"),fogDensity:e.getUniformLocation(o,"fogDensity"),fogNear:e.getUniformLocation(o,"fogNear"),fogFar:e.getUniformLocation(o,"fogFar"),fogColor:e.getUniformLocation(o,"fogColor"),fogDepth:e.getUniformLocation(o,"fogDepth"),alphaTest:e.getUniformLocation(o,"alphaTest")};var r=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");r.width=8,r.height=8;var c=r.getContext("2d");c.fillStyle="white",c.fillRect(0,0,8,8),l=new yt(r)}function g(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:e.id-t.id}this.render=function(n,f,m){if(0!==n.length){void 0===o&&v(),i.useProgram(o),i.initAttributes(),i.enableAttribute(h.position),i.enableAttribute(h.uv),i.disableUnusedAttributes(),i.disable(e.CULL_FACE),i.enable(e.BLEND),e.bindBuffer(e.ARRAY_BUFFER,a),e.vertexAttribPointer(h.position,2,e.FLOAT,!1,16,0),e.vertexAttribPointer(h.uv,2,e.FLOAT,!1,16,8),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,s),e.uniformMatrix4fv(u.projectionMatrix,!1,m.projectionMatrix.elements),i.activeTexture(e.TEXTURE0),e.uniform1i(u.map,0);var y=0,x=0,w=f.fog;w?(e.uniform3f(u.fogColor,w.color.r,w.color.g,w.color.b),w.isFog?(e.uniform1f(u.fogNear,w.near),e.uniform1f(u.fogFar,w.far),e.uniform1i(u.fogType,1),y=1,x=1):w.isFogExp2&&(e.uniform1f(u.fogDensity,w.density),e.uniform1i(u.fogType,2),y=2,x=2)):(e.uniform1i(u.fogType,0),y=0,x=0);for(var M=0,_=n.length;M<_;M++){(T=n[M]).modelViewMatrix.multiplyMatrices(m.matrixWorldInverse,T.matrixWorld),T.z=-T.modelViewMatrix.elements[14]}n.sort(g);var b=[],S=[];for(M=0,_=n.length;M<_;M++){var T,E=(T=n[M]).material;if(!1!==E.visible){T.onBeforeRender(t,f,m,void 0,E,void 0),e.uniform1f(u.alphaTest,E.alphaTest),e.uniformMatrix4fv(u.modelViewMatrix,!1,T.modelViewMatrix.elements),T.matrixWorld.decompose(c,p,d),b[0]=d.x,b[1]=d.y,S[0]=T.center.x-.5,S[1]=T.center.y-.5;var A=0;f.fog&&E.fog&&(A=x),y!==A&&(e.uniform1i(u.fogType,A),y=A),null!==E.map?(e.uniform2f(u.uvOffset,E.map.offset.x,E.map.offset.y),e.uniform2f(u.uvScale,E.map.repeat.x,E.map.repeat.y)):(e.uniform2f(u.uvOffset,0,0),e.uniform2f(u.uvScale,1,1)),e.uniform1f(u.opacity,E.opacity),e.uniform3f(u.color,E.color.r,E.color.g,E.color.b),e.uniform1f(u.rotation,E.rotation),e.uniform2fv(u.center,S),e.uniform2fv(u.scale,b),i.setBlending(E.blending,E.blendEquation,E.blendSrc,E.blendDst,E.blendEquationAlpha,E.blendSrcAlpha,E.blendDstAlpha,E.premultipliedAlpha),i.buffers.depth.setTest(E.depthTest),i.buffers.depth.setMask(E.depthWrite),i.buffers.color.setMask(E.colorWrite),r.setTexture2D(E.map||l,0),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0),T.onAfterRender(t,f,m,void 0,E,void 0)}}i.enable(e.CULL_FACE),i.reset()}}}gt.physical={uniforms:ct.merge([gt.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:vt.meshphysical_vert,fragmentShader:vt.meshphysical_frag},yt.prototype=Object.create(y.prototype),yt.prototype.constructor=yt;var wt,Mt,_t,bt,St,Tt,Et,At=0;function Pt(){Object.defineProperty(this,"id",{value:At++}),this.uuid=c.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=1,this.side=0,this.flatShading=!1,this.vertexColors=0,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.overdraw=0,this.visible=!0,this.userData={},this.needsUpdate=!0}function Ct(t){Pt.call(this),this.type="MeshDepthMaterial",this.depthPacking=3200,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(t)}function Nt(t){Pt.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new m,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.lights=!1,this.setValues(t)}function zt(t,e){this.min=void 0!==t?t:new m(1/0,1/0,1/0),this.max=void 0!==e?e:new m(-1/0,-1/0,-1/0)}function Rt(t,e){this.center=void 0!==t?t:new m,this.radius=void 0!==e?e:0}function Ot(t,e){this.normal=void 0!==t?t:new m(1,0,0),this.constant=void 0!==e?e:0}function Lt(t,e,i,r,n,a){this.planes=[void 0!==t?t:new Ot,void 0!==e?e:new Ot,void 0!==i?i:new Ot,void 0!==r?r:new Ot,void 0!==n?n:new Ot,void 0!==a?a:new Ot]}function Ut(t,e,i){for(var r=new Lt,n=new d,a=new p,s=new p(i,i),o=new m,h=new m,u=new Array(4),l=new Array(4),c={},f={0:1,1:0,2:2},v=[new m(1,0,0),new m(-1,0,0),new m(0,0,1),new m(0,0,-1),new m(0,1,0),new m(0,-1,0)],g=[new m(0,1,0),new m(0,1,0),new m(0,1,0),new m(0,1,0),new m(0,0,1),new m(0,0,-1)],y=[new x,new x,new x,new x,new x,new x],M=0;4!==M;++M){var _=0!=(1&M),b=0!=(2&M),S=new Ct({depthPacking:3201,morphTargets:_,skinning:b});u[M]=S;var T=new Nt({morphTargets:_,skinning:b});l[M]=T}var E=this;function A(e,i,r,n,a,s){var o=e.geometry,h=null,p=u,d=e.customDepthMaterial;if(r&&(p=l,d=e.customDistanceMaterial),d)h=d;else{var m=!1;i.morphTargets&&(o&&o.isBufferGeometry?m=o.morphAttributes&&o.morphAttributes.position&&o.morphAttributes.position.length>0:o&&o.isGeometry&&(m=o.morphTargets&&o.morphTargets.length>0)),e.isSkinnedMesh&&i.skinning;var v=0;m&&(v|=1),e.isSkinnedMesh&&i.skinning&&(v|=2),h=p[v]}if(t.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length){var g=h.uuid,y=i.uuid,x=c[g];void 0===x&&(x={},c[g]=x);var w=x[y];void 0===w&&(w=h.clone(),x[y]=w),h=w}return h.visible=i.visible,h.wireframe=i.wireframe,h.side=null!=i.shadowSide?i.shadowSide:f[i.side],h.clipShadows=i.clipShadows,h.clippingPlanes=i.clippingPlanes,h.clipIntersection=i.clipIntersection,h.wireframeLinewidth=i.wireframeLinewidth,h.linewidth=i.linewidth,r&&h.isMeshDistanceMaterial&&(h.referencePosition.copy(n),h.nearDistance=a,h.farDistance=s),h}function P(i,n,a,s){if(!1!==i.visible){if(i.layers.test(n.layers)&&(i.isMesh||i.isLine||i.isPoints)&&i.castShadow&&(!i.frustumCulled||r.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,i.matrixWorld);var o=e.update(i),u=i.material;if(Array.isArray(u))for(var l=o.groups,c=0,p=l.length;c<p;c++){var d=l[c],f=u[d.materialIndex];if(f&&f.visible){var m=A(i,f,s,h,a.near,a.far);t.renderBufferDirect(a,null,o,m,i,d)}}else if(u.visible){m=A(i,u,s,h,a.near,a.far);t.renderBufferDirect(a,null,o,m,i,null)}}for(var v=i.children,g=0,y=v.length;g<y;g++)P(v[g],n,a,s)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(e,i,u){if(!1!==E.enabled&&(!1!==E.autoUpdate||!1!==E.needsUpdate)&&0!==e.length){var l,c=t.context,p=t.state;p.disable(c.BLEND),p.buffers.color.setClear(1,1,1,1),p.buffers.depth.setTest(!0),p.setScissorTest(!1);for(var d=0,f=e.length;d<f;d++){var m=e[d],x=m.shadow,M=m&&m.isPointLight;if(void 0!==x){var _=x.camera;if(a.copy(x.mapSize),a.min(s),M){var b=a.x,S=a.y;y[0].set(2*b,S,b,S),y[1].set(0,S,b,S),y[2].set(3*b,S,b,S),y[3].set(b,S,b,S),y[4].set(3*b,0,b,S),y[5].set(b,0,b,S),a.x*=4,a.y*=2}if(null===x.map){var T={minFilter:1003,magFilter:1003,format:1023};x.map=new w(a.x,a.y,T),x.map.texture.name=m.name+".shadowMap",_.updateProjectionMatrix()}x.isSpotLightShadow&&x.update(m);var A=x.map,C=x.matrix;h.setFromMatrixPosition(m.matrixWorld),_.position.copy(h),M?(l=6,C.makeTranslation(-h.x,-h.y,-h.z)):(l=1,o.setFromMatrixPosition(m.target.matrixWorld),_.lookAt(o),_.updateMatrixWorld(),C.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),C.multiply(_.projectionMatrix),C.multiply(_.matrixWorldInverse)),t.setRenderTarget(A),t.clear();for(var N=0;N<l;N++){if(M){o.copy(_.position),o.add(v[N]),_.up.copy(g[N]),_.lookAt(o),_.updateMatrixWorld();var z=y[N];p.viewport(z)}n.multiplyMatrices(_.projectionMatrix,_.matrixWorldInverse),r.setFromMatrix(n),P(i,u,_,M)}}}E.needsUpdate=!1}}}function Dt(t){var e={};return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),e[t.uuid]},remove:function(i){i.isInterleavedBufferAttribute&&(i=i.data);var r=e[i.uuid];r&&(t.deleteBuffer(r.buffer),delete e[i.uuid])},update:function(i,r){i.isInterleavedBufferAttribute&&(i=i.data);var n=e[i.uuid];void 0===n?e[i.uuid]=function(e,i){var r=e.array,n=e.dynamic?t.DYNAMIC_DRAW:t.STATIC_DRAW,a=t.createBuffer();t.bindBuffer(i,a),t.bufferData(i,r,n),e.onUploadCallback();var s=t.FLOAT;return r instanceof Float32Array?s=t.FLOAT:r instanceof Float64Array||(r instanceof Uint16Array?s=t.UNSIGNED_SHORT:r instanceof Int16Array?s=t.SHORT:r instanceof Uint32Array?s=t.UNSIGNED_INT:r instanceof Int32Array?s=t.INT:r instanceof Int8Array?s=t.BYTE:r instanceof Uint8Array&&(s=t.UNSIGNED_BYTE)),{buffer:a,type:s,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version}}(i,r):n.version<i.version&&(!function(e,i,r){var n=i.array,a=i.updateRange;t.bindBuffer(r,e),!1===i.dynamic?t.bufferData(r,n,t.STATIC_DRAW):-1===a.count?t.bufferSubData(r,0,n):0===a.count||(t.bufferSubData(r,a.offset*n.BYTES_PER_ELEMENT,n.subarray(a.offset,a.offset+a.count)),a.count=-1)}(n.buffer,i,r),n.version=i.version)}}}function Ft(t,e,i,r){this._x=t||0,this._y=e||0,this._z=i||0,this._order=r||Ft.DefaultOrder}function It(){this.mask=1}Pt.prototype=Object.assign(Object.create(t.prototype),{constructor:Pt,isMaterial:!0,onBeforeCompile:function(){},setValues:function(t){if(void 0!==t)for(var e in t){var i=t[e];if(void 0!==i)if("shading"!==e){var r=this[e];void 0!==r&&(r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[e]="overdraw"===e?Number(i):i)}else this.flatShading=1===i}},toJSON:function(t){var e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});var i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(t){var e=[];for(var i in t){var r=t[i];delete r.metadata,e.push(r)}return e}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearCoat&&(i.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(i.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,i.reflectivity=this.reflectivity),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.size&&(i.size=this.size),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(i.blending=this.blending),!0===this.flatShading&&(i.flatShading=this.flatShading),0!==this.side&&(i.side=this.side),0!==this.vertexColors&&(i.vertexColors=this.vertexColors),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,0!==this.rotation&&(i.rotation=this.rotation),1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(i.morphTargets=!0),!0===this.skinning&&(i.skinning=!0),!1===this.visible&&(i.visible=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),e){var n=r(t.textures),a=r(t.images);n.length>0&&(i.textures=n),a.length>0&&(i.images=a)}return i},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.lights=t.lights,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.overdraw=t.overdraw,this.visible=t.visible,this.userData=JSON.parse(JSON.stringify(t.userData)),this.clipShadows=t.clipShadows,this.clipIntersection=t.clipIntersection;var e=t.clippingPlanes,i=null;if(null!==e){var r=e.length;i=new Array(r);for(var n=0;n!==r;++n)i[n]=e[n].clone()}return this.clippingPlanes=i,this.shadowSide=t.shadowSide,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Ct.prototype=Object.create(Pt.prototype),Ct.prototype.constructor=Ct,Ct.prototype.isMeshDepthMaterial=!0,Ct.prototype.copy=function(t){return Pt.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},Nt.prototype=Object.create(Pt.prototype),Nt.prototype.constructor=Nt,Nt.prototype.isMeshDistanceMaterial=!0,Nt.prototype.copy=function(t){return Pt.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this},Object.assign(zt.prototype,{isBox3:!0,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromArray:function(t){for(var e=1/0,i=1/0,r=1/0,n=-1/0,a=-1/0,s=-1/0,o=0,h=t.length;o<h;o+=3){var u=t[o],l=t[o+1],c=t[o+2];u<e&&(e=u),l<i&&(i=l),c<r&&(r=c),u>n&&(n=u),l>a&&(a=l),c>s&&(s=c)}return this.min.set(e,i,r),this.max.set(n,a,s),this},setFromBufferAttribute:function(t){for(var e=1/0,i=1/0,r=1/0,n=-1/0,a=-1/0,s=-1/0,o=0,h=t.count;o<h;o++){var u=t.getX(o),l=t.getY(o),c=t.getZ(o);u<e&&(e=u),l<i&&(i=l),c<r&&(r=c),u>n&&(n=u),l>a&&(a=l),c>s&&(s=c)}return this.min.set(e,i,r),this.max.set(n,a,s),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(){var t=new m;return function(e,i){var r=t.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}}(),setFromObject:function(t){return this.makeEmpty(),this.expandByObject(t)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(t){var e=t||new m;return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){var e=t||new m;return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},expandByObject:function(){var t,e,i,r=new m;function n(n){var a=n.geometry;if(void 0!==a)if(a.isGeometry){var s=a.vertices;for(e=0,i=s.length;e<i;e++)r.copy(s[e]),r.applyMatrix4(n.matrixWorld),t.expandByPoint(r)}else if(a.isBufferGeometry){var o=a.attributes.position;if(void 0!==o)for(e=0,i=o.count;e<i;e++)r.fromBufferAttribute(o,e).applyMatrix4(n.matrixWorld),t.expandByPoint(r)}}return function(e){return t=this,e.updateMatrixWorld(!0),e.traverse(n),this}}(),containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,e){return(e||new m).set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:(Mt=new m,function(t){return this.clampPoint(t.center,Mt),Mt.distanceToSquared(t.center)<=t.radius*t.radius}),intersectsPlane:function(t){var e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=t.constant&&i>=t.constant},intersectsTriangle:function(){var t=new m,e=new m,i=new m,r=new m,n=new m,a=new m,s=new m,o=new m,h=new m,u=new m;function l(r){var n,a;for(n=0,a=r.length-3;n<=a;n+=3){s.fromArray(r,n);var o=h.x*Math.abs(s.x)+h.y*Math.abs(s.y)+h.z*Math.abs(s.z),u=t.dot(s),l=e.dot(s),c=i.dot(s);if(Math.max(-Math.max(u,l,c),Math.min(u,l,c))>o)return!1}return!0}return function(s){if(this.isEmpty())return!1;this.getCenter(o),h.subVectors(this.max,o),t.subVectors(s.a,o),e.subVectors(s.b,o),i.subVectors(s.c,o),r.subVectors(e,t),n.subVectors(i,e),a.subVectors(t,i);var c=[0,-r.z,r.y,0,-n.z,n.y,0,-a.z,a.y,r.z,0,-r.x,n.z,0,-n.x,a.z,0,-a.x,-r.y,r.x,0,-n.y,n.x,0,-a.y,a.x,0];return!!l(c)&&(!!l(c=[1,0,0,0,1,0,0,0,1])&&(u.crossVectors(r,n),l(c=[u.x,u.y,u.z])))}}(),clampPoint:function(t,e){return(e||new m).copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new m;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),getBoundingSphere:function(){var t=new m;return function(e){var i=e||new Rt;return this.getCenter(i.center),i.radius=.5*this.getSize(t).length(),i}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:(wt=[new m,new m,new m,new m,new m,new m,new m,new m],function(t){return this.isEmpty()||(wt[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),wt[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),wt[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),wt[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),wt[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),wt[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),wt[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),wt[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(wt)),this}),translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}),Object.assign(Rt.prototype,{set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromPoints:(_t=new zt,function(t,e){var i=this.center;void 0!==e?i.copy(e):_t.setFromPoints(t).getCenter(i);for(var r=0,n=0,a=t.length;n<a;n++)r=Math.max(r,i.distanceToSquared(t[n]));return this.radius=Math.sqrt(r),this}),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return this.radius<=0},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},clampPoint:function(t,e){var i=this.center.distanceToSquared(t),r=e||new m;return r.copy(t),i>this.radius*this.radius&&(r.sub(this.center).normalize(),r.multiplyScalar(this.radius).add(this.center)),r},getBoundingBox:function(t){var e=t||new zt;return e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}}),Object.assign(Ot.prototype,{set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,i,r){return this.normal.set(t,e,i),this.constant=r,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:function(){var t=new m,e=new m;return function(i,r,n){var a=t.subVectors(n,r).cross(e.subVectors(i,r)).normalize();return this.setFromNormalAndCoplanarPoint(a,i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return(e||new m).copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)},intersectLine:function(){var t=new m;return function(e,i){var r=i||new m,n=e.delta(t),a=this.normal.dot(n);if(0===a)return 0===this.distanceToPoint(e.start)?r.copy(e.start):void 0;var s=-(e.start.dot(this.normal)+this.constant)/a;return s<0||s>1?void 0:r.copy(n).multiplyScalar(s).add(e.start)}}(),intersectsLine:function(t){var e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){return(t||new m).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var t=new m,e=new v;return function(i,r){var n=r||e.getNormalMatrix(i),a=this.coplanarPoint(t).applyMatrix4(i),s=this.normal.applyMatrix3(n).normalize();return this.constant=-a.dot(s),this}}(),translate:function(t){return this.constant-=t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}}),Object.assign(Lt.prototype,{set:function(t,e,i,r,n,a){var s=this.planes;return s[0].copy(t),s[1].copy(e),s[2].copy(i),s[3].copy(r),s[4].copy(n),s[5].copy(a),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){for(var e=this.planes,i=0;i<6;i++)e[i].copy(t.planes[i]);return this},setFromMatrix:function(t){var e=this.planes,i=t.elements,r=i[0],n=i[1],a=i[2],s=i[3],o=i[4],h=i[5],u=i[6],l=i[7],c=i[8],p=i[9],d=i[10],f=i[11],m=i[12],v=i[13],g=i[14],y=i[15];return e[0].setComponents(s-r,l-o,f-c,y-m).normalize(),e[1].setComponents(s+r,l+o,f+c,y+m).normalize(),e[2].setComponents(s+n,l+h,f+p,y+v).normalize(),e[3].setComponents(s-n,l-h,f-p,y-v).normalize(),e[4].setComponents(s-a,l-u,f-d,y-g).normalize(),e[5].setComponents(s+a,l+u,f+d,y+g).normalize(),this},intersectsObject:(Tt=new Rt,function(t){var e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),Tt.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(Tt)}),intersectsSprite:function(){var t=new Rt;return function(e){return t.center.set(0,0,0),t.radius=.7071067811865476,t.applyMatrix4(e.matrixWorld),this.intersectsSphere(t)}}(),intersectsSphere:function(t){for(var e=this.planes,i=t.center,r=-t.radius,n=0;n<6;n++){if(e[n].distanceToPoint(i)<r)return!1}return!0},intersectsBox:(bt=new m,St=new m,function(t){for(var e=this.planes,i=0;i<6;i++){var r=e[i];bt.x=r.normal.x>0?t.min.x:t.max.x,St.x=r.normal.x>0?t.max.x:t.min.x,bt.y=r.normal.y>0?t.min.y:t.max.y,St.y=r.normal.y>0?t.max.y:t.min.y,bt.z=r.normal.z>0?t.min.z:t.max.z,St.z=r.normal.z>0?t.max.z:t.min.z;var n=r.distanceToPoint(bt),a=r.distanceToPoint(St);if(n<0&&a<0)return!1}return!0}),containsPoint:function(t){for(var e=this.planes,i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}}),Ft.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Ft.DefaultOrder="XYZ",Object.defineProperties(Ft.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this.onChangeCallback()}}}),Object.assign(Ft.prototype,{isEuler:!0,set:function(t,e,i,r){return this._x=t,this._y=e,this._z=i,this._order=r||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this.onChangeCallback(),this},setFromRotationMatrix:function(t,e,i){var r=c.clamp,n=t.elements,a=n[0],s=n[4],o=n[8],h=n[1],u=n[5],l=n[9],p=n[2],d=n[6],f=n[10];return"XYZ"===(e=e||this._order)?(this._y=Math.asin(r(o,-1,1)),Math.abs(o)<.99999?(this._x=Math.atan2(-l,f),this._z=Math.atan2(-s,a)):(this._x=Math.atan2(d,u),this._z=0)):"YXZ"===e?(this._x=Math.asin(-r(l,-1,1)),Math.abs(l)<.99999?(this._y=Math.atan2(o,f),this._z=Math.atan2(h,u)):(this._y=Math.atan2(-p,a),this._z=0)):"ZXY"===e?(this._x=Math.asin(r(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-p,f),this._z=Math.atan2(-s,u)):(this._y=0,this._z=Math.atan2(h,a))):"ZYX"===e?(this._y=Math.asin(-r(p,-1,1)),Math.abs(p)<.99999?(this._x=Math.atan2(d,f),this._z=Math.atan2(h,a)):(this._x=0,this._z=Math.atan2(-s,u))):"YZX"===e?(this._z=Math.asin(r(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(-l,u),this._y=Math.atan2(-p,a)):(this._x=0,this._y=Math.atan2(o,f))):"XZY"===e&&(this._z=Math.asin(-r(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(d,u),this._y=Math.atan2(o,a)):(this._x=Math.atan2(-l,f),this._y=0)),this._order=e,!1!==i&&this.onChangeCallback(),this},setFromQuaternion:function(){var t=new d;return function(e,i,r){return t.makeRotationFromQuaternion(e),this.setFromRotationMatrix(t,i,r)}}(),setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:(Et=new f,function(t){return Et.setFromEuler(this),this.setFromQuaternion(Et,t)}),equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new m(this._x,this._y,this._z)},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}}),Object.assign(It.prototype,{set:function(t){this.mask=1<<t|0},enable:function(t){this.mask|=1<<t|0},toggle:function(t){this.mask^=1<<t|0},disable:function(t){this.mask&=~(1<<t|0)},test:function(t){return 0!=(this.mask&t.mask)}});var Bt,Gt,Vt,kt,Wt=0;function jt(){Object.defineProperty(this,"id",{value:Wt++}),this.uuid=c.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=jt.DefaultUp.clone();var t=new m,e=new Ft,i=new f,r=new m(1,1,1);e.onChange((function(){i.setFromEuler(e,!1)})),i.onChange((function(){e.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{enumerable:!0,value:t},rotation:{enumerable:!0,value:e},quaternion:{enumerable:!0,value:i},scale:{enumerable:!0,value:r},modelViewMatrix:{value:new d},normalMatrix:{value:new v}}),this.matrix=new d,this.matrixWorld=new d,this.matrixAutoUpdate=jt.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new It,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function Xt(){jt.call(this),this.type="Camera",this.matrixWorldInverse=new d,this.projectionMatrix=new d}function Ht(t,e,i,r,n,a){Xt.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=r,this.near=void 0!==n?n:.1,this.far=void 0!==a?a:2e3,this.updateProjectionMatrix()}function Yt(t,e,i,r,n,a){this.a=t,this.b=e,this.c=i,this.normal=r&&r.isVector3?r:new m,this.vertexNormals=Array.isArray(r)?r:[],this.color=n&&n.isColor?n:new ut,this.vertexColors=Array.isArray(n)?n:[],this.materialIndex=void 0!==a?a:0}jt.DefaultUp=new m(0,1,0),jt.DefaultMatrixAutoUpdate=!0,jt.prototype=Object.assign(Object.create(t.prototype),{constructor:jt,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(t){this.matrix.multiplyMatrices(t,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:(kt=new f,function(t,e){return kt.setFromAxisAngle(t,e),this.quaternion.multiply(kt),this}),rotateOnWorldAxis:function(){var t=new f;return function(e,i){return t.setFromAxisAngle(e,i),this.quaternion.premultiply(t),this}}(),rotateX:function(){var t=new m(1,0,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateY:function(){var t=new m(0,1,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateZ:function(){var t=new m(0,0,1);return function(e){return this.rotateOnAxis(t,e)}}(),translateOnAxis:function(){var t=new m;return function(e,i){return t.copy(e).applyQuaternion(this.quaternion),this.position.add(t.multiplyScalar(i)),this}}(),translateX:function(){var t=new m(1,0,0);return function(e){return this.translateOnAxis(t,e)}}(),translateY:function(){var t=new m(0,1,0);return function(e){return this.translateOnAxis(t,e)}}(),translateZ:function(){var t=new m(0,0,1);return function(e){return this.translateOnAxis(t,e)}}(),localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:(Vt=new d,function(t){return t.applyMatrix4(Vt.getInverse(this.matrixWorld))}),lookAt:function(){var t=new d,e=new m;return function(i,r,n){i.isVector3?e.copy(i):e.set(i,r,n),this.isCamera?t.lookAt(this.position,e,this.up):t.lookAt(e,this.position,this.up),this.quaternion.setFromRotationMatrix(t)}}(),add:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this||t&&t.isObject3D&&(null!==t.parent&&t.parent.remove(t),t.parent=this,t.dispatchEvent({type:"added"}),this.children.push(t)),this},remove:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}var i=this.children.indexOf(t);return-1!==i&&(t.parent=null,t.dispatchEvent({type:"removed"}),this.children.splice(i,1)),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(var i=0,r=this.children.length;i<r;i++){var n=this.children[i].getObjectByProperty(t,e);if(void 0!==n)return n}},getWorldPosition:function(t){var e=t||new m;return this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:(Bt=new m,Gt=new m,function(t){var e=t||new f;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(Bt,e,Gt),e}),getWorldRotation:function(){var t=new f;return function(e){var i=e||new Ft;return this.getWorldQuaternion(t),i.setFromQuaternion(t,this.rotation.order,!1)}}(),getWorldScale:function(){var t=new m,e=new f;return function(i){var r=i||new m;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(t,e,r),r}}(),getWorldDirection:function(){var t=new f;return function(e){var i=e||new m;return this.getWorldQuaternion(t),i.set(0,0,1).applyQuaternion(t)}}(),raycast:function(){},traverse:function(t){t(this);for(var e=this.children,i=0,r=e.length;i<r;i++)e[i].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var e=this.children,i=0,r=e.length;i<r;i++)e[i].traverseVisible(t)}},traverseAncestors:function(t){var e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=this.children,i=0,r=e.length;i<r;i++)e[i].updateMatrixWorld(t)},toJSON:function(t){var e=void 0===t||"string"==typeof t,i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var r={};function n(e,i){return void 0===e[i.uuid]&&(e[i.uuid]=i.toJSON(t)),i.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.matrix=this.matrix.toArray(),void 0!==this.geometry){r.geometry=n(t.geometries,this.geometry);var a=this.geometry.parameters;if(void 0!==a&&void 0!==a.shapes){var s=a.shapes;if(Array.isArray(s))for(var o=0,h=s.length;o<h;o++){var u=s[o];n(t.shapes,u)}else n(t.shapes,s)}}if(void 0!==this.material)if(Array.isArray(this.material)){var l=[];for(o=0,h=this.material.length;o<h;o++)l.push(n(t.materials,this.material[o]));r.material=l}else r.material=n(t.materials,this.material);if(this.children.length>0){r.children=[];for(o=0;o<this.children.length;o++)r.children.push(this.children[o].toJSON(t).object)}if(e){var c=m(t.geometries),p=m(t.materials),d=m(t.textures),f=m(t.images);s=m(t.shapes);c.length>0&&(i.geometries=c),p.length>0&&(i.materials=p),d.length>0&&(i.textures=d),f.length>0&&(i.images=f),s.length>0&&(i.shapes=s)}return i.object=r,i;function m(t){var e=[];for(var i in t){var r=t[i];delete r.metadata,e.push(r)}return e}},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e){if(void 0===e&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(var i=0;i<t.children.length;i++){var r=t.children[i];this.add(r.clone())}return this}}),Xt.prototype=Object.assign(Object.create(jt.prototype),{constructor:Xt,isCamera:!0,copy:function(t,e){return jt.prototype.copy.call(this,t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this},getWorldDirection:function(){var t=new f;return function(e){var i=e||new m;return this.getWorldQuaternion(t),i.set(0,0,-1).applyQuaternion(t)}}(),updateMatrixWorld:function(t){jt.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),Ht.prototype=Object.assign(Object.create(Xt.prototype),{constructor:Ht,isOrthographicCamera:!0,copy:function(t,e){return Xt.prototype.copy.call(this,t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this},setViewOffset:function(t,e,i,r,n,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2,n=i-t,a=i+t,s=r+e,o=r-e;if(null!==this.view&&this.view.enabled){var h=this.zoom/(this.view.width/this.view.fullWidth),u=this.zoom/(this.view.height/this.view.fullHeight),l=(this.right-this.left)/this.view.width,c=(this.top-this.bottom)/this.view.height;a=(n+=l*(this.view.offsetX/h))+l*(this.view.width/h),o=(s-=c*(this.view.offsetY/u))-c*(this.view.height/u)}this.projectionMatrix.makeOrthographic(n,a,s,o,this.near,this.far)},toJSON:function(t){var e=jt.prototype.toJSON.call(this,t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}),Object.assign(Yt.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(var e=0,i=t.vertexNormals.length;e<i;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(e=0,i=t.vertexColors.length;e<i;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}});var qt,Zt=0;function Jt(){Object.defineProperty(this,"id",{value:Zt+=2}),this.uuid=c.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function Qt(t,e,i){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.uuid=c.generateUUID(),this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===i,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.onUploadCallback=function(){},this.version=0}function Kt(t,e,i){Qt.call(this,new Int8Array(t),e,i)}function $t(t,e,i){Qt.call(this,new Uint8Array(t),e,i)}function te(t,e,i){Qt.call(this,new Uint8ClampedArray(t),e,i)}function ee(t,e,i){Qt.call(this,new Int16Array(t),e,i)}function ie(t,e,i){Qt.call(this,new Uint16Array(t),e,i)}function re(t,e,i){Qt.call(this,new Int32Array(t),e,i)}function ne(t,e,i){Qt.call(this,new Uint32Array(t),e,i)}function ae(t,e,i){Qt.call(this,new Float32Array(t),e,i)}function se(t,e,i){Qt.call(this,new Float64Array(t),e,i)}function oe(){this.indices=[],this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function he(t){if(0===t.length)return-1/0;for(var e=t[0],i=1,r=t.length;i<r;++i)t[i]>e&&(e=t[i]);return e}Jt.prototype=Object.assign(Object.create(t.prototype),{constructor:Jt,isGeometry:!0,applyMatrix:function(t){for(var e=(new v).getNormalMatrix(t),i=0,r=this.vertices.length;i<r;i++){this.vertices[i].applyMatrix4(t)}for(i=0,r=this.faces.length;i<r;i++){var n=this.faces[i];n.normal.applyMatrix3(e).normalize();for(var a=0,s=n.vertexNormals.length;a<s;a++)n.vertexNormals[a].applyMatrix3(e).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var t=new d;return function(e){return t.makeRotationX(e),this.applyMatrix(t),this}}(),rotateY:function(){var t=new d;return function(e){return t.makeRotationY(e),this.applyMatrix(t),this}}(),rotateZ:function(){var t=new d;return function(e){return t.makeRotationZ(e),this.applyMatrix(t),this}}(),translate:function(){var t=new d;return function(e,i,r){return t.makeTranslation(e,i,r),this.applyMatrix(t),this}}(),scale:function(){var t=new d;return function(e,i,r){return t.makeScale(e,i,r),this.applyMatrix(t),this}}(),lookAt:(qt=new jt,function(t){qt.lookAt(t),qt.updateMatrix(),this.applyMatrix(qt.matrix)}),fromBufferGeometry:function(t){var e=this,i=null!==t.index?t.index.array:void 0,r=t.attributes,n=r.position.array,a=void 0!==r.normal?r.normal.array:void 0,s=void 0!==r.color?r.color.array:void 0,o=void 0!==r.uv?r.uv.array:void 0,h=void 0!==r.uv2?r.uv2.array:void 0;void 0!==h&&(this.faceVertexUvs[1]=[]);for(var u=[],l=[],c=[],d=0,f=0;d<n.length;d+=3,f+=2)e.vertices.push(new m(n[d],n[d+1],n[d+2])),void 0!==a&&u.push(new m(a[d],a[d+1],a[d+2])),void 0!==s&&e.colors.push(new ut(s[d],s[d+1],s[d+2])),void 0!==o&&l.push(new p(o[f],o[f+1])),void 0!==h&&c.push(new p(h[f],h[f+1]));function v(t,i,r,n){var p=new Yt(t,i,r,void 0!==a?[u[t].clone(),u[i].clone(),u[r].clone()]:[],void 0!==s?[e.colors[t].clone(),e.colors[i].clone(),e.colors[r].clone()]:[],n);e.faces.push(p),void 0!==o&&e.faceVertexUvs[0].push([l[t].clone(),l[i].clone(),l[r].clone()]),void 0!==h&&e.faceVertexUvs[1].push([c[t].clone(),c[i].clone(),c[r].clone()])}var g=t.groups;if(g.length>0)for(d=0;d<g.length;d++)for(var y=g[d],x=y.start,w=(f=x,x+y.count);f<w;f+=3)void 0!==i?v(i[f],i[f+1],i[f+2],y.materialIndex):v(f,f+1,f+2,y.materialIndex);else if(void 0!==i)for(d=0;d<i.length;d+=3)v(i[d],i[d+1],i[d+2]);else for(d=0;d<n.length/3;d+=3)v(d,d+1,d+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var t=this.boundingBox.getCenter().negate();return this.translate(t.x,t.y,t.z),t},normalize:function(){this.computeBoundingSphere();var t=this.boundingSphere.center,e=this.boundingSphere.radius,i=0===e?1:1/e,r=new d;return r.set(i,0,0,-i*t.x,0,i,0,-i*t.y,0,0,i,-i*t.z,0,0,0,1),this.applyMatrix(r),this},computeFaceNormals:function(){for(var t=new m,e=new m,i=0,r=this.faces.length;i<r;i++){var n=this.faces[i],a=this.vertices[n.a],s=this.vertices[n.b],o=this.vertices[n.c];t.subVectors(o,s),e.subVectors(a,s),t.cross(e),t.normalize(),n.normal.copy(t)}},computeVertexNormals:function(t){var e,i,r,n,a,s;for(void 0===t&&(t=!0),s=new Array(this.vertices.length),e=0,i=this.vertices.length;e<i;e++)s[e]=new m;if(t){var o,h,u,l=new m,c=new m;for(r=0,n=this.faces.length;r<n;r++)a=this.faces[r],o=this.vertices[a.a],h=this.vertices[a.b],u=this.vertices[a.c],l.subVectors(u,h),c.subVectors(o,h),l.cross(c),s[a.a].add(l),s[a.b].add(l),s[a.c].add(l)}else for(this.computeFaceNormals(),r=0,n=this.faces.length;r<n;r++)s[(a=this.faces[r]).a].add(a.normal),s[a.b].add(a.normal),s[a.c].add(a.normal);for(e=0,i=this.vertices.length;e<i;e++)s[e].normalize();for(r=0,n=this.faces.length;r<n;r++){var p=(a=this.faces[r]).vertexNormals;3===p.length?(p[0].copy(s[a.a]),p[1].copy(s[a.b]),p[2].copy(s[a.c])):(p[0]=s[a.a].clone(),p[1]=s[a.b].clone(),p[2]=s[a.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var t,e,i;for(this.computeFaceNormals(),t=0,e=this.faces.length;t<e;t++){var r=(i=this.faces[t]).vertexNormals;3===r.length?(r[0].copy(i.normal),r[1].copy(i.normal),r[2].copy(i.normal)):(r[0]=i.normal.clone(),r[1]=i.normal.clone(),r[2]=i.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var t,e,i,r,n;for(i=0,r=this.faces.length;i<r;i++)for((n=this.faces[i]).__originalFaceNormal?n.__originalFaceNormal.copy(n.normal):n.__originalFaceNormal=n.normal.clone(),n.__originalVertexNormals||(n.__originalVertexNormals=[]),t=0,e=n.vertexNormals.length;t<e;t++)n.__originalVertexNormals[t]?n.__originalVertexNormals[t].copy(n.vertexNormals[t]):n.__originalVertexNormals[t]=n.vertexNormals[t].clone();var a=new Jt;for(a.faces=this.faces,t=0,e=this.morphTargets.length;t<e;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];var s=this.morphNormals[t].faceNormals,o=this.morphNormals[t].vertexNormals;for(i=0,r=this.faces.length;i<r;i++)h=new m,u={a:new m,b:new m,c:new m},s.push(h),o.push(u)}var h,u,l=this.morphNormals[t];for(a.vertices=this.morphTargets[t].vertices,a.computeFaceNormals(),a.computeVertexNormals(),i=0,r=this.faces.length;i<r;i++)n=this.faces[i],h=l.faceNormals[i],u=l.vertexNormals[i],h.copy(n.normal),u.a.copy(n.vertexNormals[0]),u.b.copy(n.vertexNormals[1]),u.c.copy(n.vertexNormals[2])}for(i=0,r=this.faces.length;i<r;i++)(n=this.faces[i]).normal=n.__originalFaceNormal,n.vertexNormals=n.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new zt),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Rt),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,i){if(t&&t.isGeometry){var r,n=this.vertices.length,a=this.vertices,s=t.vertices,o=this.faces,h=t.faces,u=this.faceVertexUvs[0],l=t.faceVertexUvs[0],c=this.colors,p=t.colors;void 0===i&&(i=0),void 0!==e&&(r=(new v).getNormalMatrix(e));for(var d=0,f=s.length;d<f;d++){var m=s[d].clone();void 0!==e&&m.applyMatrix4(e),a.push(m)}for(d=0,f=p.length;d<f;d++)c.push(p[d].clone());for(d=0,f=h.length;d<f;d++){var g,y,x,w=h[d],M=w.vertexNormals,_=w.vertexColors;(g=new Yt(w.a+n,w.b+n,w.c+n)).normal.copy(w.normal),void 0!==r&&g.normal.applyMatrix3(r).normalize();for(var b=0,S=M.length;b<S;b++)y=M[b].clone(),void 0!==r&&y.applyMatrix3(r).normalize(),g.vertexNormals.push(y);g.color.copy(w.color);for(b=0,S=_.length;b<S;b++)x=_[b],g.vertexColors.push(x.clone());g.materialIndex=w.materialIndex+i,o.push(g)}for(d=0,f=l.length;d<f;d++){var T=l[d],E=[];if(void 0!==T){for(b=0,S=T.length;b<S;b++)E.push(T[b].clone());u.push(E)}}}},mergeMesh:function(t){t&&t.isMesh&&(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix))},mergeVertices:function(){var t,e,i,r,n,a,s,o,h={},u=[],l=[],c=Math.pow(10,4);for(i=0,r=this.vertices.length;i<r;i++)t=this.vertices[i],void 0===h[e=Math.round(t.x*c)+"_"+Math.round(t.y*c)+"_"+Math.round(t.z*c)]?(h[e]=i,u.push(this.vertices[i]),l[i]=u.length-1):l[i]=l[h[e]];var p=[];for(i=0,r=this.faces.length;i<r;i++){(n=this.faces[i]).a=l[n.a],n.b=l[n.b],n.c=l[n.c],a=[n.a,n.b,n.c];for(var d=0;d<3;d++)if(a[d]===a[(d+1)%3]){p.push(i);break}}for(i=p.length-1;i>=0;i--){var f=p[i];for(this.faces.splice(f,1),s=0,o=this.faceVertexUvs.length;s<o;s++)this.faceVertexUvs[s].splice(f,1)}var m=this.vertices.length-u.length;return this.vertices=u,m},setFromPoints:function(t){this.vertices=[];for(var e=0,i=t.length;e<i;e++){var r=t[e];this.vertices.push(new m(r.x,r.y,r.z||0))}return this},sortFacesByMaterialIndex:function(){for(var t=this.faces,e=t.length,i=0;i<e;i++)t[i]._id=i;t.sort((function(t,e){return t.materialIndex-e.materialIndex}));var r,n,a=this.faceVertexUvs[0],s=this.faceVertexUvs[1];a&&a.length===e&&(r=[]),s&&s.length===e&&(n=[]);for(i=0;i<e;i++){var o=t[i]._id;r&&r.push(a[o]),n&&n.push(s[o])}r&&(this.faceVertexUvs[0]=r),n&&(this.faceVertexUvs[1]=n)},toJSON:function(){var t={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){var e=this.parameters;for(var i in e)void 0!==e[i]&&(t[i]=e[i]);return t}for(var r=[],n=0;n<this.vertices.length;n++){var a=this.vertices[n];r.push(a.x,a.y,a.z)}var s=[],o=[],h={},u=[],l={},c=[],p={};for(n=0;n<this.faces.length;n++){var d=this.faces[n],f=void 0!==this.faceVertexUvs[0][n],m=d.normal.length()>0,v=d.vertexNormals.length>0,g=1!==d.color.r||1!==d.color.g||1!==d.color.b,y=d.vertexColors.length>0,x=0;if(x=b(x,0,0),x=b(x,1,!0),x=b(x,2,!1),x=b(x,3,f),x=b(x,4,m),x=b(x,5,v),x=b(x,6,g),x=b(x,7,y),s.push(x),s.push(d.a,d.b,d.c),s.push(d.materialIndex),f){var w=this.faceVertexUvs[0][n];s.push(E(w[0]),E(w[1]),E(w[2]))}if(m&&s.push(S(d.normal)),v){var M=d.vertexNormals;s.push(S(M[0]),S(M[1]),S(M[2]))}if(g&&s.push(T(d.color)),y){var _=d.vertexColors;s.push(T(_[0]),T(_[1]),T(_[2]))}}function b(t,e,i){return i?t|1<<e:t&~(1<<e)}function S(t){var e=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==h[e]||(h[e]=o.length/3,o.push(t.x,t.y,t.z)),h[e]}function T(t){var e=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==l[e]||(l[e]=u.length,u.push(t.getHex())),l[e]}function E(t){var e=t.x.toString()+t.y.toString();return void 0!==p[e]||(p[e]=c.length/2,c.push(t.x,t.y)),p[e]}return t.data={},t.data.vertices=r,t.data.normals=o,u.length>0&&(t.data.colors=u),c.length>0&&(t.data.uvs=[c]),t.data.faces=s,t},clone:function(){return(new Jt).copy(this)},copy:function(t){var e,i,r,n,a,s;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var o=t.vertices;for(e=0,i=o.length;e<i;e++)this.vertices.push(o[e].clone());var h=t.colors;for(e=0,i=h.length;e<i;e++)this.colors.push(h[e].clone());var u=t.faces;for(e=0,i=u.length;e<i;e++)this.faces.push(u[e].clone());for(e=0,i=t.faceVertexUvs.length;e<i;e++){var l=t.faceVertexUvs[e];for(void 0===this.faceVertexUvs[e]&&(this.faceVertexUvs[e]=[]),r=0,n=l.length;r<n;r++){var c=l[r],p=[];for(a=0,s=c.length;a<s;a++){var d=c[a];p.push(d.clone())}this.faceVertexUvs[e].push(p)}}var f=t.morphTargets;for(e=0,i=f.length;e<i;e++){var m={};if(m.name=f[e].name,void 0!==f[e].vertices)for(m.vertices=[],r=0,n=f[e].vertices.length;r<n;r++)m.vertices.push(f[e].vertices[r].clone());if(void 0!==f[e].normals)for(m.normals=[],r=0,n=f[e].normals.length;r<n;r++)m.normals.push(f[e].normals[r].clone());this.morphTargets.push(m)}var v=t.morphNormals;for(e=0,i=v.length;e<i;e++){var g={};if(void 0!==v[e].vertexNormals)for(g.vertexNormals=[],r=0,n=v[e].vertexNormals.length;r<n;r++){var y=v[e].vertexNormals[r],x={};x.a=y.a.clone(),x.b=y.b.clone(),x.c=y.c.clone(),g.vertexNormals.push(x)}if(void 0!==v[e].faceNormals)for(g.faceNormals=[],r=0,n=v[e].faceNormals.length;r<n;r++)g.faceNormals.push(v[e].faceNormals[r].clone());this.morphNormals.push(g)}var w=t.skinWeights;for(e=0,i=w.length;e<i;e++)this.skinWeights.push(w[e].clone());var M=t.skinIndices;for(e=0,i=M.length;e<i;e++)this.skinIndices.push(M[e].clone());var _=t.lineDistances;for(e=0,i=_.length;e<i;e++)this.lineDistances.push(_[e]);var b=t.boundingBox;null!==b&&(this.boundingBox=b.clone());var S=t.boundingSphere;return null!==S&&(this.boundingSphere=S.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(Qt.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(Qt.prototype,{isBufferAttribute:!0,setArray:function(t){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==t?t.length/this.itemSize:0,this.array=t},setDynamic:function(t){return this.dynamic=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.dynamic=t.dynamic,this},copyAt:function(t,e,i){t*=this.itemSize,i*=e.itemSize;for(var r=0,n=this.itemSize;r<n;r++)this.array[t+r]=e.array[i+r];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var e=this.array,i=0,r=0,n=t.length;r<n;r++){var a=t[r];void 0===a&&(a=new ut),e[i++]=a.r,e[i++]=a.g,e[i++]=a.b}return this},copyIndicesArray:function(t){for(var e=this.array,i=0,r=0,n=t.length;r<n;r++){var a=t[r];e[i++]=a.a,e[i++]=a.b,e[i++]=a.c}return this},copyVector2sArray:function(t){for(var e=this.array,i=0,r=0,n=t.length;r<n;r++){var a=t[r];void 0===a&&(a=new p),e[i++]=a.x,e[i++]=a.y}return this},copyVector3sArray:function(t){for(var e=this.array,i=0,r=0,n=t.length;r<n;r++){var a=t[r];void 0===a&&(a=new m),e[i++]=a.x,e[i++]=a.y,e[i++]=a.z}return this},copyVector4sArray:function(t){for(var e=this.array,i=0,r=0,n=t.length;r<n;r++){var a=t[r];void 0===a&&(a=new x),e[i++]=a.x,e[i++]=a.y,e[i++]=a.z,e[i++]=a.w}return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this},setXYZ:function(t,e,i,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=r,this},setXYZW:function(t,e,i,r,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=r,this.array[t+3]=n,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),Kt.prototype=Object.create(Qt.prototype),Kt.prototype.constructor=Kt,$t.prototype=Object.create(Qt.prototype),$t.prototype.constructor=$t,te.prototype=Object.create(Qt.prototype),te.prototype.constructor=te,ee.prototype=Object.create(Qt.prototype),ee.prototype.constructor=ee,ie.prototype=Object.create(Qt.prototype),ie.prototype.constructor=ie,re.prototype=Object.create(Qt.prototype),re.prototype.constructor=re,ne.prototype=Object.create(Qt.prototype),ne.prototype.constructor=ne,ae.prototype=Object.create(Qt.prototype),ae.prototype.constructor=ae,se.prototype=Object.create(Qt.prototype),se.prototype.constructor=se,Object.assign(oe.prototype,{computeGroups:function(t){for(var e,i=[],r=void 0,n=t.faces,a=0;a<n.length;a++){var s=n[a];s.materialIndex!==r&&(r=s.materialIndex,void 0!==e&&(e.count=3*a-e.start,i.push(e)),e={start:3*a,materialIndex:r})}void 0!==e&&(e.count=3*a-e.start,i.push(e)),this.groups=i},fromGeometry:function(t){var e,i=t.faces,r=t.vertices,n=t.faceVertexUvs,a=n[0]&&n[0].length>0,s=n[1]&&n[1].length>0,o=t.morphTargets,h=o.length;if(h>0){e=[];for(var u=0;u<h;u++)e[u]=[];this.morphTargets.position=e}var l,c=t.morphNormals,d=c.length;if(d>0){l=[];for(u=0;u<d;u++)l[u]=[];this.morphTargets.normal=l}var f=t.skinIndices,m=t.skinWeights,v=f.length===r.length,g=m.length===r.length;for(u=0;u<i.length;u++){var y=i[u];this.vertices.push(r[y.a],r[y.b],r[y.c]);var x=y.vertexNormals;if(3===x.length)this.normals.push(x[0],x[1],x[2]);else{var w=y.normal;this.normals.push(w,w,w)}var M,_=y.vertexColors;if(3===_.length)this.colors.push(_[0],_[1],_[2]);else{var b=y.color;this.colors.push(b,b,b)}if(!0===a)void 0!==(M=n[0][u])?this.uvs.push(M[0],M[1],M[2]):this.uvs.push(new p,new p,new p);if(!0===s)void 0!==(M=n[1][u])?this.uvs2.push(M[0],M[1],M[2]):this.uvs2.push(new p,new p,new p);for(var S=0;S<h;S++){var T=o[S].vertices;e[S].push(T[y.a],T[y.b],T[y.c])}for(S=0;S<d;S++){var E=c[S].vertexNormals[u];l[S].push(E.a,E.b,E.c)}v&&this.skinIndices.push(f[y.a],f[y.b],f[y.c]),g&&this.skinWeights.push(m[y.a],m[y.b],m[y.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this}});var ue,le,ce,pe,de,fe,me,ve=1;function ge(){Object.defineProperty(this,"id",{value:ve+=2}),this.uuid=c.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0}}function ye(t,e,i,r,n,a){Jt.call(this),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:r,heightSegments:n,depthSegments:a},this.fromBufferGeometry(new xe(t,e,i,r,n,a)),this.mergeVertices()}function xe(t,e,i,r,n,a){ge.call(this),this.type="BoxBufferGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:r,heightSegments:n,depthSegments:a};var s=this;t=t||1,e=e||1,i=i||1,r=Math.floor(r)||1,n=Math.floor(n)||1,a=Math.floor(a)||1;var o=[],h=[],u=[],l=[],c=0,p=0;function d(t,e,i,r,n,a,d,f,v,g,y){var x,w,M=a/v,_=d/g,b=a/2,S=d/2,T=f/2,E=v+1,A=g+1,P=0,C=0,N=new m;for(w=0;w<A;w++){var z=w*_-S;for(x=0;x<E;x++){var R=x*M-b;N[t]=R*r,N[e]=z*n,N[i]=T,h.push(N.x,N.y,N.z),N[t]=0,N[e]=0,N[i]=f>0?1:-1,u.push(N.x,N.y,N.z),l.push(x/v),l.push(1-w/g),P+=1}}for(w=0;w<g;w++)for(x=0;x<v;x++){var O=c+x+E*w,L=c+x+E*(w+1),U=c+(x+1)+E*(w+1),D=c+(x+1)+E*w;o.push(O,L,D),o.push(L,U,D),C+=6}s.addGroup(p,C,y),p+=C,c+=P}d("z","y","x",-1,-1,i,e,t,a,n,0),d("z","y","x",1,-1,i,e,-t,a,n,1),d("x","z","y",1,1,t,i,e,r,a,2),d("x","z","y",1,-1,t,i,-e,r,a,3),d("x","y","z",1,-1,t,e,i,r,n,4),d("x","y","z",-1,-1,t,e,-i,r,n,5),this.setIndex(o),this.addAttribute("position",new ae(h,3)),this.addAttribute("normal",new ae(u,3)),this.addAttribute("uv",new ae(l,2))}function we(t,e,i,r){Jt.call(this),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:r},this.fromBufferGeometry(new Me(t,e,i,r)),this.mergeVertices()}function Me(t,e,i,r){ge.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:r};var n,a,s=(t=t||1)/2,o=(e=e||1)/2,h=Math.floor(i)||1,u=Math.floor(r)||1,l=h+1,c=u+1,p=t/h,d=e/u,f=[],m=[],v=[],g=[];for(a=0;a<c;a++){var y=a*d-o;for(n=0;n<l;n++){var x=n*p-s;m.push(x,-y,0),v.push(0,0,1),g.push(n/h),g.push(1-a/u)}}for(a=0;a<u;a++)for(n=0;n<h;n++){var w=n+l*a,M=n+l*(a+1),_=n+1+l*(a+1),b=n+1+l*a;f.push(w,M,b),f.push(M,_,b)}this.setIndex(f),this.addAttribute("position",new ae(m,3)),this.addAttribute("normal",new ae(v,3)),this.addAttribute("uv",new ae(g,2))}function _e(t){Pt.call(this),this.type="MeshBasicMaterial",this.color=new ut(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(t)}function be(t){Pt.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,this.fragmentShader=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==t&&(t.attributes,this.setValues(t))}function Se(t,e){this.origin=void 0!==t?t:new m,this.direction=void 0!==e?e:new m}function Te(t,e){this.start=void 0!==t?t:new m,this.end=void 0!==e?e:new m}function Ee(t,e,i){this.a=void 0!==t?t:new m,this.b=void 0!==e?e:new m,this.c=void 0!==i?i:new m}function Ae(t,e){jt.call(this),this.type="Mesh",this.geometry=void 0!==t?t:new ge,this.material=void 0!==e?e:new _e({color:16777215*Math.random()}),this.drawMode=0,this.updateMorphTargets()}function Pe(t,e,i,r){var n,a,s,o=new ut(0),h=0;function u(t,i){e.buffers.color.setClear(t.r,t.g,t.b,i,r)}return{getClearColor:function(){return o},setClearColor:function(t,e){o.set(t),u(o,h=void 0!==e?e:1)},getClearAlpha:function(){return h},setClearAlpha:function(t){u(o,h=t)},render:function(e,r,l,c){var p=r.background;null===p?u(o,h):p&&p.isColor&&(u(p,1),c=!0),(t.autoClear||c)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),p&&p.isCubeTexture?(void 0===s&&((s=new Ae(new xe(1,1,1),new be({uniforms:gt.cube.uniforms,vertexShader:gt.cube.vertexShader,fragmentShader:gt.cube.fragmentShader,side:1,depthTest:!0,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),s.geometry.removeAttribute("uv"),s.onBeforeRender=function(t,e,i){this.matrixWorld.copyPosition(i.matrixWorld)},i.update(s.geometry)),s.material.uniforms.tCube.value=p,e.push(s,s.geometry,s.material,0,null)):p&&p.isTexture&&(void 0===n&&(n=new Ht(-1,1,1,-1,0,1),a=new Ae(new Me(2,2),new _e({depthTest:!1,depthWrite:!1,fog:!1})),i.update(a.geometry)),a.material.map=p,t.renderBufferDirect(n,null,a.geometry,a.material,a,null))}}}function Ce(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program&&e.program&&t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function Ne(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function ze(){var t=[],e=0,i=[],r=[];return{opaque:i,transparent:r,init:function(){e=0,i.length=0,r.length=0},push:function(n,a,s,o,h){var u=t[e];void 0===u?(u={id:n.id,object:n,geometry:a,material:s,program:s.program,renderOrder:n.renderOrder,z:o,group:h},t[e]=u):(u.id=n.id,u.object=n,u.geometry=a,u.material=s,u.program=s.program,u.renderOrder=n.renderOrder,u.z=o,u.group=h),(!0===s.transparent?r:i).push(u),e++},sort:function(){i.length>1&&i.sort(Ce),r.length>1&&r.sort(Ne)}}}function Re(){var t={};return{get:function(e,i){var r=e.id+","+i.id,n=t[r];return void 0===n&&(n=new ze,t[r]=n),n},dispose:function(){t={}}}}function Oe(t,e){return Math.abs(e[1])-Math.abs(t[1])}function Le(t){var e={},i=new Float32Array(8);return{update:function(r,n,a,s){var o=r.morphTargetInfluences,h=o.length,u=e[n.id];if(void 0===u){u=[];for(var l=0;l<h;l++)u[l]=[l,0];e[n.id]=u}var c=a.morphTargets&&n.morphAttributes.position,p=a.morphNormals&&n.morphAttributes.normal;for(l=0;l<h;l++){0!==(d=u[l])[1]&&(c&&n.removeAttribute("morphTarget"+l),p&&n.removeAttribute("morphNormal"+l))}for(l=0;l<h;l++){(d=u[l])[0]=l,d[1]=o[l]}for(u.sort(Oe),l=0;l<8;l++){var d;if(d=u[l]){var f=d[0],m=d[1];if(m){c&&n.addAttribute("morphTarget"+l,c[f]),p&&n.addAttribute("morphNormal"+l,p[f]),i[l]=m;continue}}i[l]=0}s.getUniforms().setValue(t,"morphTargetInfluences",i)}}}function Ue(t,e,i){var r,n,a;this.setMode=function(t){r=t},this.setIndex=function(t){n=t.type,a=t.bytesPerElement},this.render=function(e,s){t.drawElements(r,s,n,e*a),i.calls++,i.vertices+=s,r===t.TRIANGLES?i.faces+=s/3:r===t.POINTS&&(i.points+=s)},this.renderInstances=function(s,o,h){var u=e.get("ANGLE_instanced_arrays");null!==u&&(u.drawElementsInstancedANGLE(r,h,n,o*a,s.maxInstancedCount),i.calls++,i.vertices+=h*s.maxInstancedCount,r===t.TRIANGLES?i.faces+=s.maxInstancedCount*h/3:r===t.POINTS&&(i.points+=s.maxInstancedCount*h))}}function De(t,e,i){var r;this.setMode=function(t){r=t},this.render=function(e,n){t.drawArrays(r,e,n),i.calls++,i.vertices+=n,r===t.TRIANGLES?i.faces+=n/3:r===t.POINTS&&(i.points+=n)},this.renderInstances=function(n,a,s){var o=e.get("ANGLE_instanced_arrays");if(null!==o){var h=n.attributes.position;h.isInterleavedBufferAttribute?(s=h.data.count,o.drawArraysInstancedANGLE(r,0,s,n.maxInstancedCount)):o.drawArraysInstancedANGLE(r,a,s,n.maxInstancedCount),i.calls++,i.vertices+=s*n.maxInstancedCount,r===t.TRIANGLES?i.faces+=n.maxInstancedCount*s/3:r===t.POINTS&&(i.points+=n.maxInstancedCount*s)}}}function Fe(t,e,i){var r={},n={};function a(t){var s=t.target,o=r[s.id];for(var h in null!==o.index&&e.remove(o.index),o.attributes)e.remove(o.attributes[h]);s.removeEventListener("dispose",a),delete r[s.id];var u=n[s.id];u&&(e.remove(u),delete n[s.id]),(u=n[o.id])&&(e.remove(u),delete n[o.id]),i.geometries--}return{get:function(t,e){var n=r[e.id];return n||(e.addEventListener("dispose",a),e.isBufferGeometry?n=e:e.isGeometry&&(void 0===e._bufferGeometry&&(e._bufferGeometry=(new ge).setFromObject(t)),n=e._bufferGeometry),r[e.id]=n,i.geometries++,n)},update:function(i){var r=i.index,n=i.attributes;for(var a in null!==r&&e.update(r,t.ELEMENT_ARRAY_BUFFER),n)e.update(n[a],t.ARRAY_BUFFER);var s=i.morphAttributes;for(var a in s)for(var o=s[a],h=0,u=o.length;h<u;h++)e.update(o[h],t.ARRAY_BUFFER)},getWireframeAttribute:function(i){var r=n[i.id];if(r)return r;var a,s=[],o=i.index,h=i.attributes;if(null!==o)for(var u=0,l=(a=o.array).length;u<l;u+=3){var c=a[u+0],p=a[u+1],d=a[u+2];s.push(c,p,p,d,d,c)}else for(u=0,l=(a=h.position.array).length/3-1;u<l;u+=3){c=u+0,p=u+1,d=u+2;s.push(c,p,p,d,d,c)}return r=new(he(s)>65535?ne:ie)(s,1),e.update(r,t.ELEMENT_ARRAY_BUFFER),n[i.id]=r,r}}}function Ie(t,e){var i={};return{update:function(r){var n=e.frame,a=r.geometry,s=t.get(r,a);return i[s.id]!==n&&(a.isGeometry&&s.updateFromObject(r),t.update(s),i[s.id]=n),s},dispose:function(){i={}}}}function Be(t,e,i){var r=t.createShader(e);return t.shaderSource(r,i),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS),t.getShaderInfoLog(r),r}ge.prototype=Object.assign(Object.create(t.prototype),{constructor:ge,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){Array.isArray(t)?this.index=new(he(t)>65535?ne:ie)(t,1):this.index=t},addAttribute:function(t,e){if(e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute){if("index"!==t)return this.attributes[t]=e,this;this.setIndex(e)}else this.addAttribute(t,new Qt(arguments[1],arguments[2]))},getAttribute:function(t){return this.attributes[t]},removeAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,e,i){this.groups.push({start:t,count:e,materialIndex:void 0!==i?i:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix:function(t){var e=this.attributes.position;void 0!==e&&(t.applyToBufferAttribute(e),e.needsUpdate=!0);var i=this.attributes.normal;void 0!==i&&((new v).getNormalMatrix(t).applyToBufferAttribute(i),i.needsUpdate=!0);return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var t=new d;return function(e){return t.makeRotationX(e),this.applyMatrix(t),this}}(),rotateY:function(){var t=new d;return function(e){return t.makeRotationY(e),this.applyMatrix(t),this}}(),rotateZ:function(){var t=new d;return function(e){return t.makeRotationZ(e),this.applyMatrix(t),this}}(),translate:function(){var t=new d;return function(e,i,r){return t.makeTranslation(e,i,r),this.applyMatrix(t),this}}(),scale:function(){var t=new d;return function(e,i,r){return t.makeScale(e,i,r),this.applyMatrix(t),this}}(),lookAt:function(){var t=new jt;return function(e){t.lookAt(e),t.updateMatrix(),this.applyMatrix(t.matrix)}}(),center:function(){this.computeBoundingBox();var t=this.boundingBox.getCenter().negate();return this.translate(t.x,t.y,t.z),t},setFromObject:function(t){var e=t.geometry;if(t.isPoints||t.isLine){var i=new ae(3*e.vertices.length,3),r=new ae(3*e.colors.length,3);if(this.addAttribute("position",i.copyVector3sArray(e.vertices)),this.addAttribute("color",r.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length){var n=new ae(e.lineDistances.length,1);this.addAttribute("lineDistance",n.copyArray(e.lineDistances))}null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone())}else t.isMesh&&e&&e.isGeometry&&this.fromGeometry(e);return this},setFromPoints:function(t){for(var e=[],i=0,r=t.length;i<r;i++){var n=t[i];e.push(n.x,n.y,n.z||0)}return this.addAttribute("position",new ae(e,3)),this},updateFromObject:function(t){var e,i=t.geometry;if(t.isMesh){var r=i.__directGeometry;if(!0===i.elementsNeedUpdate&&(r=void 0,i.elementsNeedUpdate=!1),void 0===r)return this.fromGeometry(i);r.verticesNeedUpdate=i.verticesNeedUpdate,r.normalsNeedUpdate=i.normalsNeedUpdate,r.colorsNeedUpdate=i.colorsNeedUpdate,r.uvsNeedUpdate=i.uvsNeedUpdate,r.groupsNeedUpdate=i.groupsNeedUpdate,i.verticesNeedUpdate=!1,i.normalsNeedUpdate=!1,i.colorsNeedUpdate=!1,i.uvsNeedUpdate=!1,i.groupsNeedUpdate=!1,i=r}return!0===i.verticesNeedUpdate&&(void 0!==(e=this.attributes.position)&&(e.copyVector3sArray(i.vertices),e.needsUpdate=!0),i.verticesNeedUpdate=!1),!0===i.normalsNeedUpdate&&(void 0!==(e=this.attributes.normal)&&(e.copyVector3sArray(i.normals),e.needsUpdate=!0),i.normalsNeedUpdate=!1),!0===i.colorsNeedUpdate&&(void 0!==(e=this.attributes.color)&&(e.copyColorsArray(i.colors),e.needsUpdate=!0),i.colorsNeedUpdate=!1),i.uvsNeedUpdate&&(void 0!==(e=this.attributes.uv)&&(e.copyVector2sArray(i.uvs),e.needsUpdate=!0),i.uvsNeedUpdate=!1),i.lineDistancesNeedUpdate&&(void 0!==(e=this.attributes.lineDistance)&&(e.copyArray(i.lineDistances),e.needsUpdate=!0),i.lineDistancesNeedUpdate=!1),i.groupsNeedUpdate&&(i.computeGroups(t.geometry),this.groups=i.groups,i.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new oe).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){var e=new Float32Array(3*t.vertices.length);if(this.addAttribute("position",new Qt(e,3).copyVector3sArray(t.vertices)),t.normals.length>0){var i=new Float32Array(3*t.normals.length);this.addAttribute("normal",new Qt(i,3).copyVector3sArray(t.normals))}if(t.colors.length>0){var r=new Float32Array(3*t.colors.length);this.addAttribute("color",new Qt(r,3).copyColorsArray(t.colors))}if(t.uvs.length>0){var n=new Float32Array(2*t.uvs.length);this.addAttribute("uv",new Qt(n,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){var a=new Float32Array(2*t.uvs2.length);this.addAttribute("uv2",new Qt(a,2).copyVector2sArray(t.uvs2))}if(t.indices.length>0){var s=new(he(t.indices)>65535?Uint32Array:Uint16Array)(3*t.indices.length);this.setIndex(new Qt(s,1).copyIndicesArray(t.indices))}for(var o in this.groups=t.groups,t.morphTargets){for(var h=[],u=t.morphTargets[o],l=0,c=u.length;l<c;l++){var p=u[l],d=new ae(3*p.length,3);h.push(d.copyVector3sArray(p))}this.morphAttributes[o]=h}if(t.skinIndices.length>0){var f=new ae(4*t.skinIndices.length,4);this.addAttribute("skinIndex",f.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){var m=new ae(4*t.skinWeights.length,4);this.addAttribute("skinWeight",m.copyVector4sArray(t.skinWeights))}return null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new zt);var t=this.attributes.position;void 0!==t?this.boundingBox.setFromBufferAttribute(t):this.boundingBox.makeEmpty(),isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z)},computeBoundingSphere:function(){var t=new zt,e=new m;return function(){null===this.boundingSphere&&(this.boundingSphere=new Rt);var i=this.attributes.position;if(i){var r=this.boundingSphere.center;t.setFromBufferAttribute(i),t.getCenter(r);for(var n=0,a=0,s=i.count;a<s;a++)e.x=i.getX(a),e.y=i.getY(a),e.z=i.getZ(a),n=Math.max(n,r.distanceToSquared(e));this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,e=this.attributes,i=this.groups;if(e.position){var r=e.position.array;if(void 0===e.normal)this.addAttribute("normal",new Qt(new Float32Array(r.length),3));else for(var n=e.normal.array,a=0,s=n.length;a<s;a++)n[a]=0;var o,h,u,l=e.normal.array,c=new m,p=new m,d=new m,f=new m,v=new m;if(t){var g=t.array;0===i.length&&this.addGroup(0,g.length);for(var y=0,x=i.length;y<x;++y){var w=i[y],M=w.start;for(a=M,s=M+w.count;a<s;a+=3)o=3*g[a+0],h=3*g[a+1],u=3*g[a+2],c.fromArray(r,o),p.fromArray(r,h),d.fromArray(r,u),f.subVectors(d,p),v.subVectors(c,p),f.cross(v),l[o]+=f.x,l[o+1]+=f.y,l[o+2]+=f.z,l[h]+=f.x,l[h+1]+=f.y,l[h+2]+=f.z,l[u]+=f.x,l[u+1]+=f.y,l[u+2]+=f.z}}else for(a=0,s=r.length;a<s;a+=9)c.fromArray(r,a),p.fromArray(r,a+3),d.fromArray(r,a+6),f.subVectors(d,p),v.subVectors(c,p),f.cross(v),l[a]=f.x,l[a+1]=f.y,l[a+2]=f.z,l[a+3]=f.x,l[a+4]=f.y,l[a+5]=f.z,l[a+6]=f.x,l[a+7]=f.y,l[a+8]=f.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},merge:function(t,e){if(t&&t.isBufferGeometry){void 0===e&&(e=0);var i=this.attributes;for(var r in i)if(void 0!==t.attributes[r])for(var n=i[r].array,a=t.attributes[r],s=a.array,o=0,h=a.itemSize*e;o<s.length;o++,h++)n[h]=s[o];return this}},normalizeNormals:function(){var t=new m;return function(){for(var e=this.attributes.normal,i=0,r=e.count;i<r;i++)t.x=e.getX(i),t.y=e.getY(i),t.z=e.getZ(i),t.normalize(),e.setXYZ(i,t.x,t.y,t.z)}}(),toNonIndexed:function(){if(null===this.index)return this;var t=new ge,e=this.index.array,i=this.attributes;for(var r in i){for(var n=i[r],a=n.array,s=n.itemSize,o=new a.constructor(e.length*s),h=0,u=0,l=0,c=e.length;l<c;l++){h=e[l]*s;for(var p=0;p<s;p++)o[u++]=a[h++]}t.addAttribute(r,new Qt(o,s))}return t},toJSON:function(){var t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){var e=this.parameters;for(var i in e)void 0!==e[i]&&(t[i]=e[i]);return t}t.data={attributes:{}};var r=this.index;if(null!==r){var n=Array.prototype.slice.call(r.array);t.data.index={type:r.array.constructor.name,array:n}}var a=this.attributes;for(var i in a){var s=a[i];n=Array.prototype.slice.call(s.array);t.data.attributes[i]={itemSize:s.itemSize,type:s.array.constructor.name,array:n,normalized:s.normalized}}var o=this.groups;o.length>0&&(t.data.groups=JSON.parse(JSON.stringify(o)));var h=this.boundingSphere;return null!==h&&(t.data.boundingSphere={center:h.center.toArray(),radius:h.radius}),t},clone:function(){return(new ge).copy(this)},copy:function(t){var e,i,r;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var n=t.index;null!==n&&this.setIndex(n.clone());var a=t.attributes;for(e in a){var s=a[e];this.addAttribute(e,s.clone())}var o=t.morphAttributes;for(e in o){var h=[],u=o[e];for(i=0,r=u.length;i<r;i++)h.push(u[i].clone());this.morphAttributes[e]=h}var l=t.groups;for(i=0,r=l.length;i<r;i++){var c=l[i];this.addGroup(c.start,c.count,c.materialIndex)}var p=t.boundingBox;null!==p&&(this.boundingBox=p.clone());var d=t.boundingSphere;return null!==d&&(this.boundingSphere=d.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),ye.prototype=Object.create(Jt.prototype),ye.prototype.constructor=ye,xe.prototype=Object.create(ge.prototype),xe.prototype.constructor=xe,we.prototype=Object.create(Jt.prototype),we.prototype.constructor=we,Me.prototype=Object.create(ge.prototype),Me.prototype.constructor=Me,_e.prototype=Object.create(Pt.prototype),_e.prototype.constructor=_e,_e.prototype.isMeshBasicMaterial=!0,_e.prototype.copy=function(t){return Pt.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this},be.prototype=Object.create(Pt.prototype),be.prototype.constructor=be,be.prototype.isShaderMaterial=!0,be.prototype.copy=function(t){return Pt.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=ct.clone(t.uniforms),this.defines=t.defines,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=t.extensions,this},be.prototype.toJSON=function(t){var e=Pt.prototype.toJSON.call(this,t);return e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e},Object.assign(Se.prototype,{set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,e){return(e||new m).copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},recast:function(){var t=new m;return function(e){return this.origin.copy(this.at(e,t)),this}}(),closestPointToPoint:function(t,e){var i=e||new m;i.subVectors(t,this.origin);var r=i.dot(this.direction);return r<0?i.copy(this.origin):i.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:function(){var t=new m;return function(e){var i=t.subVectors(e,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(e):(t.copy(this.direction).multiplyScalar(i).add(this.origin),t.distanceToSquared(e))}}(),distanceSqToSegment:(le=new m,ce=new m,pe=new m,function(t,e,i,r){le.copy(t).add(e).multiplyScalar(.5),ce.copy(e).sub(t).normalize(),pe.copy(this.origin).sub(le);var n,a,s,o,h=.5*t.distanceTo(e),u=-this.direction.dot(ce),l=pe.dot(this.direction),c=-pe.dot(ce),p=pe.lengthSq(),d=Math.abs(1-u*u);if(d>0)if(a=u*l-c,o=h*d,(n=u*c-l)>=0)if(a>=-o)if(a<=o){var f=1/d;s=(n*=f)*(n+u*(a*=f)+2*l)+a*(u*n+a+2*c)+p}else a=h,s=-(n=Math.max(0,-(u*a+l)))*n+a*(a+2*c)+p;else a=-h,s=-(n=Math.max(0,-(u*a+l)))*n+a*(a+2*c)+p;else a<=-o?s=-(n=Math.max(0,-(-u*h+l)))*n+(a=n>0?-h:Math.min(Math.max(-h,-c),h))*(a+2*c)+p:a<=o?(n=0,s=(a=Math.min(Math.max(-h,-c),h))*(a+2*c)+p):s=-(n=Math.max(0,-(u*h+l)))*n+(a=n>0?h:Math.min(Math.max(-h,-c),h))*(a+2*c)+p;else a=u>0?-h:h,s=-(n=Math.max(0,-(u*a+l)))*n+a*(a+2*c)+p;return i&&i.copy(this.direction).multiplyScalar(n).add(this.origin),r&&r.copy(ce).multiplyScalar(a).add(le),s}),intersectSphere:function(){var t=new m;return function(e,i){t.subVectors(e.center,this.origin);var r=t.dot(this.direction),n=t.dot(t)-r*r,a=e.radius*e.radius;if(n>a)return null;var s=Math.sqrt(a-n),o=r-s,h=r+s;return o<0&&h<0?null:o<0?this.at(h,i):this.at(o,i)}}(),intersectsSphere:function(t){return this.distanceToPoint(t.center)<=t.radius},distanceToPlane:function(t){var e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;var i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null},intersectPlane:function(t,e){var i=this.distanceToPlane(t);return null===i?null:this.at(i,e)},intersectsPlane:function(t){var e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0},intersectBox:function(t,e){var i,r,n,a,s,o,h=1/this.direction.x,u=1/this.direction.y,l=1/this.direction.z,c=this.origin;return h>=0?(i=(t.min.x-c.x)*h,r=(t.max.x-c.x)*h):(i=(t.max.x-c.x)*h,r=(t.min.x-c.x)*h),u>=0?(n=(t.min.y-c.y)*u,a=(t.max.y-c.y)*u):(n=(t.max.y-c.y)*u,a=(t.min.y-c.y)*u),i>a||n>r?null:((n>i||i!=i)&&(i=n),(a<r||r!=r)&&(r=a),l>=0?(s=(t.min.z-c.z)*l,o=(t.max.z-c.z)*l):(s=(t.max.z-c.z)*l,o=(t.min.z-c.z)*l),i>o||s>r?null:((s>i||i!=i)&&(i=s),(o<r||r!=r)&&(r=o),r<0?null:this.at(i>=0?i:r,e)))},intersectsBox:(ue=new m,function(t){return null!==this.intersectBox(t,ue)}),intersectTriangle:function(){var t=new m,e=new m,i=new m,r=new m;return function(n,a,s,o,h){e.subVectors(a,n),i.subVectors(s,n),r.crossVectors(e,i);var u,l=this.direction.dot(r);if(l>0){if(o)return null;u=1}else{if(!(l<0))return null;u=-1,l=-l}t.subVectors(this.origin,n);var c=u*this.direction.dot(i.crossVectors(t,i));if(c<0)return null;var p=u*this.direction.dot(e.cross(t));if(p<0)return null;if(c+p>l)return null;var d=-u*t.dot(r);return d<0?null:this.at(d/l,h)}}(),applyMatrix4:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}}),Object.assign(Te.prototype,{set:function(t,e){return this.start.copy(t),this.end.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.start.copy(t.start),this.end.copy(t.end),this},getCenter:function(t){return(t||new m).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){return(t||new m).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,e){var i=e||new m;return this.delta(i).multiplyScalar(t).add(this.start)},closestPointToPointParameter:(de=new m,fe=new m,function(t,e){de.subVectors(t,this.start),fe.subVectors(this.end,this.start);var i=fe.dot(fe),r=fe.dot(de)/i;return e&&(r=c.clamp(r,0,1)),r}),closestPointToPoint:function(t,e,i){var r=this.closestPointToPointParameter(t,e),n=i||new m;return this.delta(n).multiplyScalar(r).add(this.start)},applyMatrix4:function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this},equals:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}),Object.assign(Ee,{normal:(me=new m,function(t,e,i,r){var n=r||new m;n.subVectors(i,e),me.subVectors(t,e),n.cross(me);var a=n.lengthSq();return a>0?n.multiplyScalar(1/Math.sqrt(a)):n.set(0,0,0)}),barycoordFromPoint:function(){var t=new m,e=new m,i=new m;return function(r,n,a,s,o){t.subVectors(s,n),e.subVectors(a,n),i.subVectors(r,n);var h=t.dot(t),u=t.dot(e),l=t.dot(i),c=e.dot(e),p=e.dot(i),d=h*c-u*u,f=o||new m;if(0===d)return f.set(-2,-1,-1);var v=1/d,g=(c*l-u*p)*v,y=(h*p-u*l)*v;return f.set(1-g-y,y,g)}}(),containsPoint:function(){var t=new m;return function(e,i,r,n){var a=Ee.barycoordFromPoint(e,i,r,n,t);return a.x>=0&&a.y>=0&&a.x+a.y<=1}}()}),Object.assign(Ee.prototype,{set:function(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this},setFromPointsAndIndices:function(t,e,i,r){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[r]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},area:function(){var t=new m,e=new m;return function(){return t.subVectors(this.c,this.b),e.subVectors(this.a,this.b),.5*t.cross(e).length()}}(),midpoint:function(t){return(t||new m).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(t){return Ee.normal(this.a,this.b,this.c,t)},plane:function(t){return(t||new Ot).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(t,e){return Ee.barycoordFromPoint(t,this.a,this.b,this.c,e)},containsPoint:function(t){return Ee.containsPoint(t,this.a,this.b,this.c)},intersectsBox:function(t){return t.intersectsTriangle(this)},closestPointToPoint:function(){var t=new Ot,e=[new Te,new Te,new Te],i=new m,r=new m;return function(n,a){var s=a||new m,o=1/0;if(t.setFromCoplanarPoints(this.a,this.b,this.c),t.projectPoint(n,i),!0===this.containsPoint(i))s.copy(i);else{e[0].set(this.a,this.b),e[1].set(this.b,this.c),e[2].set(this.c,this.a);for(var h=0;h<e.length;h++){e[h].closestPointToPoint(i,!0,r);var u=i.distanceToSquared(r);u<o&&(o=u,s.copy(r))}}return s}}(),equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}),Ae.prototype=Object.assign(Object.create(jt.prototype),{constructor:Ae,isMesh:!0,setDrawMode:function(t){this.drawMode=t},copy:function(t){return jt.prototype.copy.call(this,t),this.drawMode=t.drawMode,void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this},updateMorphTargets:function(){var t,e,i,r=this.geometry;if(r.isBufferGeometry){var n=r.morphAttributes,a=Object.keys(n);if(a.length>0){var s=n[a[0]];if(void 0!==s)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=s.length;t<e;t++)i=s[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=t}}else{var o=r.morphTargets;if(void 0!==o&&o.length>0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=o.length;t<e;t++)i=o[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=t}},raycast:function(){var t=new d,e=new Se,i=new Rt,r=new m,n=new m,a=new m,s=new m,o=new m,h=new m,u=new p,l=new p,c=new p,f=new m,v=new m,g=new m;function y(t,e,i,r,n,a,s){return Ee.barycoordFromPoint(t,e,i,r,f),n.multiplyScalar(f.x),a.multiplyScalar(f.y),s.multiplyScalar(f.z),n.add(a).add(s),n.clone()}function x(t,e,i,r,n,a,s,o){if(null===(1===e.side?r.intersectTriangle(s,a,n,!0,o):r.intersectTriangle(n,a,s,2!==e.side,o)))return null;g.copy(o),g.applyMatrix4(t.matrixWorld);var h=i.ray.origin.distanceTo(g);return h<i.near||h>i.far?null:{distance:h,point:g.clone(),object:t}}function w(t,e,i,s,o,h,p,d){r.fromBufferAttribute(s,h),n.fromBufferAttribute(s,p),a.fromBufferAttribute(s,d);var f=x(t,t.material,e,i,r,n,a,v);return f&&(o&&(u.fromBufferAttribute(o,h),l.fromBufferAttribute(o,p),c.fromBufferAttribute(o,d),f.uv=y(v,r,n,a,u,l,c)),f.face=new Yt(h,p,d,Ee.normal(r,n,a)),f.faceIndex=h),f}return function(p,d){var f,m=this.geometry,g=this.material,M=this.matrixWorld;if(void 0!==g&&(null===m.boundingSphere&&m.computeBoundingSphere(),i.copy(m.boundingSphere),i.applyMatrix4(M),!1!==p.ray.intersectsSphere(i)&&(t.getInverse(M),e.copy(p.ray).applyMatrix4(t),null===m.boundingBox||!1!==e.intersectsBox(m.boundingBox))))if(m.isBufferGeometry){var _,b,S,T,E,A=m.index,P=m.attributes.position,C=m.attributes.uv;if(null!==A)for(T=0,E=A.count;T<E;T+=3)_=A.getX(T),b=A.getX(T+1),S=A.getX(T+2),(f=w(this,p,e,P,C,_,b,S))&&(f.faceIndex=Math.floor(T/3),d.push(f));else if(void 0!==P)for(T=0,E=P.count;T<E;T+=3)(f=w(this,p,e,P,C,_=T,b=T+1,S=T+2))&&(f.index=_,d.push(f))}else if(m.isGeometry){var N,z,R,O,L=Array.isArray(g),U=m.vertices,D=m.faces,F=m.faceVertexUvs[0];F.length>0&&(O=F);for(var I=0,B=D.length;I<B;I++){var G=D[I],V=L?g[G.materialIndex]:g;if(void 0!==V){if(N=U[G.a],z=U[G.b],R=U[G.c],!0===V.morphTargets){var k=m.morphTargets,W=this.morphTargetInfluences;r.set(0,0,0),n.set(0,0,0),a.set(0,0,0);for(var j=0,X=k.length;j<X;j++){var H=W[j];if(0!==H){var Y=k[j].vertices;r.addScaledVector(s.subVectors(Y[G.a],N),H),n.addScaledVector(o.subVectors(Y[G.b],z),H),a.addScaledVector(h.subVectors(Y[G.c],R),H)}}r.add(N),n.add(z),a.add(R),N=r,z=n,R=a}if(f=x(this,V,p,e,N,z,R,v)){if(O&&O[I]){var q=O[I];u.copy(q[0]),l.copy(q[1]),c.copy(q[2]),f.uv=y(v,N,z,R,u,l,c)}f.face=G,f.faceIndex=I,d.push(f)}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Ge=0;function Ve(t){switch(t){case 3e3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+t)}}function ke(t,e){var i=Ve(e);return"vec4 "+t+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function We(t,e){var i;switch(e){case 1:i="Linear";break;case 2:i="Reinhard";break;case 3:i="Uncharted2";break;case 4:i="OptimizedCineon";break;default:throw new Error("unsupported toneMapping: "+e)}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function je(t){return""!==t}function Xe(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights)}function He(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}function Ye(t){return t.replace(/^[ \t]*#include +<([\w\d.]+)>/gm,(function(t,e){var i=vt[e];if(void 0===i)throw new Error("Can not resolve #include <"+e+">");return Ye(i)}))}function qe(t){return t.replace(/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,(function(t,e,i,r){for(var n="",a=parseInt(e);a<parseInt(i);a++)n+=r.replace(/\[ i \]/g,"[ "+a+" ]");return n}))}function Ze(t,e,i,r,n,a){var s=t.context,o=r.defines,h=n.vertexShader,u=n.fragmentShader,l="SHADOWMAP_TYPE_BASIC";1===a.shadowMapType?l="SHADOWMAP_TYPE_PCF":2===a.shadowMapType&&(l="SHADOWMAP_TYPE_PCF_SOFT");var c="ENVMAP_TYPE_CUBE",p="ENVMAP_MODE_REFLECTION",d="ENVMAP_BLENDING_MULTIPLY";if(a.envMap){switch(r.envMap.mapping){case 301:case 302:c="ENVMAP_TYPE_CUBE";break;case 306:case 307:c="ENVMAP_TYPE_CUBE_UV";break;case 303:case 304:c="ENVMAP_TYPE_EQUIREC";break;case 305:c="ENVMAP_TYPE_SPHERE"}switch(r.envMap.mapping){case 302:case 304:p="ENVMAP_MODE_REFRACTION"}switch(r.combine){case 0:d="ENVMAP_BLENDING_MULTIPLY";break;case 1:d="ENVMAP_BLENDING_MIX";break;case 2:d="ENVMAP_BLENDING_ADD"}}var f,m,v,g,y,x=t.gammaFactor>0?t.gammaFactor:1,w=function(t,e,i){return[(t=t||{}).derivatives||e.envMapCubeUV||e.bumpMap||e.normalMap||e.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(t.fragDepth||e.logarithmicDepthBuffer)&&i.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",t.drawBuffers&&i.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(t.shaderTextureLOD||e.envMap)&&i.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(je).join("\n")}(r.extensions,a,e),M=function(t){var e=[];for(var i in t){var r=t[i];!1!==r&&e.push("#define "+i+" "+r)}return e.join("\n")}(o),_=s.createProgram();r.isRawShaderMaterial?((f=[M].filter(je).join("\n")).length>0&&(f+="\n"),(m=[w,M].filter(je).join("\n")).length>0&&(m+="\n")):(f=["precision "+a.precision+" float;","precision "+a.precision+" int;","#define SHADER_NAME "+n.name,M,a.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+x,"#define MAX_BONES "+a.maxBones,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+p:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.displacementMap&&a.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.vertexColors?"#define USE_COLOR":"",a.flatShading?"#define FLAT_SHADED":"",a.skinning?"#define USE_SKINNING":"",a.useVertexTexture?"#define BONE_TEXTURE":"",a.morphTargets?"#define USE_MORPHTARGETS":"",a.morphNormals&&!1===a.flatShading?"#define USE_MORPHNORMALS":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+l:"",a.sizeAttenuation?"#define USE_SIZEATTENUATION":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&e.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR",`	attribute vec3 color;`,"#endif","#ifdef USE_MORPHTARGETS",`	attribute vec3 morphTarget0;`,`	attribute vec3 morphTarget1;`,`	attribute vec3 morphTarget2;`,`	attribute vec3 morphTarget3;`,`	#ifdef USE_MORPHNORMALS`,`		attribute vec3 morphNormal0;`,`		attribute vec3 morphNormal1;`,`		attribute vec3 morphNormal2;`,`		attribute vec3 morphNormal3;`,`	#else`,`		attribute vec3 morphTarget4;`,`		attribute vec3 morphTarget5;`,`		attribute vec3 morphTarget6;`,`		attribute vec3 morphTarget7;`,`	#endif`,"#endif","#ifdef USE_SKINNING",`	attribute vec4 skinIndex;`,`	attribute vec4 skinWeight;`,"#endif","\n"].filter(je).join("\n"),m=[w,"precision "+a.precision+" float;","precision "+a.precision+" int;","#define SHADER_NAME "+n.name,M,a.alphaTest?"#define ALPHATEST "+a.alphaTest:"","#define GAMMA_FACTOR "+x,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+c:"",a.envMap?"#define "+p:"",a.envMap?"#define "+d:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.vertexColors?"#define USE_COLOR":"",a.gradientMap?"#define USE_GRADIENTMAP":"",a.flatShading?"#define FLAT_SHADED":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+l:"",a.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",a.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&e.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",a.envMap&&e.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",0!==a.toneMapping?"#define TONE_MAPPING":"",0!==a.toneMapping?vt.tonemapping_pars_fragment:"",0!==a.toneMapping?We("toneMapping",a.toneMapping):"",a.dithering?"#define DITHERING":"",a.outputEncoding||a.mapEncoding||a.envMapEncoding||a.emissiveMapEncoding?vt.encodings_pars_fragment:"",a.mapEncoding?ke("mapTexelToLinear",a.mapEncoding):"",a.envMapEncoding?ke("envMapTexelToLinear",a.envMapEncoding):"",a.emissiveMapEncoding?ke("emissiveMapTexelToLinear",a.emissiveMapEncoding):"",a.outputEncoding?(v="linearToOutputTexel",g=a.outputEncoding,y=Ve(g),"vec4 "+v+"( vec4 value ) { return LinearTo"+y[0]+y[1]+"; }"):"",a.depthPacking?"#define DEPTH_PACKING "+r.depthPacking:"","\n"].filter(je).join("\n")),h=He(h=Xe(h=Ye(h),a),a),u=He(u=Xe(u=Ye(u),a),a);var b=f+(h=qe(h)),S=m+(u=qe(u)),T=Be(s,s.VERTEX_SHADER,b),E=Be(s,s.FRAGMENT_SHADER,S);s.attachShader(_,T),s.attachShader(_,E),void 0!==r.index0AttributeName?s.bindAttribLocation(_,0,r.index0AttributeName):!0===a.morphTargets&&s.bindAttribLocation(_,0,"position"),s.linkProgram(_);var A,P,C=s.getProgramInfoLog(_).trim(),N=s.getShaderInfoLog(T).trim(),z=s.getShaderInfoLog(E).trim(),R=!0,O=!0;return!1===s.getProgramParameter(_,s.LINK_STATUS)?R=!1:""!==C||""!==N&&""!==z||(O=!1),O&&(this.diagnostics={runnable:R,material:r,programLog:C,vertexShader:{log:N,prefix:f},fragmentShader:{log:z,prefix:m}}),s.deleteShader(T),s.deleteShader(E),this.getUniforms=function(){return void 0===A&&(A=new ot(s,_,t)),A},this.getAttributes=function(){return void 0===P&&(P=function(t,e){for(var i={},r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),n=0;n<r;n++){var a=t.getActiveAttrib(e,n).name;i[a]=t.getAttribLocation(e,a)}return i}(s,_)),P},this.destroy=function(){s.deleteProgram(_),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return this.getUniforms()}},attributes:{get:function(){return this.getAttributes()}}}),this.id=Ge++,this.code=i,this.usedTimes=1,this.program=_,this.vertexShader=T,this.fragmentShader=E,this}function Je(t,e,i){var r=[],n={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow"},a=["precision","supportsVertexTextures","map","mapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering"];function s(t,e){var i;return t?t.isTexture?i=t.encoding:t.isWebGLRenderTarget&&(i=t.texture.encoding):i=3e3,3e3===i&&e&&(i=3007),i}this.getParameters=function(e,r,a,o,h,u,l){var c=n[e.type],p=l.isSkinnedMesh?function(t){var e=t.skeleton.bones;if(i.floatVertexTextures)return 1024;var r=i.maxVertexUniforms,n=Math.floor((r-20)/4),a=Math.min(n,e.length);return a<e.length?0:a}(l):0,d=i.precision;null!==e.precision&&(d=i.getMaxPrecision(e.precision),e.precision);var f=t.getRenderTarget();return{shaderID:c,precision:d,supportsVertexTextures:i.vertexTextures,outputEncoding:s(f?f.texture:null,t.gammaOutput),map:!!e.map,mapEncoding:s(e.map,t.gammaInput),envMap:!!e.envMap,envMapMode:e.envMap&&e.envMap.mapping,envMapEncoding:s(e.envMap,t.gammaInput),envMapCubeUV:!!e.envMap&&(306===e.envMap.mapping||307===e.envMap.mapping),lightMap:!!e.lightMap,aoMap:!!e.aoMap,emissiveMap:!!e.emissiveMap,emissiveMapEncoding:s(e.emissiveMap,t.gammaInput),bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,displacementMap:!!e.displacementMap,roughnessMap:!!e.roughnessMap,metalnessMap:!!e.metalnessMap,specularMap:!!e.specularMap,alphaMap:!!e.alphaMap,gradientMap:!!e.gradientMap,combine:e.combine,vertexColors:e.vertexColors,fog:!!o,useFog:e.fog,fogExp:o&&o.isFogExp2,flatShading:e.flatShading,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:i.logarithmicDepthBuffer,skinning:e.skinning&&p>0,maxBones:p,useVertexTexture:i.floatVertexTextures,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,numDirLights:r.directional.length,numPointLights:r.point.length,numSpotLights:r.spot.length,numRectAreaLights:r.rectArea.length,numHemiLights:r.hemi.length,numClippingPlanes:h,numClipIntersection:u,dithering:e.dithering,shadowMapEnabled:t.shadowMap.enabled&&l.receiveShadow&&a.length>0,shadowMapType:t.shadowMap.type,toneMapping:t.toneMapping,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:e.premultipliedAlpha,alphaTest:e.alphaTest,doubleSided:2===e.side,flipSided:1===e.side,depthPacking:void 0!==e.depthPacking&&e.depthPacking}},this.getProgramCode=function(e,i){var r=[];if(i.shaderID?r.push(i.shaderID):(r.push(e.fragmentShader),r.push(e.vertexShader)),void 0!==e.defines)for(var n in e.defines)r.push(n),r.push(e.defines[n]);for(var s=0;s<a.length;s++)r.push(i[a[s]]);return r.push(e.onBeforeCompile.toString()),r.push(t.gammaOutput),r.join()},this.acquireProgram=function(i,n,a,s){for(var o,h=0,u=r.length;h<u;h++){var l=r[h];if(l.code===s){++(o=l).usedTimes;break}}return void 0===o&&(o=new Ze(t,e,s,i,n,a),r.push(o)),o},this.releaseProgram=function(t){if(0==--t.usedTimes){var e=r.indexOf(t);r[e]=r[r.length-1],r.pop(),t.destroy()}},this.programs=r}function Qe(t,e,i,r,n,a,s,o){var h,u="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext,l={};function p(t,e){if(t.width>e||t.height>e){var i=e/Math.max(t.width,t.height),r=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return r.width=Math.floor(t.width*i),r.height=Math.floor(t.height*i),r.getContext("2d").drawImage(t,0,0,t.width,t.height,0,0,r.width,r.height),r}return t}function d(t){return c.isPowerOfTwo(t.width)&&c.isPowerOfTwo(t.height)}function f(t,e){return t.generateMipmaps&&e&&1003!==t.minFilter&&1006!==t.minFilter}function m(e){return 1003===e||1004===e||1005===e?t.NEAREST:t.LINEAR}function v(e){var i=e.target;i.removeEventListener("dispose",v),function(e){var i=r.get(e);if(e.image&&i.__image__webglTextureCube)t.deleteTexture(i.__image__webglTextureCube);else{if(void 0===i.__webglInit)return;t.deleteTexture(i.__webglTexture)}r.remove(e)}(i),i.isVideoTexture&&delete l[i.id],s.textures--}function g(e){var i=e.target;i.removeEventListener("dispose",g),function(e){var i=r.get(e),n=r.get(e.texture);if(!e)return;void 0!==n.__webglTexture&&t.deleteTexture(n.__webglTexture);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLRenderTargetCube)for(var a=0;a<6;a++)t.deleteFramebuffer(i.__webglFramebuffer[a]),i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer[a]);else t.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer);r.remove(e.texture),r.remove(e)}(i),s.textures--}function y(e,m){var g=r.get(e);if(e.isVideoTexture&&function(t){var e=t.id,i=o.frame;l[e]!==i&&(l[e]=i,t.update())}(e),e.version>0&&g.__version!==e.version){var y=e.image;if(void 0===y);else if(!1!==y.complete)return void function(e,r,o){void 0===e.__webglInit&&(e.__webglInit=!0,r.addEventListener("dispose",v),e.__webglTexture=t.createTexture(),s.textures++);i.activeTexture(t.TEXTURE0+o),i.bindTexture(t.TEXTURE_2D,e.__webglTexture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,r.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,r.unpackAlignment);var l=p(r.image,n.maxTextureSize);(function(t){return 1001!==t.wrapS||1001!==t.wrapT||1003!==t.minFilter&&1006!==t.minFilter})(r)&&!1===d(l)&&(l=function(t){return t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageBitmap?(void 0===h&&(h=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),h.width=c.floorPowerOfTwo(t.width),h.height=c.floorPowerOfTwo(t.height),h.getContext("2d").drawImage(t,0,0,h.width,h.height),h):t}(l));var m=d(l),g=a.convert(r.format),y=a.convert(r.type);x(t.TEXTURE_2D,r,m);var w,M=r.mipmaps;if(r.isDepthTexture){var _=t.DEPTH_COMPONENT;if(1015===r.type){if(!u)throw new Error("Float Depth Texture only supported in WebGL2.0");_=t.DEPTH_COMPONENT32F}else u&&(_=t.DEPTH_COMPONENT16);1026===r.format&&_===t.DEPTH_COMPONENT&&1012!==r.type&&1014!==r.type&&(r.type=1012,y=a.convert(r.type)),1027===r.format&&(_=t.DEPTH_STENCIL,1020!==r.type&&(r.type=1020,y=a.convert(r.type))),i.texImage2D(t.TEXTURE_2D,0,_,l.width,l.height,0,g,y,null)}else if(r.isDataTexture)if(M.length>0&&m){for(var b=0,S=M.length;b<S;b++)w=M[b],i.texImage2D(t.TEXTURE_2D,b,g,w.width,w.height,0,g,y,w.data);r.generateMipmaps=!1}else i.texImage2D(t.TEXTURE_2D,0,g,l.width,l.height,0,g,y,l.data);else if(r.isCompressedTexture)for(b=0,S=M.length;b<S;b++)w=M[b],1023!==r.format&&1022!==r.format?i.getCompressedTextureFormats().indexOf(g)>-1&&i.compressedTexImage2D(t.TEXTURE_2D,b,g,w.width,w.height,0,w.data):i.texImage2D(t.TEXTURE_2D,b,g,w.width,w.height,0,g,y,w.data);else if(M.length>0&&m){for(b=0,S=M.length;b<S;b++)w=M[b],i.texImage2D(t.TEXTURE_2D,b,g,g,y,w);r.generateMipmaps=!1}else i.texImage2D(t.TEXTURE_2D,0,g,g,y,l);f(r,m)&&t.generateMipmap(t.TEXTURE_2D);e.__version=r.version,r.onUpdate&&r.onUpdate(r)}(g,e,m)}i.activeTexture(t.TEXTURE0+m),i.bindTexture(t.TEXTURE_2D,g.__webglTexture)}function x(i,s,o){var h;if(o?(t.texParameteri(i,t.TEXTURE_WRAP_S,a.convert(s.wrapS)),t.texParameteri(i,t.TEXTURE_WRAP_T,a.convert(s.wrapT)),t.texParameteri(i,t.TEXTURE_MAG_FILTER,a.convert(s.magFilter)),t.texParameteri(i,t.TEXTURE_MIN_FILTER,a.convert(s.minFilter))):(t.texParameteri(i,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(i,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),1001!==s.wrapS||s.wrapT,t.texParameteri(i,t.TEXTURE_MAG_FILTER,m(s.magFilter)),t.texParameteri(i,t.TEXTURE_MIN_FILTER,m(s.minFilter)),1003!==s.minFilter&&s.minFilter),h=e.get("EXT_texture_filter_anisotropic")){if(1015===s.type&&null===e.get("OES_texture_float_linear"))return;if(1016===s.type&&null===e.get("OES_texture_half_float_linear"))return;(s.anisotropy>1||r.get(s).__currentAnisotropy)&&(t.texParameterf(i,h.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,n.getMaxAnisotropy())),r.get(s).__currentAnisotropy=s.anisotropy)}}function w(e,n,s,o){var h=a.convert(n.texture.format),u=a.convert(n.texture.type);i.texImage2D(o,0,h,n.width,n.height,0,h,u,null),t.bindFramebuffer(t.FRAMEBUFFER,e),t.framebufferTexture2D(t.FRAMEBUFFER,s,o,r.get(n.texture).__webglTexture,0),t.bindFramebuffer(t.FRAMEBUFFER,null)}function M(e,i){t.bindRenderbuffer(t.RENDERBUFFER,e),i.depthBuffer&&!i.stencilBuffer?(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,i.width,i.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e)):i.depthBuffer&&i.stencilBuffer?(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,i.width,i.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,e)):t.renderbufferStorage(t.RENDERBUFFER,t.RGBA4,i.width,i.height),t.bindRenderbuffer(t.RENDERBUFFER,null)}function _(e){var i=r.get(e),n=!0===e.isWebGLRenderTargetCube;if(e.depthTexture){if(n)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,i){if(i&&i.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(t.FRAMEBUFFER,e),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),y(i.depthTexture,0);var n=r.get(i.depthTexture).__webglTexture;if(1026===i.depthTexture.format)t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,n,0);else{if(1027!==i.depthTexture.format)throw new Error("Unknown depthTexture format");t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,n,0)}}(i.__webglFramebuffer,e)}else if(n){i.__webglDepthbuffer=[];for(var a=0;a<6;a++)t.bindFramebuffer(t.FRAMEBUFFER,i.__webglFramebuffer[a]),i.__webglDepthbuffer[a]=t.createRenderbuffer(),M(i.__webglDepthbuffer[a],e)}else t.bindFramebuffer(t.FRAMEBUFFER,i.__webglFramebuffer),i.__webglDepthbuffer=t.createRenderbuffer(),M(i.__webglDepthbuffer,e);t.bindFramebuffer(t.FRAMEBUFFER,null)}this.setTexture2D=y,this.setTextureCube=function(e,o){var h=r.get(e);if(6===e.image.length)if(e.version>0&&h.__version!==e.version){h.__image__webglTextureCube||(e.addEventListener("dispose",v),h.__image__webglTextureCube=t.createTexture(),s.textures++),i.activeTexture(t.TEXTURE0+o),i.bindTexture(t.TEXTURE_CUBE_MAP,h.__image__webglTextureCube),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e.flipY);for(var u=e&&e.isCompressedTexture,l=e.image[0]&&e.image[0].isDataTexture,c=[],m=0;m<6;m++)c[m]=u||l?l?e.image[m].image:e.image[m]:p(e.image[m],n.maxCubemapSize);var g=d(c[0]),y=a.convert(e.format),w=a.convert(e.type);x(t.TEXTURE_CUBE_MAP,e,g);for(m=0;m<6;m++)if(u)for(var M,_=c[m].mipmaps,b=0,S=_.length;b<S;b++)M=_[b],1023!==e.format&&1022!==e.format?i.getCompressedTextureFormats().indexOf(y)>-1&&i.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+m,b,y,M.width,M.height,0,M.data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+m,b,y,M.width,M.height,0,y,w,M.data);else l?i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+m,0,y,c[m].width,c[m].height,0,y,w,c[m].data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+m,0,y,y,w,c[m]);f(e,g)&&t.generateMipmap(t.TEXTURE_CUBE_MAP),h.__version=e.version,e.onUpdate&&e.onUpdate(e)}else i.activeTexture(t.TEXTURE0+o),i.bindTexture(t.TEXTURE_CUBE_MAP,h.__image__webglTextureCube)},this.setTextureCubeDynamic=function(e,n){i.activeTexture(t.TEXTURE0+n),i.bindTexture(t.TEXTURE_CUBE_MAP,r.get(e).__webglTexture)},this.setupRenderTarget=function(e){var n=r.get(e),a=r.get(e.texture);e.addEventListener("dispose",g),a.__webglTexture=t.createTexture(),s.textures++;var o=!0===e.isWebGLRenderTargetCube,h=d(e);if(o){n.__webglFramebuffer=[];for(var u=0;u<6;u++)n.__webglFramebuffer[u]=t.createFramebuffer()}else n.__webglFramebuffer=t.createFramebuffer();if(o){i.bindTexture(t.TEXTURE_CUBE_MAP,a.__webglTexture),x(t.TEXTURE_CUBE_MAP,e.texture,h);for(u=0;u<6;u++)w(n.__webglFramebuffer[u],e,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+u);f(e.texture,h)&&t.generateMipmap(t.TEXTURE_CUBE_MAP),i.bindTexture(t.TEXTURE_CUBE_MAP,null)}else i.bindTexture(t.TEXTURE_2D,a.__webglTexture),x(t.TEXTURE_2D,e.texture,h),w(n.__webglFramebuffer,e,t.COLOR_ATTACHMENT0,t.TEXTURE_2D),f(e.texture,h)&&t.generateMipmap(t.TEXTURE_2D),i.bindTexture(t.TEXTURE_2D,null);e.depthBuffer&&_(e)},this.updateRenderTargetMipmap=function(e){var n=e.texture;if(f(n,d(e))){var a=e.isWebGLRenderTargetCube?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D,s=r.get(n).__webglTexture;i.bindTexture(a,s),t.generateMipmap(a),i.bindTexture(a,null)}}}function Ke(){var t={};return{get:function(e){var i=e.uuid,r=t[i];return void 0===r&&(r={},t[i]=r),r},remove:function(e){delete t[e.uuid]},update:function(e,i,r){var n=e.uuid;t[n][i]=r},dispose:function(){t={}}}}function $e(t,e,i){var r=new function(){var e=!1,i=new x,r=null,n=new x(0,0,0,0);return{setMask:function(i){r===i||e||(t.colorMask(i,i,i,i),r=i)},setLocked:function(t){e=t},setClear:function(e,r,a,s,o){!0===o&&(e*=s,r*=s,a*=s),i.set(e,r,a,s),!1===n.equals(i)&&(t.clearColor(e,r,a,s),n.copy(i))},reset:function(){e=!1,r=null,n.set(-1,0,0,0)}}},n=new function(){var e=!1,i=null,r=null,n=null;return{setTest:function(e){e?F(t.DEPTH_TEST):I(t.DEPTH_TEST)},setMask:function(r){i===r||e||(t.depthMask(r),i=r)},setFunc:function(e){if(r!==e){if(e)switch(e){case 0:t.depthFunc(t.NEVER);break;case 1:t.depthFunc(t.ALWAYS);break;case 2:t.depthFunc(t.LESS);break;case 3:default:t.depthFunc(t.LEQUAL);break;case 4:t.depthFunc(t.EQUAL);break;case 5:t.depthFunc(t.GEQUAL);break;case 6:t.depthFunc(t.GREATER);break;case 7:t.depthFunc(t.NOTEQUAL)}else t.depthFunc(t.LEQUAL);r=e}},setLocked:function(t){e=t},setClear:function(e){n!==e&&(t.clearDepth(e),n=e)},reset:function(){e=!1,i=null,r=null,n=null}}},a=new function(){var e=!1,i=null,r=null,n=null,a=null,s=null,o=null,h=null,u=null;return{setTest:function(e){e?F(t.STENCIL_TEST):I(t.STENCIL_TEST)},setMask:function(r){i===r||e||(t.stencilMask(r),i=r)},setFunc:function(e,i,s){r===e&&n===i&&a===s||(t.stencilFunc(e,i,s),r=e,n=i,a=s)},setOp:function(e,i,r){s===e&&o===i&&h===r||(t.stencilOp(e,i,r),s=e,o=i,h=r)},setLocked:function(t){e=t},setClear:function(e){u!==e&&(t.clearStencil(e),u=e)},reset:function(){e=!1,i=null,r=null,n=null,a=null,s=null,o=null,h=null,u=null}}},s=t.getParameter(t.MAX_VERTEX_ATTRIBS),o=new Uint8Array(s),h=new Uint8Array(s),u=new Uint8Array(s),l={},c=null,p=null,d=null,f=null,m=null,v=null,g=null,y=null,w=null,M=!1,_=null,b=null,S=null,T=null,E=null,A=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS),P=!1,C=0,N=t.getParameter(t.VERSION);-1!==N.indexOf("WebGL")?(C=parseFloat(/^WebGL\ ([0-9])/.exec(N)[1]),P=C>=1):-1!==N.indexOf("OpenGL ES")&&(C=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(N)[1]),P=C>=2);var z=null,R={},O=new x,L=new x;function U(e,i,r){var n=new Uint8Array(4),a=t.createTexture();t.bindTexture(e,a),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.NEAREST);for(var s=0;s<r;s++)t.texImage2D(i+s,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,n);return a}var D={};function F(e){!0!==l[e]&&(t.enable(e),l[e]=!0)}function I(e){!1!==l[e]&&(t.disable(e),l[e]=!1)}function B(e,r,n,a,s,o,h,u){if(0!==e?F(t.BLEND):I(t.BLEND),5!==e){if(e!==d||u!==M)switch(e){case 2:u?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ONE,t.ONE,t.ONE)):(t.blendEquation(t.FUNC_ADD),t.blendFunc(t.SRC_ALPHA,t.ONE));break;case 3:u?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ZERO,t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ONE_MINUS_SRC_ALPHA)):(t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ZERO,t.ONE_MINUS_SRC_COLOR));break;case 4:u?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA)):(t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ZERO,t.SRC_COLOR));break;default:u?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA)):(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA))}f=null,m=null,v=null,g=null,y=null,w=null}else s=s||r,o=o||n,h=h||a,r===f&&s===g||(t.blendEquationSeparate(i.convert(r),i.convert(s)),f=r,g=s),n===m&&a===v&&o===y&&h===w||(t.blendFuncSeparate(i.convert(n),i.convert(a),i.convert(o),i.convert(h)),m=n,v=a,y=o,w=h);d=e,M=u}function G(e){_!==e&&(e?t.frontFace(t.CW):t.frontFace(t.CCW),_=e)}function V(e){0!==e?(F(t.CULL_FACE),e!==b&&(1===e?t.cullFace(t.BACK):2===e?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):I(t.CULL_FACE),b=e}function k(e,i,r){e?(F(t.POLYGON_OFFSET_FILL),T===i&&E===r||(t.polygonOffset(i,r),T=i,E=r)):I(t.POLYGON_OFFSET_FILL)}function W(e){void 0===e&&(e=t.TEXTURE0+A-1),z!==e&&(t.activeTexture(e),z=e)}return D[t.TEXTURE_2D]=U(t.TEXTURE_2D,t.TEXTURE_2D,1),D[t.TEXTURE_CUBE_MAP]=U(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),r.setClear(0,0,0,1),n.setClear(1),a.setClear(0),F(t.DEPTH_TEST),n.setFunc(3),G(!1),V(1),F(t.CULL_FACE),F(t.BLEND),B(1),{buffers:{color:r,depth:n,stencil:a},initAttributes:function(){for(var t=0,e=o.length;t<e;t++)o[t]=0},enableAttribute:function(i){o[i]=1,0===h[i]&&(t.enableVertexAttribArray(i),h[i]=1),0!==u[i]&&(e.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(i,0),u[i]=0)},enableAttributeAndDivisor:function(i,r){o[i]=1,0===h[i]&&(t.enableVertexAttribArray(i),h[i]=1),u[i]!==r&&(e.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(i,r),u[i]=r)},disableUnusedAttributes:function(){for(var e=0,i=h.length;e!==i;++e)h[e]!==o[e]&&(t.disableVertexAttribArray(e),h[e]=0)},enable:F,disable:I,getCompressedTextureFormats:function(){if(null===c&&(c=[],e.get("WEBGL_compressed_texture_pvrtc")||e.get("WEBGL_compressed_texture_s3tc")||e.get("WEBGL_compressed_texture_etc1")||e.get("WEBGL_compressed_texture_astc")))for(var i=t.getParameter(t.COMPRESSED_TEXTURE_FORMATS),r=0;r<i.length;r++)c.push(i[r]);return c},useProgram:function(e){return p!==e&&(t.useProgram(e),p=e,!0)},setBlending:B,setMaterial:function(e,i){2===e.side?I(t.CULL_FACE):F(t.CULL_FACE);var a=1===e.side;i&&(a=!a),G(a),!0===e.transparent?B(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha):B(0),n.setFunc(e.depthFunc),n.setTest(e.depthTest),n.setMask(e.depthWrite),r.setMask(e.colorWrite),k(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:G,setCullFace:V,setLineWidth:function(e){e!==S&&(P&&t.lineWidth(e),S=e)},setPolygonOffset:k,setScissorTest:function(e){e?F(t.SCISSOR_TEST):I(t.SCISSOR_TEST)},activeTexture:W,bindTexture:function(e,i){null===z&&W();var r=R[z];void 0===r&&(r={type:void 0,texture:void 0},R[z]=r),r.type===e&&r.texture===i||(t.bindTexture(e,i||D[e]),r.type=e,r.texture=i)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){}},scissor:function(e){!1===O.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),O.copy(e))},viewport:function(e){!1===L.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),L.copy(e))},reset:function(){for(var e=0;e<h.length;e++)1===h[e]&&(t.disableVertexAttribArray(e),h[e]=0);l={},c=null,z=null,R={},p=null,d=null,_=null,b=null,r.reset(),n.reset(),a.reset()}}}function ti(t,e,i){var r;function n(e){if("highp"===e){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var a=void 0!==i.precision?i.precision:"highp",s=n(a);s!==a&&(a=s);var o=!0===i.logarithmicDepthBuffer,h=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),u=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),l=t.getParameter(t.MAX_TEXTURE_SIZE),c=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),p=t.getParameter(t.MAX_VERTEX_ATTRIBS),d=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),f=t.getParameter(t.MAX_VARYING_VECTORS),m=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),v=u>0,g=!!e.get("OES_texture_float");return{getMaxAnisotropy:function(){if(void 0!==r)return r;var i=e.get("EXT_texture_filter_anisotropic");return r=null!==i?t.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:n,precision:a,logarithmicDepthBuffer:o,maxTextures:h,maxVertexTextures:u,maxTextureSize:l,maxCubemapSize:c,maxAttributes:p,maxVertexUniforms:d,maxVaryings:f,maxFragmentUniforms:m,vertexTextures:v,floatFragmentTextures:g,floatVertexTextures:v&&g}}function ei(t,e,i,r){Xt.call(this),this.type="PerspectiveCamera",this.fov=void 0!==t?t:50,this.zoom=1,this.near=void 0!==i?i:.1,this.far=void 0!==r?r:2e3,this.focus=10,this.aspect=void 0!==e?e:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function ii(t){ei.call(this),this.cameras=t||[]}function ri(t){var e=this,i=null,r=null,n=null,a=new d,s=new d;"undefined"!=typeof window&&"VRFrameData"in window&&(r=new window.VRFrameData);var o=new d,h=new ei;h.bounds=new x(0,0,.5,1),h.layers.enable(1);var u=new ei;u.bounds=new x(.5,0,.5,1),u.layers.enable(2);var l,c,p=new ii([h,u]);function f(){if(null!==i&&i.isPresenting){var r=i.getEyeParameters("left"),n=r.renderWidth,a=r.renderHeight;c=t.getPixelRatio(),l=t.getSize(),t.setDrawingBufferSize(2*n,a,1)}else e.enabled&&t.setDrawingBufferSize(l.width,l.height,c)}p.layers.enable(1),p.layers.enable(2),"undefined"!=typeof window&&window.addEventListener("vrdisplaypresentchange",f,!1),this.enabled=!1,this.userHeight=1.6,this.getDevice=function(){return i},this.setDevice=function(t){void 0!==t&&(i=t)},this.setPoseTarget=function(t){void 0!==t&&(n=t)},this.getCamera=function(t){if(null===i)return t;i.depthNear=t.near,i.depthFar=t.far,i.getFrameData(r);var l=r.pose,c=null!==n?n:t;null!==l.position?c.position.fromArray(l.position):c.position.set(0,0,0),null!==l.orientation&&c.quaternion.fromArray(l.orientation);var d=i.stageParameters;if(d?a.fromArray(d.sittingToStandingTransform):a.makeTranslation(0,e.userHeight,0),c.position.applyMatrix4(a),c.updateMatrixWorld(),!1===i.isPresenting)return t;h.near=t.near,u.near=t.near,h.far=t.far,u.far=t.far,p.matrixWorld.copy(t.matrixWorld),p.matrixWorldInverse.copy(t.matrixWorldInverse),h.matrixWorldInverse.fromArray(r.leftViewMatrix),u.matrixWorldInverse.fromArray(r.rightViewMatrix),s.getInverse(a),h.matrixWorldInverse.multiply(s),u.matrixWorldInverse.multiply(s);var f=c.parent;null!==f&&(o.getInverse(f.matrixWorld),h.matrixWorldInverse.multiply(o),u.matrixWorldInverse.multiply(o)),h.matrixWorld.getInverse(h.matrixWorldInverse),u.matrixWorld.getInverse(u.matrixWorldInverse),h.projectionMatrix.fromArray(r.leftProjectionMatrix),u.projectionMatrix.fromArray(r.rightProjectionMatrix),p.projectionMatrix.copy(h.projectionMatrix);var m=i.getLayers();if(m.length){var v=m[0];null!==v.leftBounds&&4===v.leftBounds.length&&h.bounds.fromArray(v.leftBounds),null!==v.rightBounds&&4===v.rightBounds.length&&u.bounds.fromArray(v.rightBounds)}return p},this.getStandingMatrix=function(){return a},this.submitFrame=function(){i&&i.isPresenting&&i.submitFrame()},this.dispose=function(){"undefined"!=typeof window&&window.removeEventListener("vrdisplaypresentchange",f)}}function ni(t){var e={};return{get:function(i){if(void 0!==e[i])return e[i];var r;switch(i){case"WEBGL_depth_texture":r=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"WEBGL_compressed_texture_etc1":r=t.getExtension("WEBGL_compressed_texture_etc1");break;default:r=t.getExtension(i)}return e[i]=r,r}}}function ai(){var t=this,e=null,i=0,r=!1,n=!1,a=new Ot,s=new v,o={value:null,needsUpdate:!1};function h(){o.value!==e&&(o.value=e,o.needsUpdate=i>0),t.numPlanes=i,t.numIntersection=0}function u(e,i,r,n){var h=null!==e?e.length:0,u=null;if(0!==h){if(u=o.value,!0!==n||null===u){var l=r+4*h,c=i.matrixWorldInverse;s.getNormalMatrix(c),(null===u||u.length<l)&&(u=new Float32Array(l));for(var p=0,d=r;p!==h;++p,d+=4)a.copy(e[p]).applyMatrix4(c,s),a.normal.toArray(u,d),u[d+3]=a.constant}o.value=u,o.needsUpdate=!0}return t.numPlanes=h,u}this.uniform=o,this.numPlanes=0,this.numIntersection=0,this.init=function(t,n,a){var s=0!==t.length||n||0!==i||r;return r=n,e=u(t,a,0),i=t.length,s},this.beginShadows=function(){n=!0,u(null)},this.endShadows=function(){n=!1,h()},this.setState=function(t,a,s,l,c,p){if(!r||null===t||0===t.length||n&&!s)n?u(null):h();else{var d=n?0:i,f=4*d,m=c.clippingState||null;o.value=m,m=u(t,l,f,p);for(var v=0;v!==f;++v)m[v]=e[v];c.clippingState=m,this.numIntersection=a?this.numPlanes:0,this.numPlanes+=d}}}function si(t,e){return{convert:function(i){var r;if(1e3===i)return t.REPEAT;if(1001===i)return t.CLAMP_TO_EDGE;if(1002===i)return t.MIRRORED_REPEAT;if(1003===i)return t.NEAREST;if(1004===i)return t.NEAREST_MIPMAP_NEAREST;if(1005===i)return t.NEAREST_MIPMAP_LINEAR;if(1006===i)return t.LINEAR;if(1007===i)return t.LINEAR_MIPMAP_NEAREST;if(1008===i)return t.LINEAR_MIPMAP_LINEAR;if(1009===i)return t.UNSIGNED_BYTE;if(1017===i)return t.UNSIGNED_SHORT_4_4_4_4;if(1018===i)return t.UNSIGNED_SHORT_5_5_5_1;if(1019===i)return t.UNSIGNED_SHORT_5_6_5;if(1010===i)return t.BYTE;if(1011===i)return t.SHORT;if(1012===i)return t.UNSIGNED_SHORT;if(1013===i)return t.INT;if(1014===i)return t.UNSIGNED_INT;if(1015===i)return t.FLOAT;if(1016===i&&null!==(r=e.get("OES_texture_half_float")))return r.HALF_FLOAT_OES;if(1021===i)return t.ALPHA;if(1022===i)return t.RGB;if(1023===i)return t.RGBA;if(1024===i)return t.LUMINANCE;if(1025===i)return t.LUMINANCE_ALPHA;if(1026===i)return t.DEPTH_COMPONENT;if(1027===i)return t.DEPTH_STENCIL;if(100===i)return t.FUNC_ADD;if(101===i)return t.FUNC_SUBTRACT;if(102===i)return t.FUNC_REVERSE_SUBTRACT;if(200===i)return t.ZERO;if(201===i)return t.ONE;if(202===i)return t.SRC_COLOR;if(203===i)return t.ONE_MINUS_SRC_COLOR;if(204===i)return t.SRC_ALPHA;if(205===i)return t.ONE_MINUS_SRC_ALPHA;if(206===i)return t.DST_ALPHA;if(207===i)return t.ONE_MINUS_DST_ALPHA;if(208===i)return t.DST_COLOR;if(209===i)return t.ONE_MINUS_DST_COLOR;if(210===i)return t.SRC_ALPHA_SATURATE;if((33776===i||33777===i||33778===i||33779===i)&&null!==(r=e.get("WEBGL_compressed_texture_s3tc"))){if(33776===i)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===i)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===i)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===i)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((35840===i||35841===i||35842===i||35843===i)&&null!==(r=e.get("WEBGL_compressed_texture_pvrtc"))){if(35840===i)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===i)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===i)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===i)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===i&&null!==(r=e.get("WEBGL_compressed_texture_etc1")))return r.COMPRESSED_RGB_ETC1_WEBGL;if((37808===i||37809===i||37810===i||37811===i||37812===i||37813===i||37814===i||37815===i||37816===i||37817===i||37818===i||37819===i||37820===i||37821===i)&&null!==(r=e.get("WEBGL_compressed_texture_astc")))return i;if((103===i||104===i)&&null!==(r=e.get("EXT_blend_minmax"))){if(103===i)return r.MIN_EXT;if(104===i)return r.MAX_EXT}return 1020===i&&null!==(r=e.get("WEBGL_depth_texture"))?r.UNSIGNED_INT_24_8_WEBGL:0}}}function oi(){var t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];var i;switch(e.type){case"DirectionalLight":i={direction:new m,color:new ut,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new p};break;case"SpotLight":i={position:new m,direction:new m,color:new ut,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new p};break;case"PointLight":i={position:new m,color:new ut,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new p,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":i={direction:new m,skyColor:new ut,groundColor:new ut};break;case"RectAreaLight":i={color:new ut,position:new m,halfWidth:new m,halfHeight:new m}}return t[e.id]=i,i}}}ei.prototype=Object.assign(Object.create(Xt.prototype),{constructor:ei,isPerspectiveCamera:!0,copy:function(t,e){return Xt.prototype.copy.call(this,t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){var e=.5*this.getFilmHeight()/t;this.fov=2*c.RAD2DEG*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){var t=Math.tan(.5*c.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*c.RAD2DEG*Math.atan(Math.tan(.5*c.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,i,r,n,a){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=this.near,e=t*Math.tan(.5*c.DEG2RAD*this.fov)/this.zoom,i=2*e,r=this.aspect*i,n=-.5*r,a=this.view;if(null!==this.view&&this.view.enabled){var s=a.fullWidth,o=a.fullHeight;n+=a.offsetX*r/s,e-=a.offsetY*i/o,r*=a.width/s,i*=a.height/o}var h=this.filmOffset;0!==h&&(n+=t*h/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+r,e,e-i,t,this.far)},toJSON:function(t){var e=jt.prototype.toJSON.call(this,t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}),ii.prototype=Object.assign(Object.create(ei.prototype),{constructor:ii,isArrayCamera:!0});var hi=0;function ui(){var t=new oi,e={id:hi++,hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},i=new m,r=new d,n=new d;return{setup:function(a,s,o){for(var h=0,u=0,l=0,c=0,p=0,d=0,f=0,m=0,v=o.matrixWorldInverse,g=0,y=a.length;g<y;g++){var x=a[g],w=x.color,M=x.intensity,_=x.distance,b=x.shadow&&x.shadow.map?x.shadow.map.texture:null;if(x.isAmbientLight)h+=w.r*M,u+=w.g*M,l+=w.b*M;else if(x.isDirectionalLight){if((T=t.get(x)).color.copy(x.color).multiplyScalar(x.intensity),T.direction.setFromMatrixPosition(x.matrixWorld),i.setFromMatrixPosition(x.target.matrixWorld),T.direction.sub(i),T.direction.transformDirection(v),T.shadow=x.castShadow,x.castShadow){var S=x.shadow;T.shadowBias=S.bias,T.shadowRadius=S.radius,T.shadowMapSize=S.mapSize}e.directionalShadowMap[c]=b,e.directionalShadowMatrix[c]=x.shadow.matrix,e.directional[c]=T,c++}else if(x.isSpotLight){if((T=t.get(x)).position.setFromMatrixPosition(x.matrixWorld),T.position.applyMatrix4(v),T.color.copy(w).multiplyScalar(M),T.distance=_,T.direction.setFromMatrixPosition(x.matrixWorld),i.setFromMatrixPosition(x.target.matrixWorld),T.direction.sub(i),T.direction.transformDirection(v),T.coneCos=Math.cos(x.angle),T.penumbraCos=Math.cos(x.angle*(1-x.penumbra)),T.decay=0===x.distance?0:x.decay,T.shadow=x.castShadow,x.castShadow){S=x.shadow;T.shadowBias=S.bias,T.shadowRadius=S.radius,T.shadowMapSize=S.mapSize}e.spotShadowMap[d]=b,e.spotShadowMatrix[d]=x.shadow.matrix,e.spot[d]=T,d++}else if(x.isRectAreaLight){(T=t.get(x)).color.copy(w).multiplyScalar(M),T.position.setFromMatrixPosition(x.matrixWorld),T.position.applyMatrix4(v),n.identity(),r.copy(x.matrixWorld),r.premultiply(v),n.extractRotation(r),T.halfWidth.set(.5*x.width,0,0),T.halfHeight.set(0,.5*x.height,0),T.halfWidth.applyMatrix4(n),T.halfHeight.applyMatrix4(n),e.rectArea[f]=T,f++}else if(x.isPointLight){if((T=t.get(x)).position.setFromMatrixPosition(x.matrixWorld),T.position.applyMatrix4(v),T.color.copy(x.color).multiplyScalar(x.intensity),T.distance=x.distance,T.decay=0===x.distance?0:x.decay,T.shadow=x.castShadow,x.castShadow){S=x.shadow;T.shadowBias=S.bias,T.shadowRadius=S.radius,T.shadowMapSize=S.mapSize,T.shadowCameraNear=S.camera.near,T.shadowCameraFar=S.camera.far}e.pointShadowMap[p]=b,e.pointShadowMatrix[p]=x.shadow.matrix,e.point[p]=T,p++}else if(x.isHemisphereLight){var T;(T=t.get(x)).direction.setFromMatrixPosition(x.matrixWorld),T.direction.transformDirection(v),T.direction.normalize(),T.skyColor.copy(x.color).multiplyScalar(M),T.groundColor.copy(x.groundColor).multiplyScalar(M),e.hemi[m]=T,m++}}e.ambient[0]=h,e.ambient[1]=u,e.ambient[2]=l,e.directional.length=c,e.spot.length=d,e.rectArea.length=f,e.point.length=p,e.hemi.length=m,e.hash=e.id+","+c+","+p+","+d+","+f+","+m+","+s.length},state:e}}function li(){var t=new ui,e=[],i=[],r=[];return{init:function(){e.length=0,i.length=0,r.length=0},state:{lightsArray:e,shadowsArray:i,spritesArray:r,lights:t},setupLights:function(r){t.setup(e,i,r)},pushLight:function(t){e.push(t)},pushShadow:function(t){i.push(t)},pushSprite:function(t){r.push(t)}}}function ci(){var t={};return{get:function(e,i){var r=e.id+","+i.id,n=t[r];return void 0===n&&(n=new li,t[r]=n),n},dispose:function(){t={}}}}function pi(t){var e=void 0!==(t=t||{}).canvas?t.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),i=void 0!==t.context?t.context:null,r=void 0!==t.alpha&&t.alpha,n=void 0===t.depth||t.depth,a=void 0===t.stencil||t.stencil,s=void 0!==t.antialias&&t.antialias,o=void 0===t.premultipliedAlpha||t.premultipliedAlpha,h=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,u=void 0!==t.powerPreference?t.powerPreference:"default",l=null,p=null;this.domElement=e,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=1,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var f,v,g,y,w,_,b,S,T,E,A,P,C,N,z,R,O,L,U=this,D=!1,F=null,I=null,B=-1,G="",V=null,k=null,W=new x,j=new x,X=null,H=0,Y=e.width,q=e.height,Z=1,J=new x(0,0,Y,q),Q=new x(0,0,Y,q),K=!1,$=new Lt,tt=new ai,et=!1,it=!1,rt=new d,nt=new m,at={geometries:0,textures:0},st={frame:0,calls:0,vertices:0,faces:0,points:0};function ht(){return null===F?Z:1}this.info={render:st,memory:at,programs:null,autoReset:!0,reset:function(){st.frame++,st.calls=0,st.vertices=0,st.faces=0,st.points=0}};try{var ut={alpha:r,depth:n,stencil:a,antialias:s,premultipliedAlpha:o,preserveDrawingBuffer:h,powerPreference:u};if(e.addEventListener("webglcontextlost",mt,!1),e.addEventListener("webglcontextrestored",vt,!1),null===(f=i||e.getContext("webgl",ut)||e.getContext("experimental-webgl",ut)))throw null!==e.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===f.getShaderPrecisionFormat&&(f.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){}function pt(){(v=new ni(f)).get("WEBGL_depth_texture"),v.get("OES_texture_float"),v.get("OES_texture_float_linear"),v.get("OES_texture_half_float"),v.get("OES_texture_half_float_linear"),v.get("OES_standard_derivatives"),v.get("OES_element_index_uint"),v.get("ANGLE_instanced_arrays"),L=new si(f,v),g=new ti(f,v,t),(y=new $e(f,v,L)).scissor(j.copy(Q).multiplyScalar(Z)),y.viewport(W.copy(J).multiplyScalar(Z)),w=new Ke,_=new Qe(f,v,y,w,g,L,at,st),b=new Dt(f),S=new Fe(f,b,at),T=new Ie(S,st),N=new Le(f),E=new Je(U,v,g),A=new Re,P=new ci,C=new Pe(U,y,S,o),z=new De(f,v,st),R=new Ue(f,v,st),O=new xt(U,f,y,_,g),U.info.programs=E.programs,U.context=f,U.capabilities=g,U.extensions=v,U.properties=w,U.renderLists=A,U.state=y}pt();var dt=new ri(U);this.vr=dt;var ft=new Ut(U,T,g.maxTextureSize);function mt(t){t.preventDefault(),D=!0}function vt(){D=!1,pt()}function yt(t){var e=t.target;e.removeEventListener("dispose",yt),function(t){wt(t),w.remove(t)}(e)}function wt(t){var e=w.get(t).program;t.program=void 0,void 0!==e&&E.releaseProgram(e)}this.shadowMap=ft,this.getContext=function(){return f},this.getContextAttributes=function(){return f.getContextAttributes()},this.forceContextLoss=function(){var t=v.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){var t=v.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return Z},this.setPixelRatio=function(t){void 0!==t&&(Z=t,this.setSize(Y,q,!1))},this.getSize=function(){return{width:Y,height:q}},this.setSize=function(t,i,r){var n=dt.getDevice();n&&n.isPresenting||(Y=t,q=i,e.width=t*Z,e.height=i*Z,!1!==r&&(e.style.width=t+"px",e.style.height=i+"px"),this.setViewport(0,0,t,i))},this.getDrawingBufferSize=function(){return{width:Y*Z,height:q*Z}},this.setDrawingBufferSize=function(t,i,r){Y=t,q=i,Z=r,e.width=t*r,e.height=i*r,this.setViewport(0,0,t,i)},this.getCurrentViewport=function(){return W},this.setViewport=function(t,e,i,r){J.set(t,q-e-r,i,r),y.viewport(W.copy(J).multiplyScalar(Z))},this.setScissor=function(t,e,i,r){Q.set(t,q-e-r,i,r),y.scissor(j.copy(Q).multiplyScalar(Z))},this.setScissorTest=function(t){y.setScissorTest(K=t)},this.getClearColor=function(){return C.getClearColor()},this.setClearColor=function(){C.setClearColor.apply(C,arguments)},this.getClearAlpha=function(){return C.getClearAlpha()},this.setClearAlpha=function(){C.setClearAlpha.apply(C,arguments)},this.clear=function(t,e,i){var r=0;(void 0===t||t)&&(r|=f.COLOR_BUFFER_BIT),(void 0===e||e)&&(r|=f.DEPTH_BUFFER_BIT),(void 0===i||i)&&(r|=f.STENCIL_BUFFER_BIT),f.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.clearTarget=function(t,e,i,r){this.setRenderTarget(t),this.clear(e,i,r)},this.dispose=function(){e.removeEventListener("webglcontextlost",mt,!1),e.removeEventListener("webglcontextrestored",vt,!1),A.dispose(),P.dispose(),w.dispose(),T.dispose(),dt.dispose(),St()},this.renderBufferImmediate=function(t,e,i){y.initAttributes();var r=w.get(t);t.hasPositions&&!r.position&&(r.position=f.createBuffer()),t.hasNormals&&!r.normal&&(r.normal=f.createBuffer()),t.hasUvs&&!r.uv&&(r.uv=f.createBuffer()),t.hasColors&&!r.color&&(r.color=f.createBuffer());var n=e.getAttributes();if(t.hasPositions&&(f.bindBuffer(f.ARRAY_BUFFER,r.position),f.bufferData(f.ARRAY_BUFFER,t.positionArray,f.DYNAMIC_DRAW),y.enableAttribute(n.position),f.vertexAttribPointer(n.position,3,f.FLOAT,!1,0,0)),t.hasNormals){if(f.bindBuffer(f.ARRAY_BUFFER,r.normal),!i.isMeshPhongMaterial&&!i.isMeshStandardMaterial&&!i.isMeshNormalMaterial&&!0===i.flatShading)for(var a=0,s=3*t.count;a<s;a+=9){var o=t.normalArray,h=(o[a+0]+o[a+3]+o[a+6])/3,u=(o[a+1]+o[a+4]+o[a+7])/3,l=(o[a+2]+o[a+5]+o[a+8])/3;o[a+0]=h,o[a+1]=u,o[a+2]=l,o[a+3]=h,o[a+4]=u,o[a+5]=l,o[a+6]=h,o[a+7]=u,o[a+8]=l}f.bufferData(f.ARRAY_BUFFER,t.normalArray,f.DYNAMIC_DRAW),y.enableAttribute(n.normal),f.vertexAttribPointer(n.normal,3,f.FLOAT,!1,0,0)}t.hasUvs&&i.map&&(f.bindBuffer(f.ARRAY_BUFFER,r.uv),f.bufferData(f.ARRAY_BUFFER,t.uvArray,f.DYNAMIC_DRAW),y.enableAttribute(n.uv),f.vertexAttribPointer(n.uv,2,f.FLOAT,!1,0,0)),t.hasColors&&0!==i.vertexColors&&(f.bindBuffer(f.ARRAY_BUFFER,r.color),f.bufferData(f.ARRAY_BUFFER,t.colorArray,f.DYNAMIC_DRAW),y.enableAttribute(n.color),f.vertexAttribPointer(n.color,3,f.FLOAT,!1,0,0)),y.disableUnusedAttributes(),f.drawArrays(f.TRIANGLES,0,t.count),t.count=0},this.renderBufferDirect=function(t,e,i,r,n,a){var s=n.isMesh&&n.matrixWorld.determinant()<0;y.setMaterial(r,s);var o=zt(t,e,r,n),h=i.id+"_"+o.id+"_"+(!0===r.wireframe),u=!1;h!==G&&(G=h,u=!0),n.morphTargetInfluences&&(N.update(n,i,r,o),u=!0);var l,c=i.index,p=i.attributes.position,d=1;!0===r.wireframe&&(c=S.getWireframeAttribute(i),d=2);var m=z;null!==c&&(l=b.get(c),(m=R).setIndex(l)),u&&(!function(t,e,i,r){if(i&&i.isInstancedBufferGeometry&&null===v.get("ANGLE_instanced_arrays"))return;void 0===r&&(r=0);y.initAttributes();var n=i.attributes,a=e.getAttributes(),s=t.defaultAttributeValues;for(var o in a){var h=a[o];if(h>=0){var u=n[o];if(void 0!==u){var l=u.normalized,c=u.itemSize,p=b.get(u);if(void 0===p)continue;var d=p.buffer,m=p.type,g=p.bytesPerElement;if(u.isInterleavedBufferAttribute){var x=u.data,w=x.stride,M=u.offset;x&&x.isInstancedInterleavedBuffer?(y.enableAttributeAndDivisor(h,x.meshPerAttribute),void 0===i.maxInstancedCount&&(i.maxInstancedCount=x.meshPerAttribute*x.count)):y.enableAttribute(h),f.bindBuffer(f.ARRAY_BUFFER,d),f.vertexAttribPointer(h,c,m,l,w*g,(r*w+M)*g)}else u.isInstancedBufferAttribute?(y.enableAttributeAndDivisor(h,u.meshPerAttribute),void 0===i.maxInstancedCount&&(i.maxInstancedCount=u.meshPerAttribute*u.count)):y.enableAttribute(h),f.bindBuffer(f.ARRAY_BUFFER,d),f.vertexAttribPointer(h,c,m,l,0,r*c*g)}else if(void 0!==s){var _=s[o];if(void 0!==_)switch(_.length){case 2:f.vertexAttrib2fv(h,_);break;case 3:f.vertexAttrib3fv(h,_);break;case 4:f.vertexAttrib4fv(h,_);break;default:f.vertexAttrib1fv(h,_)}}}}y.disableUnusedAttributes()}(r,o,i),null!==c&&f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,l.buffer));var g=1/0;null!==c?g=c.count:void 0!==p&&(g=p.count);var x=i.drawRange.start*d,w=i.drawRange.count*d,M=null!==a?a.start*d:0,_=null!==a?a.count*d:1/0,T=Math.max(x,M),E=Math.min(g,x+w,M+_)-1,A=Math.max(0,E-T+1);if(0!==A){if(n.isMesh)if(!0===r.wireframe)y.setLineWidth(r.wireframeLinewidth*ht()),m.setMode(f.LINES);else switch(n.drawMode){case 0:m.setMode(f.TRIANGLES);break;case 1:m.setMode(f.TRIANGLE_STRIP);break;case 2:m.setMode(f.TRIANGLE_FAN)}else if(n.isLine){var P=r.linewidth;void 0===P&&(P=1),y.setLineWidth(P*ht()),n.isLineSegments?m.setMode(f.LINES):n.isLineLoop?m.setMode(f.LINE_LOOP):m.setMode(f.LINE_STRIP)}else n.isPoints&&m.setMode(f.POINTS);i&&i.isInstancedBufferGeometry?i.maxInstancedCount>0&&m.renderInstances(i,T,A):m.render(T,A)}},this.compile=function(t,e){(p=P.get(t,e)).init(),t.traverse((function(t){t.isLight&&(p.pushLight(t),t.castShadow&&p.pushShadow(t))})),p.setupLights(e),t.traverse((function(e){if(e.material)if(Array.isArray(e.material))for(var i=0;i<e.material.length;i++)Nt(e.material[i],t.fog,e);else Nt(e.material,t.fog,e)}))};var Mt,_t=!1,bt=null;function St(){_t=!1}function Tt(){var t=dt.getDevice();t&&t.isPresenting?t.requestAnimationFrame(Et):window.requestAnimationFrame(Et)}function Et(t){!1!==_t&&(bt(t),Tt())}function At(t,e,i){if(!1!==t.visible){if(t.layers.test(e.layers))if(t.isLight)p.pushLight(t),t.castShadow&&p.pushShadow(t);else if(t.isSprite)t.frustumCulled&&!$.intersectsSprite(t)||p.pushSprite(t);else if(t.isImmediateRenderObject)i&&nt.setFromMatrixPosition(t.matrixWorld).applyMatrix4(rt),l.push(t,null,t.material,nt.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.update(),!t.frustumCulled||$.intersectsObject(t))){i&&nt.setFromMatrixPosition(t.matrixWorld).applyMatrix4(rt);var r=T.update(t),n=t.material;if(Array.isArray(n))for(var a=r.groups,s=0,o=a.length;s<o;s++){var h=a[s],u=n[h.materialIndex];u&&u.visible&&l.push(t,r,u,nt.z,h)}else n.visible&&l.push(t,r,n,nt.z,null)}var c=t.children;for(s=0,o=c.length;s<o;s++)At(c[s],e,i)}}function Pt(t,e,i,r){for(var n=0,a=t.length;n<a;n++){var s=t[n],o=s.object,h=s.geometry,u=void 0===r?s.material:r,l=s.group;if(i.isArrayCamera){k=i;for(var c=i.cameras,p=0,d=c.length;p<d;p++){var f=c[p];if(o.layers.test(f.layers)){var m=f.bounds,v=m.x*Y,g=m.y*q,x=m.z*Y,w=m.w*q;y.viewport(W.set(v,g,x,w).multiplyScalar(Z)),Ct(o,e,f,h,u,l)}}}else k=null,Ct(o,e,i,h,u,l)}}function Ct(t,e,i,r,n,a){if(t.onBeforeRender(U,e,i,r,n,a),p=P.get(e,k||i),t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject){var s=t.isMesh&&t.matrixWorld.determinant()<0;y.setMaterial(n,s);var o=zt(i,e.fog,n,t);G="",function(t,e,i){t.render((function(t){U.renderBufferImmediate(t,e,i)}))}(t,o,n)}else U.renderBufferDirect(i,e.fog,r,n,t,a);t.onAfterRender(U,e,i,r,n,a),p=P.get(e,k||i)}function Nt(t,e,i){var r=w.get(t),n=p.state.lights,a=p.state.shadowsArray,s=E.getParameters(t,n.state,a,e,tt.numPlanes,tt.numIntersection,i),o=E.getProgramCode(t,s),h=r.program,u=!0;if(void 0===h)t.addEventListener("dispose",yt);else if(h.code!==o)wt(t);else if(r.lightsHash!==n.state.hash)w.update(t,"lightsHash",n.state.hash),u=!1;else{if(void 0!==s.shaderID)return;u=!1}if(u){if(s.shaderID){var l=gt[s.shaderID];r.shader={name:t.type,uniforms:ct.clone(l.uniforms),vertexShader:l.vertexShader,fragmentShader:l.fragmentShader}}else r.shader={name:t.type,uniforms:t.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader};t.onBeforeCompile(r.shader),h=E.acquireProgram(t,r.shader,s,o),r.program=h,t.program=h}var c=h.getAttributes();if(t.morphTargets){t.numSupportedMorphTargets=0;for(var d=0;d<U.maxMorphTargets;d++)c["morphTarget"+d]>=0&&t.numSupportedMorphTargets++}if(t.morphNormals){t.numSupportedMorphNormals=0;for(d=0;d<U.maxMorphNormals;d++)c["morphNormal"+d]>=0&&t.numSupportedMorphNormals++}var f=r.shader.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(r.numClippingPlanes=tt.numPlanes,r.numIntersection=tt.numIntersection,f.clippingPlanes=tt.uniform),r.fog=e,r.lightsHash=n.state.hash,t.lights&&(f.ambientLightColor.value=n.state.ambient,f.directionalLights.value=n.state.directional,f.spotLights.value=n.state.spot,f.rectAreaLights.value=n.state.rectArea,f.pointLights.value=n.state.point,f.hemisphereLights.value=n.state.hemi,f.directionalShadowMap.value=n.state.directionalShadowMap,f.directionalShadowMatrix.value=n.state.directionalShadowMatrix,f.spotShadowMap.value=n.state.spotShadowMap,f.spotShadowMatrix.value=n.state.spotShadowMatrix,f.pointShadowMap.value=n.state.pointShadowMap,f.pointShadowMatrix.value=n.state.pointShadowMatrix);var m=r.program.getUniforms(),v=ot.seqWithValue(m.seq,f);r.uniformsList=v}function zt(t,e,i,r){H=0;var n=w.get(i),a=p.state.lights;if(et&&(it||t!==V)){var s=t===V&&i.id===B;tt.setState(i.clippingPlanes,i.clipIntersection,i.clipShadows,t,n,s)}!1===i.needsUpdate&&(void 0===n.program||i.fog&&n.fog!==e||i.lights&&n.lightsHash!==a.state.hash?i.needsUpdate=!0:void 0===n.numClippingPlanes||n.numClippingPlanes===tt.numPlanes&&n.numIntersection===tt.numIntersection||(i.needsUpdate=!0)),i.needsUpdate&&(Nt(i,e,r),i.needsUpdate=!1);var o,h,u=!1,l=!1,d=!1,m=n.program,v=m.getUniforms(),x=n.shader.uniforms;if(y.useProgram(m.program)&&(u=!0,l=!0,d=!0),i.id!==B&&(B=i.id,l=!0),u||t!==V){if(v.setValue(f,"projectionMatrix",t.projectionMatrix),g.logarithmicDepthBuffer&&v.setValue(f,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),V!==(k||t)&&(V=k||t,l=!0,d=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshStandardMaterial||i.envMap){var _=v.map.cameraPosition;void 0!==_&&_.setValue(f,nt.setFromMatrixPosition(t.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.skinning)&&v.setValue(f,"viewMatrix",t.matrixWorldInverse)}if(i.skinning){v.setOptional(f,r,"bindMatrix"),v.setOptional(f,r,"bindMatrixInverse");var b=r.skeleton;if(b){var S=b.bones;if(g.floatVertexTextures){if(void 0===b.boneTexture){var T=Math.sqrt(4*S.length);T=c.ceilPowerOfTwo(T),T=Math.max(T,4);var E=new Float32Array(T*T*4);E.set(b.boneMatrices);var A=new M(E,T,T,1023,1015);A.needsUpdate=!0,b.boneMatrices=E,b.boneTexture=A,b.boneTextureSize=T}v.setValue(f,"boneTexture",b.boneTexture),v.setValue(f,"boneTextureSize",b.boneTextureSize)}else v.setOptional(f,b,"boneMatrices")}}return l&&(v.setValue(f,"toneMappingExposure",U.toneMappingExposure),v.setValue(f,"toneMappingWhitePoint",U.toneMappingWhitePoint),i.lights&&(h=d,(o=x).ambientLightColor.needsUpdate=h,o.directionalLights.needsUpdate=h,o.pointLights.needsUpdate=h,o.spotLights.needsUpdate=h,o.rectAreaLights.needsUpdate=h,o.hemisphereLights.needsUpdate=h),e&&i.fog&&function(t,e){t.fogColor.value=e.color,e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)}(x,e),i.isMeshBasicMaterial?Rt(x,i):i.isMeshLambertMaterial?(Rt(x,i),function(t,e){e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}(x,i)):i.isMeshPhongMaterial?(Rt(x,i),i.isMeshToonMaterial?function(t,e){Ot(t,e),e.gradientMap&&(t.gradientMap.value=e.gradientMap)}(x,i):Ot(x,i)):i.isMeshStandardMaterial?(Rt(x,i),i.isMeshPhysicalMaterial?function(t,e){t.clearCoat.value=e.clearCoat,t.clearCoatRoughness.value=e.clearCoatRoughness,Ft(t,e)}(x,i):Ft(x,i)):i.isMeshDepthMaterial?(Rt(x,i),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(x,i)):i.isMeshDistanceMaterial?(Rt(x,i),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias);t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(x,i)):i.isMeshNormalMaterial?(Rt(x,i),function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale);e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale));e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(x,i)):i.isLineBasicMaterial?(function(t,e){t.diffuse.value=e.color,t.opacity.value=e.opacity}(x,i),i.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(x,i)):i.isPointsMaterial?function(t,e){if(t.diffuse.value=e.color,t.opacity.value=e.opacity,t.size.value=e.size*Z,t.scale.value=.5*q,t.map.value=e.map,null!==e.map){if(!0===e.map.matrixAutoUpdate){var i=e.map.offset,r=e.map.repeat,n=e.map.rotation,a=e.map.center;e.map.matrix.setUvTransform(i.x,i.y,r.x,r.y,n,a.x,a.y)}t.uvTransform.value.copy(e.map.matrix)}}(x,i):i.isShadowMaterial&&(x.color.value=i.color,x.opacity.value=i.opacity),void 0!==x.ltc_1&&(x.ltc_1.value=lt.LTC_1),void 0!==x.ltc_2&&(x.ltc_2.value=lt.LTC_2),ot.upload(f,n.uniformsList,x,U)),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(ot.upload(f,n.uniformsList,x,U),i.uniformsNeedUpdate=!1),v.setValue(f,"modelViewMatrix",r.modelViewMatrix),v.setValue(f,"normalMatrix",r.normalMatrix),v.setValue(f,"modelMatrix",r.matrixWorld),m}function Rt(t,e){var i;if(t.opacity.value=e.opacity,e.color&&(t.diffuse.value=e.color),e.emissive&&t.emissive.value.copy(e.emissive).multiplyScalar(e.emissiveIntensity),e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.specularMap&&(t.specularMap.value=e.specularMap),e.envMap&&(t.envMap.value=e.envMap,t.flipEnvMap.value=e.envMap&&e.envMap.isCubeTexture?-1:1,t.reflectivity.value=e.reflectivity,t.refractionRatio.value=e.refractionRatio),e.lightMap&&(t.lightMap.value=e.lightMap,t.lightMapIntensity.value=e.lightMapIntensity),e.aoMap&&(t.aoMap.value=e.aoMap,t.aoMapIntensity.value=e.aoMapIntensity),e.map?i=e.map:e.specularMap?i=e.specularMap:e.displacementMap?i=e.displacementMap:e.normalMap?i=e.normalMap:e.bumpMap?i=e.bumpMap:e.roughnessMap?i=e.roughnessMap:e.metalnessMap?i=e.metalnessMap:e.alphaMap?i=e.alphaMap:e.emissiveMap&&(i=e.emissiveMap),void 0!==i){if(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate){var r=i.offset,n=i.repeat,a=i.rotation,s=i.center;i.matrix.setUvTransform(r.x,r.y,n.x,n.y,a,s.x,s.y)}t.uvTransform.value.copy(i.matrix)}}function Ot(t,e){t.specular.value=e.specular,t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale)),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}function Ft(t,e){t.roughness.value=e.roughness,t.metalness.value=e.metalness,e.roughnessMap&&(t.roughnessMap.value=e.roughnessMap),e.metalnessMap&&(t.metalnessMap.value=e.metalnessMap),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale)),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),e.envMap&&(t.envMapIntensity.value=e.envMapIntensity)}this.animate=function(t){null!==(bt=t)?_t||(Tt(),_t=!0):St()},this.render=function(t,e,i,r){if(e&&e.isCamera&&!D){G="",B=-1,V=null,!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),dt.enabled&&(e=dt.getCamera(e)),(p=P.get(t,e)).init(),t.onBeforeRender(U,t,e,i),rt.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),$.setFromMatrix(rt),it=this.localClippingEnabled,et=tt.init(this.clippingPlanes,it,e),(l=A.get(t,e)).init(),At(t,e,U.sortObjects),!0===U.sortObjects&&l.sort(),et&&tt.beginShadows();var n=p.state.shadowsArray;ft.render(n,t,e),p.setupLights(e),et&&tt.endShadows(),this.info.autoReset&&this.info.reset(),void 0===i&&(i=null),this.setRenderTarget(i),C.render(l,t,e,r);var a=l.opaque,s=l.transparent;if(t.overrideMaterial){var o=t.overrideMaterial;a.length&&Pt(a,t,e,o),s.length&&Pt(s,t,e,o)}else a.length&&Pt(a,t,e),s.length&&Pt(s,t,e);var h=p.state.spritesArray;O.render(h,t,e),i&&_.updateRenderTargetMipmap(i),y.buffers.depth.setTest(!0),y.buffers.depth.setMask(!0),y.buffers.color.setMask(!0),y.setPolygonOffset(!1),t.onAfterRender(U,t,e),dt.enabled&&dt.submitFrame(),l=null,p=null}},this.allocTextureUnit=function(){var t=H;return g.maxTextures,H+=1,t},this.setTexture2D=(Mt=!1,function(t,e){t&&t.isWebGLRenderTarget&&(Mt||(Mt=!0),t=t.texture),_.setTexture2D(t,e)}),this.setTexture=function(){var t=!1;return function(e,i){t||(t=!0),_.setTexture2D(e,i)}}(),this.setTextureCube=function(){var t=!1;return function(e,i){e&&e.isWebGLRenderTargetCube&&(t||(t=!0),e=e.texture),e&&e.isCubeTexture||Array.isArray(e.image)&&6===e.image.length?_.setTextureCube(e,i):_.setTextureCubeDynamic(e,i)}}(),this.getRenderTarget=function(){return F},this.setRenderTarget=function(t){F=t,t&&void 0===w.get(t).__webglFramebuffer&&_.setupRenderTarget(t);var e=null,i=!1;if(t){var r=w.get(t).__webglFramebuffer;t.isWebGLRenderTargetCube?(e=r[t.activeCubeFace],i=!0):e=r,W.copy(t.viewport),j.copy(t.scissor),X=t.scissorTest}else W.copy(J).multiplyScalar(Z),j.copy(Q).multiplyScalar(Z),X=K;if(I!==e&&(f.bindFramebuffer(f.FRAMEBUFFER,e),I=e),y.viewport(W),y.scissor(j),y.setScissorTest(X),i){var n=w.get(t.texture);f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_CUBE_MAP_POSITIVE_X+t.activeCubeFace,n.__webglTexture,t.activeMipMapLevel)}},this.readRenderTargetPixels=function(t,e,i,r,n,a){if(t&&t.isWebGLRenderTarget){var s=w.get(t).__webglFramebuffer;if(s){var o=!1;s!==I&&(f.bindFramebuffer(f.FRAMEBUFFER,s),o=!0);try{var h=t.texture,u=h.format,l=h.type;if(1023!==u&&L.convert(u)!==f.getParameter(f.IMPLEMENTATION_COLOR_READ_FORMAT))return;if(!(1009===l||L.convert(l)===f.getParameter(f.IMPLEMENTATION_COLOR_READ_TYPE)||1015===l&&(v.get("OES_texture_float")||v.get("WEBGL_color_buffer_float"))||1016===l&&v.get("EXT_color_buffer_half_float")))return;f.checkFramebufferStatus(f.FRAMEBUFFER)===f.FRAMEBUFFER_COMPLETE&&e>=0&&e<=t.width-r&&i>=0&&i<=t.height-n&&f.readPixels(e,i,r,n,L.convert(u),L.convert(l),a)}finally{o&&f.bindFramebuffer(f.FRAMEBUFFER,I)}}}},this.copyFramebufferToTexture=function(t,e,i){var r=e.image.width,n=e.image.height,a=L.convert(e.format);this.setTexture2D(e,0),f.copyTexImage2D(f.TEXTURE_2D,i||0,a,t.x,t.y,r,n,0)}}function di(t,e,i){this.name="",this.color=new ut(t),this.near=void 0!==e?e:1,this.far=void 0!==i?i:1e3}function fi(){jt.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}function mi(t){Pt.call(this),this.type="PointsMaterial",this.color=new ut(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.lights=!1,this.setValues(t)}function vi(t,e){jt.call(this),this.type="Points",this.geometry=void 0!==t?t:new ge,this.material=void 0!==e?e:new mi({color:16777215*Math.random()})}function gi(){jt.call(this),this.type="Group"}function yi(t,e,i,r){Jt.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:i,detail:r},this.fromBufferGeometry(new xi(t,e,i,r)),this.mergeVertices()}function xi(t,e,i,r){ge.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:t,indices:e,radius:i,detail:r},i=i||1;var n=[],a=[];function s(t,e,i,r){var n,a,s=Math.pow(2,r),h=[];for(n=0;n<=s;n++){h[n]=[];var u=t.clone().lerp(i,n/s),l=e.clone().lerp(i,n/s),c=s-n;for(a=0;a<=c;a++)h[n][a]=0===a&&n===s?u:u.clone().lerp(l,a/c)}for(n=0;n<s;n++)for(a=0;a<2*(s-n)-1;a++){var p=Math.floor(a/2);a%2==0?(o(h[n][p+1]),o(h[n+1][p]),o(h[n][p])):(o(h[n][p+1]),o(h[n+1][p+1]),o(h[n+1][p]))}}function o(t){n.push(t.x,t.y,t.z)}function h(e,i){var r=3*e;i.x=t[r+0],i.y=t[r+1],i.z=t[r+2]}function u(t,e,i,r){r<0&&1===t.x&&(a[e]=t.x-1),0===i.x&&0===i.z&&(a[e]=r/2/Math.PI+.5)}function l(t){return Math.atan2(t.z,-t.x)}function c(t){return Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))}!function(t){for(var i=new m,r=new m,n=new m,a=0;a<e.length;a+=3)h(e[a+0],i),h(e[a+1],r),h(e[a+2],n),s(i,r,n,t)}(r=r||0),function(t){for(var e=new m,i=0;i<n.length;i+=3)e.x=n[i+0],e.y=n[i+1],e.z=n[i+2],e.normalize().multiplyScalar(t),n[i+0]=e.x,n[i+1]=e.y,n[i+2]=e.z}(i),function(){for(var t=new m,e=0;e<n.length;e+=3){t.x=n[e+0],t.y=n[e+1],t.z=n[e+2];var i=l(t)/2/Math.PI+.5,r=c(t)/Math.PI+.5;a.push(i,1-r)}(function(){for(var t=new m,e=new m,i=new m,r=new m,s=new p,o=new p,h=new p,c=0,d=0;c<n.length;c+=9,d+=6){t.set(n[c+0],n[c+1],n[c+2]),e.set(n[c+3],n[c+4],n[c+5]),i.set(n[c+6],n[c+7],n[c+8]),s.set(a[d+0],a[d+1]),o.set(a[d+2],a[d+3]),h.set(a[d+4],a[d+5]),r.copy(t).add(e).add(i).divideScalar(3);var f=l(r);u(s,d+0,t,f),u(o,d+2,e,f),u(h,d+4,i,f)}})(),function(){for(var t=0;t<a.length;t+=6){var e=a[t+0],i=a[t+2],r=a[t+4],n=Math.max(e,i,r),s=Math.min(e,i,r);n>.9&&s<.1&&(e<.2&&(a[t+0]+=1),i<.2&&(a[t+2]+=1),r<.2&&(a[t+4]+=1))}}()}(),this.addAttribute("position",new ae(n,3)),this.addAttribute("normal",new ae(n.slice(),3)),this.addAttribute("uv",new ae(a,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}function wi(t,e){Jt.call(this),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Mi(t,e)),this.mergeVertices()}function Mi(t,e){var i=(1+Math.sqrt(5))/2,r=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1];xi.call(this,r,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronBufferGeometry",this.parameters={radius:t,detail:e}}function _i(t){be.call(this,t),this.type="RawShaderMaterial"}di.prototype.isFog=!0,di.prototype.clone=function(){return new di(this.color.getHex(),this.near,this.far)},di.prototype.toJSON=function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}},fi.prototype=Object.assign(Object.create(jt.prototype),{constructor:fi,copy:function(t,e){return jt.prototype.copy.call(this,t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this},toJSON:function(t){var e=jt.prototype.toJSON.call(this,t);return null!==this.background&&(e.object.background=this.background.toJSON(t)),null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}),mi.prototype=Object.create(Pt.prototype),mi.prototype.constructor=mi,mi.prototype.isPointsMaterial=!0,mi.prototype.copy=function(t){return Pt.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this},vi.prototype=Object.assign(Object.create(jt.prototype),{constructor:vi,isPoints:!0,raycast:function(){var t=new d,e=new Se,i=new Rt;return function(r,n){var a=this,s=this.geometry,o=this.matrixWorld,h=r.params.Points.threshold;if(null===s.boundingSphere&&s.computeBoundingSphere(),i.copy(s.boundingSphere),i.applyMatrix4(o),i.radius+=h,!1!==r.ray.intersectsSphere(i)){t.getInverse(o),e.copy(r.ray).applyMatrix4(t);var u=h/((this.scale.x+this.scale.y+this.scale.z)/3),l=u*u,c=new m;if(s.isBufferGeometry){var p=s.index,d=s.attributes.position.array;if(null!==p)for(var f=p.array,v=0,g=f.length;v<g;v++){var y=f[v];c.fromArray(d,3*y),M(c,y)}else{v=0;for(var x=d.length/3;v<x;v++)c.fromArray(d,3*v),M(c,v)}}else{var w=s.vertices;for(v=0,x=w.length;v<x;v++)M(w[v],v)}}function M(t,i){var s=e.distanceSqToPoint(t);if(s<l){var h=e.closestPointToPoint(t);h.applyMatrix4(o);var u=r.ray.origin.distanceTo(h);if(u<r.near||u>r.far)return;n.push({distance:u,distanceToRay:Math.sqrt(s),point:h.clone(),index:i,face:null,object:a})}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),gi.prototype=Object.assign(Object.create(jt.prototype),{constructor:gi,isGroup:!0}),yi.prototype=Object.create(Jt.prototype),yi.prototype.constructor=yi,xi.prototype=Object.create(ge.prototype),xi.prototype.constructor=xi,wi.prototype=Object.create(Jt.prototype),wi.prototype.constructor=wi,Mi.prototype=Object.create(xi.prototype),Mi.prototype.constructor=Mi,_i.prototype=Object.create(be.prototype),_i.prototype.constructor=_i,_i.prototype.isRawShaderMaterial=!0;var bi={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};var Si=new function(t,e,i){var r=this,n=!1,a=0,s=0,o=void 0;this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(t){s++,!1===n&&void 0!==r.onStart&&r.onStart(t,a,s),n=!0},this.itemEnd=function(t){a++,void 0!==r.onProgress&&r.onProgress(t,a,s),a===s&&(n=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(t){void 0!==r.onError&&r.onError(t)},this.resolveURL=function(t){return o?o(t):t},this.setURLModifier=function(t){return o=t,this}};function Ti(t){this.manager=void 0!==t?t:Si}function Ei(t){this.manager=void 0!==t?t:Si}function Ai(){this.type="Curve",this.arcLengthDivisions=200}function Pi(t,e,i,r,n,a,s,o){Ai.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=e||0,this.xRadius=i||1,this.yRadius=r||1,this.aStartAngle=n||0,this.aEndAngle=a||2*Math.PI,this.aClockwise=s||!1,this.aRotation=o||0}function Ci(t,e,i,r,n,a){Pi.call(this,t,e,i,i,r,n,a),this.type="ArcCurve"}function Ni(){var t=0,e=0,i=0,r=0;function n(n,a,s,o){t=n,e=s,i=-3*n+3*a-2*s-o,r=2*n-2*a+s+o}return{initCatmullRom:function(t,e,i,r,a){n(e,i,a*(i-t),a*(r-e))},initNonuniformCatmullRom:function(t,e,i,r,a,s,o){var h=(e-t)/a-(i-t)/(a+s)+(i-e)/s,u=(i-e)/s-(r-e)/(s+o)+(r-i)/o;n(e,i,h*=s,u*=s)},calc:function(n){var a=n*n;return t+e*n+i*a+r*(a*n)}}}Object.assign(Ti.prototype,{crossOrigin:"Anonymous",load:function(t,e,i,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var n=this,a=bi.get(t);if(void 0!==a)return n.manager.itemStart(t),setTimeout((function(){e&&e(a),n.manager.itemEnd(t)}),0),a;var s=document.createElementNS("http://www.w3.org/1999/xhtml","img");return s.addEventListener("load",(function(){bi.add(t,this),e&&e(this),n.manager.itemEnd(t)}),!1),s.addEventListener("error",(function(e){r&&r(e),n.manager.itemEnd(t),n.manager.itemError(t)}),!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),n.manager.itemStart(t),s.src=t,s},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Object.assign(Ei.prototype,{crossOrigin:"Anonymous",load:function(t,e,i,r){var n=new y,a=new Ti(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(t,(function(i){n.image=i;var r=t.search(/\.(jpg|jpeg)$/)>0||0===t.search(/^data\:image\/jpeg/);n.format=r?1022:1023,n.needsUpdate=!0,void 0!==e&&e(n)}),i,r),n},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Object.assign(Ai.prototype,{getPoint:function(){return null},getPointAt:function(t,e){var i=this.getUtoTmapping(t);return this.getPoint(i,e)},getPoints:function(t){void 0===t&&(t=5);for(var e=[],i=0;i<=t;i++)e.push(this.getPoint(i/t));return e},getSpacedPoints:function(t){void 0===t&&(t=5);for(var e=[],i=0;i<=t;i++)e.push(this.getPointAt(i/t));return e},getLength:function(){var t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e,i,r=[],n=this.getPoint(0),a=0;for(r.push(0),i=1;i<=t;i++)a+=(e=this.getPoint(i/t)).distanceTo(n),r.push(a),n=e;return this.cacheArcLengths=r,r},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,e){var i,r=this.getLengths(),n=0,a=r.length;i=e||t*r[a-1];for(var s,o=0,h=a-1;o<=h;)if((s=r[n=Math.floor(o+(h-o)/2)]-i)<0)o=n+1;else{if(!(s>0)){h=n;break}h=n-1}if(r[n=h]===i)return n/(a-1);var u=r[n];return(n+(i-u)/(r[n+1]-u))/(a-1)},getTangent:function(t){var e=1e-4,i=t-e,r=t+e;i<0&&(i=0),r>1&&(r=1);var n=this.getPoint(i);return this.getPoint(r).clone().sub(n).normalize()},getTangentAt:function(t){var e=this.getUtoTmapping(t);return this.getTangent(e)},computeFrenetFrames:function(t,e){var i,r,n,a=new m,s=[],o=[],h=[],u=new m,l=new d;for(i=0;i<=t;i++)r=i/t,s[i]=this.getTangentAt(r),s[i].normalize();o[0]=new m,h[0]=new m;var p=Number.MAX_VALUE,f=Math.abs(s[0].x),v=Math.abs(s[0].y),g=Math.abs(s[0].z);for(f<=p&&(p=f,a.set(1,0,0)),v<=p&&(p=v,a.set(0,1,0)),g<=p&&a.set(0,0,1),u.crossVectors(s[0],a).normalize(),o[0].crossVectors(s[0],u),h[0].crossVectors(s[0],o[0]),i=1;i<=t;i++)o[i]=o[i-1].clone(),h[i]=h[i-1].clone(),u.crossVectors(s[i-1],s[i]),u.length()>Number.EPSILON&&(u.normalize(),n=Math.acos(c.clamp(s[i-1].dot(s[i]),-1,1)),o[i].applyMatrix4(l.makeRotationAxis(u,n))),h[i].crossVectors(s[i],o[i]);if(!0===e)for(n=Math.acos(c.clamp(o[0].dot(o[t]),-1,1)),n/=t,s[0].dot(u.crossVectors(o[0],o[t]))>0&&(n=-n),i=1;i<=t;i++)o[i].applyMatrix4(l.makeRotationAxis(s[i],n*i)),h[i].crossVectors(s[i],o[i]);return{tangents:s,normals:o,binormals:h}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this},toJSON:function(){var t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t},fromJSON:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}),Pi.prototype=Object.create(Ai.prototype),Pi.prototype.constructor=Pi,Pi.prototype.isEllipseCurve=!0,Pi.prototype.getPoint=function(t,e){for(var i=e||new p,r=2*Math.PI,n=this.aEndAngle-this.aStartAngle,a=Math.abs(n)<Number.EPSILON;n<0;)n+=r;for(;n>r;)n-=r;n<Number.EPSILON&&(n=a?0:r),!0!==this.aClockwise||a||(n===r?n=-r:n-=r);var s=this.aStartAngle+t*n,o=this.aX+this.xRadius*Math.cos(s),h=this.aY+this.yRadius*Math.sin(s);if(0!==this.aRotation){var u=Math.cos(this.aRotation),l=Math.sin(this.aRotation),c=o-this.aX,d=h-this.aY;o=c*u-d*l+this.aX,h=c*l+d*u+this.aY}return i.set(o,h)},Pi.prototype.copy=function(t){return Ai.prototype.copy.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},Pi.prototype.toJSON=function(){var t=Ai.prototype.toJSON.call(this);return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t},Pi.prototype.fromJSON=function(t){return Ai.prototype.fromJSON.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},Ci.prototype=Object.create(Pi.prototype),Ci.prototype.constructor=Ci,Ci.prototype.isArcCurve=!0;var zi=new m,Ri=new Ni,Oi=new Ni,Li=new Ni;function Ui(t,e,i,r){Ai.call(this),this.type="CatmullRomCurve3",this.points=t||[],this.closed=e||!1,this.curveType=i||"centripetal",this.tension=r||.5}function Di(t,e,i,r,n){var a=.5*(r-e),s=.5*(n-i),o=t*t;return(2*i-2*r+a+s)*(t*o)+(-3*i+3*r-2*a-s)*o+a*t+i}function Fi(t,e,i,r){return function(t,e){var i=1-t;return i*i*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,i)+function(t,e){return t*t*e}(t,r)}function Ii(t,e,i,r,n){return function(t,e){var i=1-t;return i*i*i*e}(t,e)+function(t,e){var i=1-t;return 3*i*i*t*e}(t,i)+function(t,e){return 3*(1-t)*t*t*e}(t,r)+function(t,e){return t*t*t*e}(t,n)}function Bi(t,e,i,r){Ai.call(this),this.type="CubicBezierCurve",this.v0=t||new p,this.v1=e||new p,this.v2=i||new p,this.v3=r||new p}function Gi(t,e,i,r){Ai.call(this),this.type="CubicBezierCurve3",this.v0=t||new m,this.v1=e||new m,this.v2=i||new m,this.v3=r||new m}function Vi(t,e){Ai.call(this),this.type="LineCurve",this.v1=t||new p,this.v2=e||new p}function ki(t,e){Ai.call(this),this.type="LineCurve3",this.v1=t||new m,this.v2=e||new m}function Wi(t,e,i){Ai.call(this),this.type="QuadraticBezierCurve",this.v0=t||new p,this.v1=e||new p,this.v2=i||new p}function ji(t,e,i){Ai.call(this),this.type="QuadraticBezierCurve3",this.v0=t||new m,this.v1=e||new m,this.v2=i||new m}function Xi(t){Ai.call(this),this.type="SplineCurve",this.points=t||[]}Ui.prototype=Object.create(Ai.prototype),Ui.prototype.constructor=Ui,Ui.prototype.isCatmullRomCurve3=!0,Ui.prototype.getPoint=function(t,e){var i,r,n,a,s=e||new m,o=this.points,h=o.length,u=(h-(this.closed?0:1))*t,l=Math.floor(u),c=u-l;if(this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/o.length)+1)*o.length:0===c&&l===h-1&&(l=h-2,c=1),this.closed||l>0?i=o[(l-1)%h]:(zi.subVectors(o[0],o[1]).add(o[0]),i=zi),r=o[l%h],n=o[(l+1)%h],this.closed||l+2<h?a=o[(l+2)%h]:(zi.subVectors(o[h-1],o[h-2]).add(o[h-1]),a=zi),"centripetal"===this.curveType||"chordal"===this.curveType){var p="chordal"===this.curveType?.5:.25,d=Math.pow(i.distanceToSquared(r),p),f=Math.pow(r.distanceToSquared(n),p),v=Math.pow(n.distanceToSquared(a),p);f<1e-4&&(f=1),d<1e-4&&(d=f),v<1e-4&&(v=f),Ri.initNonuniformCatmullRom(i.x,r.x,n.x,a.x,d,f,v),Oi.initNonuniformCatmullRom(i.y,r.y,n.y,a.y,d,f,v),Li.initNonuniformCatmullRom(i.z,r.z,n.z,a.z,d,f,v)}else"catmullrom"===this.curveType&&(Ri.initCatmullRom(i.x,r.x,n.x,a.x,this.tension),Oi.initCatmullRom(i.y,r.y,n.y,a.y,this.tension),Li.initCatmullRom(i.z,r.z,n.z,a.z,this.tension));return s.set(Ri.calc(c),Oi.calc(c),Li.calc(c)),s},Ui.prototype.copy=function(t){Ai.prototype.copy.call(this,t),this.points=[];for(var e=0,i=t.points.length;e<i;e++){var r=t.points[e];this.points.push(r.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},Ui.prototype.toJSON=function(){var t=Ai.prototype.toJSON.call(this);t.points=[];for(var e=0,i=this.points.length;e<i;e++){var r=this.points[e];t.points.push(r.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t},Ui.prototype.fromJSON=function(t){Ai.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,i=t.points.length;e<i;e++){var r=t.points[e];this.points.push((new m).fromArray(r))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},Bi.prototype=Object.create(Ai.prototype),Bi.prototype.constructor=Bi,Bi.prototype.isCubicBezierCurve=!0,Bi.prototype.getPoint=function(t,e){var i=e||new p,r=this.v0,n=this.v1,a=this.v2,s=this.v3;return i.set(Ii(t,r.x,n.x,a.x,s.x),Ii(t,r.y,n.y,a.y,s.y)),i},Bi.prototype.copy=function(t){return Ai.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},Bi.prototype.toJSON=function(){var t=Ai.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},Bi.prototype.fromJSON=function(t){return Ai.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},Gi.prototype=Object.create(Ai.prototype),Gi.prototype.constructor=Gi,Gi.prototype.isCubicBezierCurve3=!0,Gi.prototype.getPoint=function(t,e){var i=e||new m,r=this.v0,n=this.v1,a=this.v2,s=this.v3;return i.set(Ii(t,r.x,n.x,a.x,s.x),Ii(t,r.y,n.y,a.y,s.y),Ii(t,r.z,n.z,a.z,s.z)),i},Gi.prototype.copy=function(t){return Ai.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},Gi.prototype.toJSON=function(){var t=Ai.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},Gi.prototype.fromJSON=function(t){return Ai.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},Vi.prototype=Object.create(Ai.prototype),Vi.prototype.constructor=Vi,Vi.prototype.isLineCurve=!0,Vi.prototype.getPoint=function(t,e){var i=e||new p;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i},Vi.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},Vi.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},Vi.prototype.copy=function(t){return Ai.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},Vi.prototype.toJSON=function(){var t=Ai.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},Vi.prototype.fromJSON=function(t){return Ai.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},ki.prototype=Object.create(Ai.prototype),ki.prototype.constructor=ki,ki.prototype.isLineCurve3=!0,ki.prototype.getPoint=function(t,e){var i=e||new m;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i},ki.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},ki.prototype.copy=function(t){return Ai.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},ki.prototype.toJSON=function(){var t=Ai.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},ki.prototype.fromJSON=function(t){return Ai.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},Wi.prototype=Object.create(Ai.prototype),Wi.prototype.constructor=Wi,Wi.prototype.isQuadraticBezierCurve=!0,Wi.prototype.getPoint=function(t,e){var i=e||new p,r=this.v0,n=this.v1,a=this.v2;return i.set(Fi(t,r.x,n.x,a.x),Fi(t,r.y,n.y,a.y)),i},Wi.prototype.copy=function(t){return Ai.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},Wi.prototype.toJSON=function(){var t=Ai.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},Wi.prototype.fromJSON=function(t){return Ai.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},ji.prototype=Object.create(Ai.prototype),ji.prototype.constructor=ji,ji.prototype.isQuadraticBezierCurve3=!0,ji.prototype.getPoint=function(t,e){var i=e||new m,r=this.v0,n=this.v1,a=this.v2;return i.set(Fi(t,r.x,n.x,a.x),Fi(t,r.y,n.y,a.y),Fi(t,r.z,n.z,a.z)),i},ji.prototype.copy=function(t){return Ai.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},ji.prototype.toJSON=function(){var t=Ai.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},ji.prototype.fromJSON=function(t){return Ai.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},Xi.prototype=Object.create(Ai.prototype),Xi.prototype.constructor=Xi,Xi.prototype.isSplineCurve=!0,Xi.prototype.getPoint=function(t,e){var i=e||new p,r=this.points,n=(r.length-1)*t,a=Math.floor(n),s=n-a,o=r[0===a?a:a-1],h=r[a],u=r[a>r.length-2?r.length-1:a+1],l=r[a>r.length-3?r.length-1:a+2];return i.set(Di(s,o.x,h.x,u.x,l.x),Di(s,o.y,h.y,u.y,l.y)),i},Xi.prototype.copy=function(t){Ai.prototype.copy.call(this,t),this.points=[];for(var e=0,i=t.points.length;e<i;e++){var r=t.points[e];this.points.push(r.clone())}return this},Xi.prototype.toJSON=function(){var t=Ai.prototype.toJSON.call(this);t.points=[];for(var e=0,i=this.points.length;e<i;e++){var r=this.points[e];t.points.push(r.toArray())}return t},Xi.prototype.fromJSON=function(t){Ai.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,i=t.points.length;e<i;e++){var r=t.points[e];this.points.push((new p).fromArray(r))}return this};var Hi=Object.freeze({__proto__:null,ArcCurve:Ci,CatmullRomCurve3:Ui,CubicBezierCurve:Bi,CubicBezierCurve3:Gi,EllipseCurve:Pi,LineCurve:Vi,LineCurve3:ki,QuadraticBezierCurve:Wi,QuadraticBezierCurve3:ji,SplineCurve:Xi});function Yi(){Ai.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function qi(t,e,i,r){this.ray=new Se(t,e),this.near=i||0,this.far=r||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return this.Points}}})}function Zi(t,e){return t.distance-e.distance}function Ji(t,e,i,r){if(!1!==t.visible&&(t.raycast(e,i),!0===r))for(var n=t.children,a=0,s=n.length;a<s;a++)Ji(n[a],e,i,!0)}Yi.prototype=Object.assign(Object.create(Ai.prototype),{constructor:Yi,add:function(t){this.curves.push(t)},closePath:function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new Vi(e,t))},getPoint:function(t){for(var e=t*this.getLength(),i=this.getCurveLengths(),r=0;r<i.length;){if(i[r]>=e){var n=i[r]-e,a=this.curves[r],s=a.getLength(),o=0===s?0:1-n/s;return a.getPointAt(o)}r++}return null},getLength:function(){var t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var t=[],e=0,i=0,r=this.curves.length;i<r;i++)e+=this.curves[i].getLength(),t.push(e);return this.cacheLengths=t,t},getSpacedPoints:function(t){void 0===t&&(t=40);for(var e=[],i=0;i<=t;i++)e.push(this.getPoint(i/t));return this.autoClose&&e.push(e[0]),e},getPoints:function(t){t=t||12;for(var e,i=[],r=0,n=this.curves;r<n.length;r++)for(var a=n[r],s=a&&a.isEllipseCurve?2*t:a&&a.isLineCurve?1:a&&a.isSplineCurve?t*a.points.length:t,o=a.getPoints(s),h=0;h<o.length;h++){var u=o[h];e&&e.equals(u)||(i.push(u),e=u)}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i},copy:function(t){Ai.prototype.copy.call(this,t),this.curves=[];for(var e=0,i=t.curves.length;e<i;e++){var r=t.curves[e];this.curves.push(r.clone())}return this.autoClose=t.autoClose,this},toJSON:function(){var t=Ai.prototype.toJSON.call(this);t.autoClose=this.autoClose,t.curves=[];for(var e=0,i=this.curves.length;e<i;e++){var r=this.curves[e];t.curves.push(r.toJSON())}return t},fromJSON:function(t){Ai.prototype.fromJSON.call(this,t),this.autoClose=t.autoClose,this.curves=[];for(var e=0,i=t.curves.length;e<i;e++){var r=t.curves[e];this.curves.push((new Hi[r.type]).fromJSON(r))}return this}}),Object.assign(qi.prototype,{linePrecision:1,set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize()):e&&e.isOrthographicCamera&&(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld))},intersectObject:function(t,e){var i=[];return Ji(t,this,i,e),i.sort(Zi),i},intersectObjects:function(t,e){var i=[];if(!1===Array.isArray(t))return i;for(var r=0,n=t.length;r<n;r++)Ji(t[r],this,i,e);return i.sort(Zi),i}});export{Qt as BufferAttribute,ge as BufferGeometry,ut as Color,Gi as CubicBezierCurve3,Yi as CurvePath,ae as Float32BufferAttribute,di as Fog,gi as Group,wi as IcosahedronGeometry,c as Math,Ae as Mesh,Ht as OrthographicCamera,ei as PerspectiveCamera,vi as Points,mi as PointsMaterial,f as Quaternion,l as REVISION,_i as RawShaderMaterial,qi as Raycaster,fi as Scene,Ei as TextureLoader,p as Vector2,m as Vector3,w as WebGLRenderTarget,pi as WebGLRenderer};
